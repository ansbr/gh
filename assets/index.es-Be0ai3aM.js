const __vite__fileDeps=["./index-IKukH_Wi.js","./index-BH8aE_pQ.js","./index-DoklN7qk.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{g as $o,e as $r,d as a_,f as c_,c as yo,a as Of,W as Fc,o as cl,_ as u_}from"./index-BH8aE_pQ.js";import{i as h_,b as l_,a as f_,c as p_,d as d_,e as g_,f as m_,g as y_,h as v_,j as __,k as w_,s as Wc,l as Rf,m as Tf,n as Z,x as Cf,r as Do,H as b_,o as Nf,q as Oo,p as E_,t as I_,w as Af}from"./index-BVNHDANZ.js";import"./___vite-browser-external_commonjs-proxy-BZeLeJ0L.js";function Gc(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function $f(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Gc(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Rc(n,t){t||(t=n.reduce((o,c)=>o+c.length,0));const r=$f(t);let s=0;for(const o of n)r.set(o,s),s+=o.length;return Gc(r)}const ul={...h_,...l_,...f_,...p_,...d_,...g_,...m_,...y_,...v_,...__};function Df(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const hl=Df("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),lc=Df("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=$f(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),Lf={utf8:hl,"utf-8":hl,hex:ul.base16,latin1:lc,ascii:lc,binary:lc,...ul};function pr(n,t="utf8"){const r=Lf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Gc(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}function rr(n,t="utf8"){const r=Lf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):r.encoder.encode(n).substring(1)}var ll=function(n,t,r){if(r||arguments.length===2)for(var s=0,o=t.length,c;s<o;s++)(c||!(s in t))&&(c||(c=Array.prototype.slice.call(t,0,s)),c[s]=t[s]);return n.concat(c||Array.prototype.slice.call(t))},x_=function(){function n(t,r,s){this.name=t,this.version=r,this.os=s,this.type="browser"}return n}(),S_=function(){function n(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return n}(),P_=function(){function n(t,r,s,o){this.name=t,this.version=r,this.os=s,this.bot=o,this.type="bot-device"}return n}(),O_=function(){function n(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return n}(),R_=function(){function n(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return n}(),T_=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,C_=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,fl=3,N_=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",T_]],pl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function A_(n){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new R_:typeof navigator<"u"?D_(navigator.userAgent):M_()}function $_(n){return n!==""&&N_.reduce(function(t,r){var s=r[0],o=r[1];if(t)return t;var c=o.exec(n);return!!c&&[s,c]},!1)}function D_(n){var t=$_(n);if(!t)return null;var r=t[0],s=t[1];if(r==="searchbot")return new O_;var o=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);o?o.length<fl&&(o=ll(ll([],o,!0),j_(fl-o.length),!0)):o=[];var c=o.join("."),l=L_(n),g=C_.exec(n);return g&&g[1]?new P_(r,c,l,g[1]):new x_(r,c,l)}function L_(n){for(var t=0,r=pl.length;t<r;t++){var s=pl[t],o=s[0],c=s[1],l=c.exec(n);if(l)return o}return null}function M_(){var n=typeof process<"u"&&process.version;return n?new S_(process.version.slice(1)):null}function j_(n){for(var t=[],r=0;r<n;r++)t.push("0");return t}const q_={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}},U_=":";function k_(n){const[t,r]=n.split(U_);return{namespace:t,reference:r}}function z_(n,t=[]){const r=[];return Object.keys(n).forEach(s=>{if(t.length&&!t.includes(s))return;const o=n[s];r.push(...o.accounts)}),r}function Mf(n,t){return n.includes(":")?[n]:t.chains||[]}const jf="base10",tr="base16",Tc="base64pad",Jc="utf8",qf=0,Ji=1,H_=0,dl=1,Cc=12,Yc=32;function K_(){const n=Cf.generateKeyPair();return{privateKey:rr(n.secretKey,tr),publicKey:rr(n.publicKey,tr)}}function Nc(){const n=Do.randomBytes(Yc);return rr(n,tr)}function B_(n,t){const r=Cf.sharedKey(pr(n,tr),pr(t,tr),!0),s=new b_(Wc.SHA256,r).expand(Yc);return rr(s,tr)}function V_(n){const t=Wc.hash(pr(n,tr));return rr(t,tr)}function In(n){const t=Wc.hash(pr(n,Jc));return rr(t,tr)}function F_(n){return pr(`${n}`,jf)}function as(n){return Number(rr(n,jf))}function W_(n){const t=F_(typeof n.type<"u"?n.type:qf);if(as(t)===Ji&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof n.senderPublicKey<"u"?pr(n.senderPublicKey,tr):void 0,s=typeof n.iv<"u"?pr(n.iv,tr):Do.randomBytes(Cc),o=new Nf.ChaCha20Poly1305(pr(n.symKey,tr)).seal(s,pr(n.message,Jc));return J_({type:t,sealed:o,iv:s,senderPublicKey:r})}function G_(n){const t=new Nf.ChaCha20Poly1305(pr(n.symKey,tr)),{sealed:r,iv:s}=Ro(n.encoded),o=t.open(s,r);if(o===null)throw new Error("Failed to decrypt");return rr(o,Jc)}function J_(n){if(as(n.type)===Ji){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return rr(Rc([n.type,n.senderPublicKey,n.iv,n.sealed]),Tc)}return rr(Rc([n.type,n.iv,n.sealed]),Tc)}function Ro(n){const t=pr(n,Tc),r=t.slice(H_,dl),s=dl;if(as(r)===Ji){const g=s+Yc,v=g+Cc,d=t.slice(s,g),w=t.slice(g,v),P=t.slice(v);return{type:r,sealed:P,iv:w,senderPublicKey:d}}const o=s+Cc,c=t.slice(s,o),l=t.slice(o);return{type:r,sealed:l,iv:c}}function Y_(n,t){const r=Ro(n);return Uf({type:as(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?rr(r.senderPublicKey,tr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Uf(n){const t=(n==null?void 0:n.type)||qf;if(t===Ji){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function gl(n){return n.type===Ji&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var Q_=Object.defineProperty,ml=Object.getOwnPropertySymbols,X_=Object.prototype.hasOwnProperty,Z_=Object.prototype.propertyIsEnumerable,yl=(n,t,r)=>t in n?Q_(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,vl=(n,t)=>{for(var r in t||(t={}))X_.call(t,r)&&yl(n,r,t[r]);if(ml)for(var r of ml(t))Z_.call(t,r)&&yl(n,r,t[r]);return n};const ew="ReactNative",Er={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},tw="js";function Qc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Sn(){return!Tf()&&!!Rf()&&navigator.product===ew}function Pn(){return!Qc()&&!!Rf()&&!!Tf()}function cs(){return Sn()?Er.reactNative:Qc()?Er.node:Pn()?Er.browser:Er.unknown}function rw(){var n;try{return Sn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(n=global.Application)==null?void 0:n.applicationId:void 0}catch{return}}function iw(n,t){let r=Oo.parse(n);return r=vl(vl({},r),t),n=Oo.stringify(r),n}function nw(){return w_()||{name:"",description:"",url:"",icons:[""]}}function sw(){if(cs()===Er.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:s}=global.Platform;return[r,s].join("-")}const n=A_();if(n===null)return"unknown";const t=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[t,n.name,n.version].join("-"):[t,n.version].join("-")}function ow(){var n;const t=cs();return t===Er.browser?[t,((n=E_())==null?void 0:n.host)||"unknown"].join(":"):t}function aw(n,t,r){const s=sw(),o=ow();return[[n,t].join("-"),[tw,r].join("-"),s,o].join("/")}function cw({protocol:n,version:t,relayUrl:r,sdkVersion:s,auth:o,projectId:c,useOnCloseEvent:l,bundleId:g}){const v=r.split("?"),d=aw(n,t,s),w={auth:o,ua:d,projectId:c,useOnCloseEvent:l||void 0,origin:g||void 0},P=iw(v[1]||"",w);return v[0]+"?"+P}function Wi(n,t){return n.filter(r=>t.includes(r)).length===n.length}function kf(n){return Object.fromEntries(n.entries())}function zf(n){return new Map(Object.entries(n))}function bn(n=Z.FIVE_MINUTES,t){const r=Z.toMiliseconds(n||Z.FIVE_MINUTES);let s,o,c;return{resolve:l=>{c&&s&&(clearTimeout(c),s(l))},reject:l=>{c&&o&&(clearTimeout(c),o(l))},done:()=>new Promise((l,g)=>{c=setTimeout(()=>{g(new Error(t))},r),s=l,o=g})}}function is(n,t,r){return new Promise(async(s,o)=>{const c=setTimeout(()=>o(new Error(r)),t);try{const l=await n;s(l)}catch(l){o(l)}clearTimeout(c)})}function Hf(n,t){if(typeof t=="string"&&t.startsWith(`${n}:`))return t;if(n.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(n.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${n}`)}function uw(n){return Hf("topic",n)}function hw(n){return Hf("id",n)}function Kf(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function br(n,t){return Z.fromMiliseconds(Date.now()+Z.toMiliseconds(n))}function Pi(n){return Date.now()>=Z.toMiliseconds(n)}function vt(n,t){return`${n}${t?`:${t}`:""}`}function fc(n=[],t=[]){return[...new Set([...n,...t])]}async function lw({id:n,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let o=s==null?void 0:s.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const c=`${o}/wc?requestId=${n}&sessionTopic=${t}`,l=cs();l===Er.browser?c.startsWith("https://")?window.open(c,"_blank","noreferrer noopener"):window.open(c,"_self","noreferrer noopener"):l===Er.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(c)}catch(s){console.error(s)}}async function fw(n,t){try{return await n.getItem(t)||(Pn()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const pw="irn";function Ac(n){return(n==null?void 0:n.relay)||{protocol:pw}}function xo(n){const t=q_[n];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${n}`);return t}var dw=Object.defineProperty,gw=Object.defineProperties,mw=Object.getOwnPropertyDescriptors,_l=Object.getOwnPropertySymbols,yw=Object.prototype.hasOwnProperty,vw=Object.prototype.propertyIsEnumerable,wl=(n,t,r)=>t in n?dw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,_w=(n,t)=>{for(var r in t||(t={}))yw.call(t,r)&&wl(n,r,t[r]);if(_l)for(var r of _l(t))vw.call(t,r)&&wl(n,r,t[r]);return n},ww=(n,t)=>gw(n,mw(t));function bw(n,t="-"){const r={},s="relay"+t;return Object.keys(n).forEach(o=>{if(o.startsWith(s)){const c=o.replace(s,""),l=n[o];r[c]=l}}),r}function bl(n){n=n.includes("wc://")?n.replace("wc://",""):n,n=n.includes("wc:")?n.replace("wc:",""):n;const t=n.indexOf(":"),r=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,t),o=n.substring(t+1,r).split("@"),c=typeof r<"u"?n.substring(r):"",l=Oo.parse(c);return{protocol:s,topic:Ew(o[0]),version:parseInt(o[1],10),symKey:l.symKey,relay:bw(l),expiryTimestamp:l.expiryTimestamp?parseInt(l.expiryTimestamp,10):void 0}}function Ew(n){return n.startsWith("//")?n.substring(2):n}function Iw(n,t="-"){const r="relay",s={};return Object.keys(n).forEach(o=>{const c=r+t+o;n[o]&&(s[c]=n[o])}),s}function xw(n){return`${n.protocol}:${n.topic}@${n.version}?`+Oo.stringify(ww(_w({symKey:n.symKey},Iw(n.relay)),{expiryTimestamp:n.expiryTimestamp}))}function On(n){const t=[];return n.forEach(r=>{const[s,o]=r.split(":");t.push(`${s}:${o}`)}),t}function Sw(n){const t=[];return Object.values(n).forEach(r=>{t.push(...On(r.accounts))}),t}function Pw(n,t){const r=[];return Object.values(n).forEach(s=>{On(s.accounts).includes(t)&&r.push(...s.methods)}),r}function Ow(n,t){const r=[];return Object.values(n).forEach(s=>{On(s.accounts).includes(t)&&r.push(...s.events)}),r}function Xc(n){return n.includes(":")}function Zn(n){return Xc(n)?n.split(":")[0]:n}const Rw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Tw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(n,t){const{message:r,code:s}=Tw[n];return{message:t?`${r} ${t}`:r,code:s}}function Xe(n,t){const{message:r,code:s}=Rw[n];return{message:t?`${r} ${t}`:r,code:s}}function Yr(n,t){return!!Array.isArray(n)}function ns(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function fr(n){return typeof n>"u"}function qt(n,t){return t&&fr(n)?!0:typeof n=="string"&&!!n.trim().length}function Zc(n,t){return typeof n=="number"&&!isNaN(n)}function Cw(n,t){const{requiredNamespaces:r}=t,s=Object.keys(n.namespaces),o=Object.keys(r);let c=!0;return Wi(o,s)?(s.forEach(l=>{const{accounts:g,methods:v,events:d}=n.namespaces[l],w=On(g),P=r[l];(!Wi(Mf(l,P),w)||!Wi(P.methods,v)||!Wi(P.events,d))&&(c=!1)}),c):!1}function To(n){return qt(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function Nw(n){if(qt(n,!1)&&n.includes(":")){const t=n.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&To(r)}}return!1}function Aw(n){if(qt(n,!1))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function $w(n){var t;return(t=n==null?void 0:n.proposer)==null?void 0:t.publicKey}function Dw(n){return n==null?void 0:n.topic}function Lw(n,t){let r=null;return qt(n==null?void 0:n.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function El(n){let t=!0;return Yr(n)?n.length&&(t=n.every(r=>qt(r,!1))):t=!1,t}function Mw(n,t,r){let s=null;return Yr(t)&&t.length?t.forEach(o=>{s||To(o)||(s=Xe("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):To(n)||(s=Xe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function jw(n,t,r){let s=null;return Object.entries(n).forEach(([o,c])=>{if(s)return;const l=Mw(o,Mf(o,c),`${t} ${r}`);l&&(s=l)}),s}function qw(n,t){let r=null;return Yr(n)?n.forEach(s=>{r||Nw(s)||(r=Xe("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=Xe("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Uw(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const o=qw(s==null?void 0:s.accounts,`${t} namespace`);o&&(r=o)}),r}function kw(n,t){let r=null;return El(n==null?void 0:n.methods)?El(n==null?void 0:n.events)||(r=Xe("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=Xe("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Bf(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const o=kw(s,`${t}, namespace`);o&&(r=o)}),r}function zw(n,t,r){let s=null;if(n&&ns(n)){const o=Bf(n,t);o&&(s=o);const c=jw(n,t,r);c&&(s=c)}else s=z("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function pc(n,t){let r=null;if(n&&ns(n)){const s=Bf(n,t);s&&(r=s);const o=Uw(n,t);o&&(r=o)}else r=z("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Vf(n){return qt(n.protocol,!0)}function Hw(n,t){let r=!1;return n?n&&Yr(n)&&n.length&&n.forEach(s=>{r=Vf(s)}):r=!0,r}function Kw(n){return typeof n=="number"}function lr(n){return typeof n<"u"&&typeof n!==null}function Bw(n){return!(!n||typeof n!="object"||!n.code||!Zc(n.code)||!n.message||!qt(n.message,!1))}function Vw(n){return!(fr(n)||!qt(n.method,!1))}function Fw(n){return!(fr(n)||fr(n.result)&&fr(n.error)||!Zc(n.id)||!qt(n.jsonrpc,!1))}function Ww(n){return!(fr(n)||!qt(n.name,!1))}function Il(n,t){return!(!To(t)||!Sw(n).includes(t))}function Gw(n,t,r){return qt(r,!1)?Pw(n,t).includes(r):!1}function Jw(n,t,r){return qt(r,!1)?Ow(n,t).includes(r):!1}function xl(n,t,r){let s=null;const o=Yw(n),c=Qw(t),l=Object.keys(o),g=Object.keys(c),v=Sl(Object.keys(n)),d=Sl(Object.keys(t)),w=v.filter(P=>!d.includes(P));return w.length&&(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${w.toString()}
      Received: ${Object.keys(t).toString()}`)),Wi(l,g)||(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(P=>{if(!P.includes(":")||s)return;const O=On(t[P].accounts);O.includes(P)||(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${P}
        Required: ${P}
        Approved: ${O.toString()}`))}),l.forEach(P=>{s||(Wi(o[P].methods,c[P].methods)?Wi(o[P].events,c[P].events)||(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${P}`)):s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${P}`))}),s}function Yw(n){const t={};return Object.keys(n).forEach(r=>{var s;r.includes(":")?t[r]=n[r]:(s=n[r].chains)==null||s.forEach(o=>{t[o]={methods:n[r].methods,events:n[r].events}})}),t}function Sl(n){return[...new Set(n.map(t=>t.includes(":")?t.split(":")[0]:t))]}function Qw(n){const t={};return Object.keys(n).forEach(r=>{if(r.includes(":"))t[r]=n[r];else{const s=On(n[r].accounts);s==null||s.forEach(o=>{t[o]={accounts:n[r].accounts.filter(c=>c.includes(`${o}:`)),methods:n[r].methods,events:n[r].events}})}}),t}function Xw(n,t){return Zc(n)&&n<=t.max&&n>=t.min}function Pl(){const n=cs();return new Promise(t=>{switch(n){case Er.browser:t(Zw());break;case Er.reactNative:t(e1());break;case Er.node:t(t1());break;default:t(!0)}})}function Zw(){return Pn()&&(navigator==null?void 0:navigator.onLine)}async function e1(){if(Sn()&&typeof global<"u"&&global!=null&&global.NetInfo){const n=await(global==null?void 0:global.NetInfo.fetch());return n==null?void 0:n.isConnected}return!0}function t1(){return!0}function r1(n){switch(cs()){case Er.browser:i1(n);break;case Er.reactNative:n1(n);break}}function i1(n){!Sn()&&Pn()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}function n1(n){Sn()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>n(t==null?void 0:t.isConnected)))}const dc={};let vo=class{static get(t){return dc[t]}static set(t,r){dc[t]=r}static delete(t){delete dc[t]}};const s1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,o1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,a1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function c1(n,t){if(n==="__proto__"||n==="constructor"&&t&&typeof t=="object"&&"prototype"in t){u1(n);return}return t}function u1(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function _o(n,t={}){if(typeof n!="string")return n;const r=n.trim();if(n[0]==='"'&&n.endsWith('"')&&!n.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!a1.test(n)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(s1.test(n)||o1.test(n)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,c1)}return JSON.parse(n)}catch(s){if(t.strict)throw s;return n}}function h1(n){return!n||typeof n.then!="function"?Promise.resolve(n):n}function jt(n,...t){try{return h1(n(...t))}catch(r){return Promise.reject(r)}}function l1(n){const t=typeof n;return n===null||t!=="object"&&t!=="function"}function f1(n){const t=Object.getPrototypeOf(n);return!t||t.isPrototypeOf(Object)}function So(n){if(l1(n))return String(n);if(f1(n)||Array.isArray(n))return JSON.stringify(n);if(typeof n.toJSON=="function")return So(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Ff(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const $c="base64:";function p1(n){if(typeof n=="string")return n;Ff();const t=Buffer.from(n).toString("base64");return $c+t}function d1(n){return typeof n!="string"||!n.startsWith($c)?n:(Ff(),Buffer.from(n.slice($c.length),"base64"))}function hr(n){return n?n.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function g1(...n){return hr(n.join(":"))}function wo(n){return n=hr(n),n?n+":":""}const m1="memory",y1=()=>{const n=new Map;return{name:m1,options:{},hasItem(t){return n.has(t)},getItem(t){return n.get(t)??null},getItemRaw(t){return n.get(t)??null},setItem(t,r){n.set(t,r)},setItemRaw(t,r){n.set(t,r)},removeItem(t){n.delete(t)},getKeys(){return Array.from(n.keys())},clear(){n.clear()},dispose(){n.clear()}}};function v1(n={}){const t={mounts:{"":n.driver||y1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=d=>{for(const w of t.mountpoints)if(d.startsWith(w))return{base:w,relativeKey:d.slice(w.length),driver:t.mounts[w]};return{base:"",relativeKey:d,driver:t.mounts[""]}},s=(d,w)=>t.mountpoints.filter(P=>P.startsWith(d)||w&&d.startsWith(P)).map(P=>({relativeBase:d.length>P.length?d.slice(P.length):void 0,mountpoint:P,driver:t.mounts[P]})),o=(d,w)=>{if(t.watching){w=hr(w);for(const P of t.watchListeners)P(d,w)}},c=async()=>{if(!t.watching){t.watching=!0;for(const d in t.mounts)t.unwatch[d]=await Ol(t.mounts[d],o,d)}},l=async()=>{if(t.watching){for(const d in t.unwatch)await t.unwatch[d]();t.unwatch={},t.watching=!1}},g=(d,w,P)=>{const O=new Map,k=$=>{let X=O.get($.base);return X||(X={driver:$.driver,base:$.base,items:[]},O.set($.base,X)),X};for(const $ of d){const X=typeof $=="string",se=hr(X?$:$.key),oe=X?void 0:$.value,le=X||!$.options?w:{...w,...$.options},ge=r(se);k(ge).items.push({key:se,value:oe,relativeKey:ge.relativeKey,options:le})}return Promise.all([...O.values()].map($=>P($))).then($=>$.flat())},v={hasItem(d,w={}){d=hr(d);const{relativeKey:P,driver:O}=r(d);return jt(O.hasItem,P,w)},getItem(d,w={}){d=hr(d);const{relativeKey:P,driver:O}=r(d);return jt(O.getItem,P,w).then(k=>_o(k))},getItems(d,w){return g(d,w,P=>P.driver.getItems?jt(P.driver.getItems,P.items.map(O=>({key:O.relativeKey,options:O.options})),w).then(O=>O.map(k=>({key:g1(P.base,k.key),value:_o(k.value)}))):Promise.all(P.items.map(O=>jt(P.driver.getItem,O.relativeKey,O.options).then(k=>({key:O.key,value:_o(k)})))))},getItemRaw(d,w={}){d=hr(d);const{relativeKey:P,driver:O}=r(d);return O.getItemRaw?jt(O.getItemRaw,P,w):jt(O.getItem,P,w).then(k=>d1(k))},async setItem(d,w,P={}){if(w===void 0)return v.removeItem(d);d=hr(d);const{relativeKey:O,driver:k}=r(d);k.setItem&&(await jt(k.setItem,O,So(w),P),k.watch||o("update",d))},async setItems(d,w){await g(d,w,async P=>{if(P.driver.setItems)return jt(P.driver.setItems,P.items.map(O=>({key:O.relativeKey,value:So(O.value),options:O.options})),w);P.driver.setItem&&await Promise.all(P.items.map(O=>jt(P.driver.setItem,O.relativeKey,So(O.value),O.options)))})},async setItemRaw(d,w,P={}){if(w===void 0)return v.removeItem(d,P);d=hr(d);const{relativeKey:O,driver:k}=r(d);if(k.setItemRaw)await jt(k.setItemRaw,O,w,P);else if(k.setItem)await jt(k.setItem,O,p1(w),P);else return;k.watch||o("update",d)},async removeItem(d,w={}){typeof w=="boolean"&&(w={removeMeta:w}),d=hr(d);const{relativeKey:P,driver:O}=r(d);O.removeItem&&(await jt(O.removeItem,P,w),(w.removeMeta||w.removeMata)&&await jt(O.removeItem,P+"$",w),O.watch||o("remove",d))},async getMeta(d,w={}){typeof w=="boolean"&&(w={nativeOnly:w}),d=hr(d);const{relativeKey:P,driver:O}=r(d),k=Object.create(null);if(O.getMeta&&Object.assign(k,await jt(O.getMeta,P,w)),!w.nativeOnly){const $=await jt(O.getItem,P+"$",w).then(X=>_o(X));$&&typeof $=="object"&&(typeof $.atime=="string"&&($.atime=new Date($.atime)),typeof $.mtime=="string"&&($.mtime=new Date($.mtime)),Object.assign(k,$))}return k},setMeta(d,w,P={}){return this.setItem(d+"$",w,P)},removeMeta(d,w={}){return this.removeItem(d+"$",w)},async getKeys(d,w={}){d=wo(d);const P=s(d,!0);let O=[];const k=[];for(const $ of P){const se=(await jt($.driver.getKeys,$.relativeBase,w)).map(oe=>$.mountpoint+hr(oe)).filter(oe=>!O.some(le=>oe.startsWith(le)));k.push(...se),O=[$.mountpoint,...O.filter(oe=>!oe.startsWith($.mountpoint))]}return d?k.filter($=>$.startsWith(d)&&!$.endsWith("$")):k.filter($=>!$.endsWith("$"))},async clear(d,w={}){d=wo(d),await Promise.all(s(d,!1).map(async P=>{if(P.driver.clear)return jt(P.driver.clear,P.relativeBase,w);if(P.driver.removeItem){const O=await P.driver.getKeys(P.relativeBase||"",w);return Promise.all(O.map(k=>P.driver.removeItem(k,w)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(d=>Rl(d)))},async watch(d){return await c(),t.watchListeners.push(d),async()=>{t.watchListeners=t.watchListeners.filter(w=>w!==d),t.watchListeners.length===0&&await l()}},async unwatch(){t.watchListeners=[],await l()},mount(d,w){if(d=wo(d),d&&t.mounts[d])throw new Error(`already mounted at ${d}`);return d&&(t.mountpoints.push(d),t.mountpoints.sort((P,O)=>O.length-P.length)),t.mounts[d]=w,t.watching&&Promise.resolve(Ol(w,o,d)).then(P=>{t.unwatch[d]=P}).catch(console.error),v},async unmount(d,w=!0){d=wo(d),!(!d||!t.mounts[d])&&(t.watching&&d in t.unwatch&&(t.unwatch[d](),delete t.unwatch[d]),w&&await Rl(t.mounts[d]),t.mountpoints=t.mountpoints.filter(P=>P!==d),delete t.mounts[d])},getMount(d=""){d=hr(d)+":";const w=r(d);return{driver:w.driver,base:w.base}},getMounts(d="",w={}){return d=hr(d),s(d,w.parents).map(O=>({driver:O.driver,base:O.mountpoint}))}};return v}function Ol(n,t,r){return n.watch?n.watch((s,o)=>t(s,r+o)):()=>{}}async function Rl(n){typeof n.dispose=="function"&&await jt(n.dispose)}function Yi(n){return new Promise((t,r)=>{n.oncomplete=n.onsuccess=()=>t(n.result),n.onabort=n.onerror=()=>r(n.error)})}function Wf(n,t){const r=indexedDB.open(n);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Yi(r);return(o,c)=>s.then(l=>c(l.transaction(t,o).objectStore(t)))}let gc;function us(){return gc||(gc=Wf("keyval-store","keyval")),gc}function Tl(n,t=us()){return t("readonly",r=>Yi(r.get(n)))}function _1(n,t,r=us()){return r("readwrite",s=>(s.put(t,n),Yi(s.transaction)))}function w1(n,t=us()){return t("readwrite",r=>(r.delete(n),Yi(r.transaction)))}function b1(n=us()){return n("readwrite",t=>(t.clear(),Yi(t.transaction)))}function E1(n,t){return n.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Yi(n.transaction)}function I1(n=us()){return n("readonly",t=>{if(t.getAllKeys)return Yi(t.getAllKeys());const r=[];return E1(t,s=>r.push(s.key)).then(()=>r)})}const x1=n=>JSON.stringify(n,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),S1=n=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=n.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function hs(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return S1(n)}catch{return n}}function Gi(n){return typeof n=="string"?n:x1(n)||""}const P1="idb-keyval";var O1=(n={})=>{const t=n.base&&n.base.length>0?`${n.base}:`:"",r=o=>t+o;let s;return n.dbName&&n.storeName&&(s=Wf(n.dbName,n.storeName)),{name:P1,options:n,async hasItem(o){return!(typeof await Tl(r(o),s)>"u")},async getItem(o){return await Tl(r(o),s)??null},setItem(o,c){return _1(r(o),c,s)},removeItem(o){return w1(r(o),s)},getKeys(){return I1(s)},clear(){return b1(s)}}};const R1="WALLET_CONNECT_V2_INDEXED_DB",T1="keyvaluestorage";let C1=class{constructor(){this.indexedDb=v1({driver:O1({dbName:R1,storeName:T1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Gi(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var mc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Po={exports:{}};(function(){let n;function t(){}n=t,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof mc<"u"&&mc.localStorage?Po.exports=mc.localStorage:typeof window<"u"&&window.localStorage?Po.exports=window.localStorage:Po.exports=new t})();function N1(n){var t;return[n[0],hs((t=n[1])!=null?t:"")]}class A1{constructor(){this.localStorage=Po.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(N1)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return hs(r)}async setItem(t,r){this.localStorage.setItem(t,Gi(r))}async removeItem(t){this.localStorage.removeItem(t)}}const $1="wc_storage_version",Cl=1,D1=async(n,t,r)=>{const s=$1,o=await t.getItem(s);if(o&&o>=Cl){r(t);return}const c=await n.getKeys();if(!c.length){r(t);return}const l=[];for(;c.length;){const g=c.shift();if(!g)continue;const v=g.toLowerCase();if(v.includes("wc@")||v.includes("walletconnect")||v.includes("wc_")||v.includes("wallet_connect")){const d=await n.getItem(g);await t.setItem(g,d),l.push(g)}}await t.setItem(s,Cl),r(t),L1(n,l)},L1=async(n,t)=>{t.length&&t.forEach(async r=>{await n.removeItem(r)})};let M1=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new A1;this.storage=t;try{const r=new C1;D1(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var Rn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Dc=function(n,t){return Dc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)s.hasOwnProperty(o)&&(r[o]=s[o])},Dc(n,t)};function j1(n,t){Dc(n,t);function r(){this.constructor=n}n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Lc=function(){return Lc=Object.assign||function(t){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Lc.apply(this,arguments)};function q1(n,t){var r={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(r[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(n);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(n,s[o])&&(r[s[o]]=n[s[o]]);return r}function U1(n,t,r,s){var o=arguments.length,c=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,t,r,s);else for(var g=n.length-1;g>=0;g--)(l=n[g])&&(c=(o<3?l(c):o>3?l(t,r,c):l(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function k1(n,t){return function(r,s){t(r,s,n)}}function z1(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function H1(n,t,r,s){function o(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function g(w){try{d(s.next(w))}catch(P){l(P)}}function v(w){try{d(s.throw(w))}catch(P){l(P)}}function d(w){w.done?c(w.value):o(w.value).then(g,v)}d((s=s.apply(n,t||[])).next())})}function K1(n,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,o,c,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(d){return function(w){return v([d,w])}}function v(d){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,o&&(c=d[0]&2?o.return:d[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,d[1])).done)return c;switch(o=0,c&&(d=[d[0]&2,c.value]),d[0]){case 0:case 1:c=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,o=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!c||d[1]>c[0]&&d[1]<c[3])){r.label=d[1];break}if(d[0]===6&&r.label<c[1]){r.label=c[1],c=d;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(d);break}c[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(n,r)}catch(w){d=[6,w],o=0}finally{s=c=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function B1(n,t,r,s){s===void 0&&(s=r),n[s]=t[r]}function V1(n,t){for(var r in n)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=n[r])}function Mc(n){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&n[t],s=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gf(n,t){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var s=r.call(n),o,c=[],l;try{for(;(t===void 0||t-- >0)&&!(o=s.next()).done;)c.push(o.value)}catch(g){l={error:g}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(l)throw l.error}}return c}function F1(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(Gf(arguments[t]));return n}function W1(){for(var n=0,t=0,r=arguments.length;t<r;t++)n+=arguments[t].length;for(var s=Array(n),o=0,t=0;t<r;t++)for(var c=arguments[t],l=0,g=c.length;l<g;l++,o++)s[o]=c[l];return s}function ss(n){return this instanceof ss?(this.v=n,this):new ss(n)}function G1(n,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(n,t||[]),o,c=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(O){s[O]&&(o[O]=function(k){return new Promise(function($,X){c.push([O,k,$,X])>1||g(O,k)})})}function g(O,k){try{v(s[O](k))}catch($){P(c[0][3],$)}}function v(O){O.value instanceof ss?Promise.resolve(O.value.v).then(d,w):P(c[0][2],O)}function d(O){g("next",O)}function w(O){g("throw",O)}function P(O,k){O(k),c.shift(),c.length&&g(c[0][0],c[0][1])}}function J1(n){var t,r;return t={},s("next"),s("throw",function(o){throw o}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(o,c){t[o]=n[o]?function(l){return(r=!r)?{value:ss(n[o](l)),done:o==="return"}:c?c(l):l}:c}}function Y1(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],r;return t?t.call(n):(n=typeof Mc=="function"?Mc(n):n[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(c){r[c]=n[c]&&function(l){return new Promise(function(g,v){l=n[c](l),o(g,v,l.done,l.value)})}}function o(c,l,g,v){Promise.resolve(v).then(function(d){c({value:d,done:g})},l)}}function Q1(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function X1(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t.default=n,t}function Z1(n){return n&&n.__esModule?n:{default:n}}function eb(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)}function tb(n,t,r){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,r),r}const rb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Lc},__asyncDelegator:J1,__asyncGenerator:G1,__asyncValues:Y1,__await:ss,__awaiter:H1,__classPrivateFieldGet:eb,__classPrivateFieldSet:tb,__createBinding:B1,__decorate:U1,__exportStar:V1,__extends:j1,__generator:K1,__importDefault:Z1,__importStar:X1,__makeTemplateObject:Q1,__metadata:z1,__param:k1,__read:Gf,__rest:q1,__spread:F1,__spreadArrays:W1,__values:Mc},Symbol.toStringTag,{value:"Module"})),Lo=$o(rb);var Gn={},yc={},Jn={};let Qi=class{};const ib=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Qi},Symbol.toStringTag,{value:"Module"})),nb=$o(ib);var Nl;function sb(){if(Nl)return Jn;Nl=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.IHeartBeat=void 0;const n=nb;class t extends n.IEvents{constructor(s){super()}}return Jn.IHeartBeat=t,Jn}var Al;function Jf(){return Al||(Al=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Lo.__exportStar(sb(),n)}(yc)),yc}var vc={},Vi={},$l;function ob(){if($l)return Vi;$l=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.HEARTBEAT_EVENTS=Vi.HEARTBEAT_INTERVAL=void 0;const n=Z;return Vi.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,Vi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Vi}var Dl;function Yf(){return Dl||(Dl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),Lo.__exportStar(ob(),n)}(vc)),vc}var Ll;function ab(){if(Ll)return Gn;Ll=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.HeartBeat=void 0;const n=Lo,t=$r,r=Z,s=Jf(),o=Yf();class c extends s.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||o.HEARTBEAT_INTERVAL}static init(g){return n.__awaiter(this,void 0,void 0,function*(){const v=new c(g);return yield v.init(),v})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,v){this.events.on(g,v)}once(g,v){this.events.once(g,v)}off(g,v){this.events.off(g,v)}removeListener(g,v){this.events.removeListener(g,v)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Gn.HeartBeat=c,Gn}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=Lo;t.__exportStar(ab(),n),t.__exportStar(Jf(),n),t.__exportStar(Yf(),n)})(Rn);var Ee={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var jc=function(n,t){return jc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)s.hasOwnProperty(o)&&(r[o]=s[o])},jc(n,t)};function cb(n,t){jc(n,t);function r(){this.constructor=n}n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var qc=function(){return qc=Object.assign||function(t){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},qc.apply(this,arguments)};function ub(n,t){var r={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(r[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(n);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(n,s[o])&&(r[s[o]]=n[s[o]]);return r}function hb(n,t,r,s){var o=arguments.length,c=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,t,r,s);else for(var g=n.length-1;g>=0;g--)(l=n[g])&&(c=(o<3?l(c):o>3?l(t,r,c):l(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function lb(n,t){return function(r,s){t(r,s,n)}}function fb(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function pb(n,t,r,s){function o(c){return c instanceof r?c:new r(function(l){l(c)})}return new(r||(r=Promise))(function(c,l){function g(w){try{d(s.next(w))}catch(P){l(P)}}function v(w){try{d(s.throw(w))}catch(P){l(P)}}function d(w){w.done?c(w.value):o(w.value).then(g,v)}d((s=s.apply(n,t||[])).next())})}function db(n,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,o,c,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(d){return function(w){return v([d,w])}}function v(d){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,o&&(c=d[0]&2?o.return:d[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,d[1])).done)return c;switch(o=0,c&&(d=[d[0]&2,c.value]),d[0]){case 0:case 1:c=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,o=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!c||d[1]>c[0]&&d[1]<c[3])){r.label=d[1];break}if(d[0]===6&&r.label<c[1]){r.label=c[1],c=d;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(d);break}c[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(n,r)}catch(w){d=[6,w],o=0}finally{s=c=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function gb(n,t,r,s){s===void 0&&(s=r),n[s]=t[r]}function mb(n,t){for(var r in n)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=n[r])}function Uc(n){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&n[t],s=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qf(n,t){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var s=r.call(n),o,c=[],l;try{for(;(t===void 0||t-- >0)&&!(o=s.next()).done;)c.push(o.value)}catch(g){l={error:g}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(l)throw l.error}}return c}function yb(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(Qf(arguments[t]));return n}function vb(){for(var n=0,t=0,r=arguments.length;t<r;t++)n+=arguments[t].length;for(var s=Array(n),o=0,t=0;t<r;t++)for(var c=arguments[t],l=0,g=c.length;l<g;l++,o++)s[o]=c[l];return s}function os(n){return this instanceof os?(this.v=n,this):new os(n)}function _b(n,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(n,t||[]),o,c=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(O){s[O]&&(o[O]=function(k){return new Promise(function($,X){c.push([O,k,$,X])>1||g(O,k)})})}function g(O,k){try{v(s[O](k))}catch($){P(c[0][3],$)}}function v(O){O.value instanceof os?Promise.resolve(O.value.v).then(d,w):P(c[0][2],O)}function d(O){g("next",O)}function w(O){g("throw",O)}function P(O,k){O(k),c.shift(),c.length&&g(c[0][0],c[0][1])}}function wb(n){var t,r;return t={},s("next"),s("throw",function(o){throw o}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(o,c){t[o]=n[o]?function(l){return(r=!r)?{value:os(n[o](l)),done:o==="return"}:c?c(l):l}:c}}function bb(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],r;return t?t.call(n):(n=typeof Uc=="function"?Uc(n):n[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(c){r[c]=n[c]&&function(l){return new Promise(function(g,v){l=n[c](l),o(g,v,l.done,l.value)})}}function o(c,l,g,v){Promise.resolve(v).then(function(d){c({value:d,done:g})},l)}}function Eb(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function Ib(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t.default=n,t}function xb(n){return n&&n.__esModule?n:{default:n}}function Sb(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)}function Pb(n,t,r){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,r),r}const Ob=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return qc},__asyncDelegator:wb,__asyncGenerator:_b,__asyncValues:bb,__await:os,__awaiter:pb,__classPrivateFieldGet:Sb,__classPrivateFieldSet:Pb,__createBinding:gb,__decorate:hb,__exportStar:mb,__extends:cb,__generator:db,__importDefault:xb,__importStar:Ib,__makeTemplateObject:Eb,__metadata:fb,__param:lb,__read:Qf,__rest:ub,__spread:yb,__spreadArrays:vb,__values:Uc},Symbol.toStringTag,{value:"Module"})),Rb=$o(Ob);var Fi={},Ml;function Xf(){return Ml||(Ml=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.PINO_CUSTOM_CONTEXT_KEY=Fi.PINO_LOGGER_DEFAULTS=void 0,Fi.PINO_LOGGER_DEFAULTS={level:"info"},Fi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Fi}var Zt={},jl;function Tb(){if(jl)return Zt;jl=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.generateChildLogger=Zt.formatChildLoggerContext=Zt.getLoggerContext=Zt.setBrowserLoggerContext=Zt.getBrowserLoggerContext=Zt.getDefaultLoggerOptions=void 0;const n=Xf();function t(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||n.PINO_LOGGER_DEFAULTS.level})}Zt.getDefaultLoggerOptions=t;function r(g,v=n.PINO_CUSTOM_CONTEXT_KEY){return g[v]||""}Zt.getBrowserLoggerContext=r;function s(g,v,d=n.PINO_CUSTOM_CONTEXT_KEY){return g[d]=v,g}Zt.setBrowserLoggerContext=s;function o(g,v=n.PINO_CUSTOM_CONTEXT_KEY){let d="";return typeof g.bindings>"u"?d=r(g,v):d=g.bindings().context||"",d}Zt.getLoggerContext=o;function c(g,v,d=n.PINO_CUSTOM_CONTEXT_KEY){const w=o(g,d);return w.trim()?`${w}/${v}`:v}Zt.formatChildLoggerContext=c;function l(g,v,d=n.PINO_CUSTOM_CONTEXT_KEY){const w=c(g,v,d),P=g.child({context:w});return s(P,w,d)}return Zt.generateChildLogger=l,Zt}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.pino=void 0;const t=Rb,r=t.__importDefault(a_);Object.defineProperty(n,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(Xf(),n),t.__exportStar(Tb(),n)})(Ee);class Cb extends Qi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let Nb=class extends Qi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},Ab=class{constructor(t,r){this.logger=t,this.core=r}},$b=class extends Qi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Db=class extends Qi{constructor(t){super()}},Lb=class{constructor(t,r,s,o){this.core=t,this.logger=r,this.name=s}};class Mb extends Qi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let jb=class extends Qi{constructor(t,r){super(),this.core=t,this.logger=r}},qb=class{constructor(t,r){this.projectId=t,this.logger=r}},Ub=class{constructor(t,r){this.projectId=t,this.logger=r}},kb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},zb=class{constructor(t){this.client=t}};var eu={},Zf={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=I_,r=Af;n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var s=function(){function g(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(v,d){if(d===void 0&&(d=v.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var w=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=v[w++],d--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(w=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,v,w,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=v[w++],d--;return this},g.prototype.finish=function(v){if(!this._finished){var d=this._bytesHashed,w=this._bufferLength,P=d/536870912|0,O=d<<3,k=d%128<112?128:256;this._buffer[w]=128;for(var $=w+1;$<k-8;$++)this._buffer[$]=0;t.writeUint32BE(P,this._buffer,k-8),t.writeUint32BE(O,this._buffer,k-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,k),this._finished=!0}for(var $=0;$<this.digestLength/8;$++)t.writeUint32BE(this._stateHi[$],v,$*8),t.writeUint32BE(this._stateLo[$],v,$*8+4);return this},g.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(v){return this._stateHi.set(v.stateHi),this._stateLo.set(v.stateLo),this._bufferLength=v.bufferLength,v.buffer&&this._buffer.set(v.buffer),this._bytesHashed=v.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(v){r.wipe(v.stateHi),r.wipe(v.stateLo),v.buffer&&r.wipe(v.buffer),v.bufferLength=0,v.bytesHashed=0},g}();n.SHA512=s;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(g,v,d,w,P,O,k){for(var $=d[0],X=d[1],se=d[2],oe=d[3],le=d[4],ge=d[5],ve=d[6],ie=d[7],ae=w[0],Y=w[1],Se=w[2],$t=w[3],_t=w[4],ir=w[5],Ft=w[6],dr=w[7],q,U,Ge,Me,W,B,H,V;k>=128;){for(var Tt=0;Tt<16;Tt++){var nt=8*Tt+O;g[Tt]=t.readUint32BE(P,nt),v[Tt]=t.readUint32BE(P,nt+4)}for(var Tt=0;Tt<80;Tt++){var Ci=$,_e=X,Dr=se,N=oe,C=le,R=ge,h=ve,E=ie,J=ae,ne=Y,pe=Se,Pe=$t,Re=_t,we=ir,wt=Ft,pt=dr;if(q=ie,U=dr,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=(le>>>14|_t<<18)^(le>>>18|_t<<14)^(_t>>>9|le<<23),U=(_t>>>14|le<<18)^(_t>>>18|le<<14)^(le>>>9|_t<<23),W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,q=le&ge^~le&ve,U=_t&ir^~_t&Ft,W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,q=o[Tt*2],U=o[Tt*2+1],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,q=g[Tt%16],U=v[Tt%16],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,Ge=H&65535|V<<16,Me=W&65535|B<<16,q=Ge,U=Me,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=($>>>28|ae<<4)^(ae>>>2|$<<30)^(ae>>>7|$<<25),U=(ae>>>28|$<<4)^($>>>2|ae<<30)^($>>>7|ae<<25),W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,q=$&X^$&se^X&se,U=ae&Y^ae&Se^Y&Se,W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,E=H&65535|V<<16,pt=W&65535|B<<16,q=N,U=Pe,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=Ge,U=Me,W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,N=H&65535|V<<16,Pe=W&65535|B<<16,X=Ci,se=_e,oe=Dr,le=N,ge=C,ve=R,ie=h,$=E,Y=J,Se=ne,$t=pe,_t=Pe,ir=Re,Ft=we,dr=wt,ae=pt,Tt%16===15)for(var nt=0;nt<16;nt++)q=g[nt],U=v[nt],W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=g[(nt+9)%16],U=v[(nt+9)%16],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,Ge=g[(nt+1)%16],Me=v[(nt+1)%16],q=(Ge>>>1|Me<<31)^(Ge>>>8|Me<<24)^Ge>>>7,U=(Me>>>1|Ge<<31)^(Me>>>8|Ge<<24)^(Me>>>7|Ge<<25),W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,Ge=g[(nt+14)%16],Me=v[(nt+14)%16],q=(Ge>>>19|Me<<13)^(Me>>>29|Ge<<3)^Ge>>>6,U=(Me>>>19|Ge<<13)^(Ge>>>29|Me<<3)^(Me>>>6|Ge<<26),W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,g[nt]=H&65535|V<<16,v[nt]=W&65535|B<<16}q=$,U=ae,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[0],U=w[0],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[0]=$=H&65535|V<<16,w[0]=ae=W&65535|B<<16,q=X,U=Y,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[1],U=w[1],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[1]=X=H&65535|V<<16,w[1]=Y=W&65535|B<<16,q=se,U=Se,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[2],U=w[2],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[2]=se=H&65535|V<<16,w[2]=Se=W&65535|B<<16,q=oe,U=$t,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[3],U=w[3],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[3]=oe=H&65535|V<<16,w[3]=$t=W&65535|B<<16,q=le,U=_t,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[4],U=w[4],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[4]=le=H&65535|V<<16,w[4]=_t=W&65535|B<<16,q=ge,U=ir,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[5],U=w[5],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[5]=ge=H&65535|V<<16,w[5]=ir=W&65535|B<<16,q=ve,U=Ft,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[6],U=w[6],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[6]=ve=H&65535|V<<16,w[6]=Ft=W&65535|B<<16,q=ie,U=dr,W=U&65535,B=U>>>16,H=q&65535,V=q>>>16,q=d[7],U=w[7],W+=U&65535,B+=U>>>16,H+=q&65535,V+=q>>>16,B+=W>>>16,H+=B>>>16,V+=H>>>16,d[7]=ie=H&65535|V<<16,w[7]=dr=W&65535|B<<16,O+=128,k-=128}return O}function l(g){var v=new s;v.update(g);var d=v.digest();return v.clean(),d}n.hash=l})(Zf);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const t=Do,r=Zf,s=Af;n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function o(N){const C=new Float64Array(16);if(N)for(let R=0;R<N.length;R++)C[R]=N[R];return C}const c=new Uint8Array(32);c[0]=9;const l=o(),g=o([1]),v=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),w=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),P=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),O=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function k(N,C){for(let R=0;R<16;R++)N[R]=C[R]|0}function $(N){let C=1;for(let R=0;R<16;R++){let h=N[R]+C+65535;C=Math.floor(h/65536),N[R]=h-C*65536}N[0]+=C-1+37*(C-1)}function X(N,C,R){const h=~(R-1);for(let E=0;E<16;E++){const J=h&(N[E]^C[E]);N[E]^=J,C[E]^=J}}function se(N,C){const R=o(),h=o();for(let E=0;E<16;E++)h[E]=C[E];$(h),$(h),$(h);for(let E=0;E<2;E++){R[0]=h[0]-65517;for(let ne=1;ne<15;ne++)R[ne]=h[ne]-65535-(R[ne-1]>>16&1),R[ne-1]&=65535;R[15]=h[15]-32767-(R[14]>>16&1);const J=R[15]>>16&1;R[14]&=65535,X(h,R,1-J)}for(let E=0;E<16;E++)N[2*E]=h[E]&255,N[2*E+1]=h[E]>>8}function oe(N,C){let R=0;for(let h=0;h<32;h++)R|=N[h]^C[h];return(1&R-1>>>8)-1}function le(N,C){const R=new Uint8Array(32),h=new Uint8Array(32);return se(R,N),se(h,C),oe(R,h)}function ge(N){const C=new Uint8Array(32);return se(C,N),C[0]&1}function ve(N,C){for(let R=0;R<16;R++)N[R]=C[2*R]+(C[2*R+1]<<8);N[15]&=32767}function ie(N,C,R){for(let h=0;h<16;h++)N[h]=C[h]+R[h]}function ae(N,C,R){for(let h=0;h<16;h++)N[h]=C[h]-R[h]}function Y(N,C,R){let h,E,J=0,ne=0,pe=0,Pe=0,Re=0,we=0,wt=0,pt=0,et=0,Ce=0,Ke=0,Be=0,tt=0,De=0,Ve=0,Oe=0,je=0,st=0,Ae=0,bt=0,Ct=0,Ut=0,kt=0,Dt=0,Wt=0,nr=0,Kr=0,Gt=0,Qr=0,gi=0,Ni=0,ot=R[0],Je=R[1],at=R[2],ct=R[3],rt=R[4],Ye=R[5],Et=R[6],It=R[7],ut=R[8],xt=R[9],ht=R[10],dt=R[11],lt=R[12],He=R[13],St=R[14],Pt=R[15];h=C[0],J+=h*ot,ne+=h*Je,pe+=h*at,Pe+=h*ct,Re+=h*rt,we+=h*Ye,wt+=h*Et,pt+=h*It,et+=h*ut,Ce+=h*xt,Ke+=h*ht,Be+=h*dt,tt+=h*lt,De+=h*He,Ve+=h*St,Oe+=h*Pt,h=C[1],ne+=h*ot,pe+=h*Je,Pe+=h*at,Re+=h*ct,we+=h*rt,wt+=h*Ye,pt+=h*Et,et+=h*It,Ce+=h*ut,Ke+=h*xt,Be+=h*ht,tt+=h*dt,De+=h*lt,Ve+=h*He,Oe+=h*St,je+=h*Pt,h=C[2],pe+=h*ot,Pe+=h*Je,Re+=h*at,we+=h*ct,wt+=h*rt,pt+=h*Ye,et+=h*Et,Ce+=h*It,Ke+=h*ut,Be+=h*xt,tt+=h*ht,De+=h*dt,Ve+=h*lt,Oe+=h*He,je+=h*St,st+=h*Pt,h=C[3],Pe+=h*ot,Re+=h*Je,we+=h*at,wt+=h*ct,pt+=h*rt,et+=h*Ye,Ce+=h*Et,Ke+=h*It,Be+=h*ut,tt+=h*xt,De+=h*ht,Ve+=h*dt,Oe+=h*lt,je+=h*He,st+=h*St,Ae+=h*Pt,h=C[4],Re+=h*ot,we+=h*Je,wt+=h*at,pt+=h*ct,et+=h*rt,Ce+=h*Ye,Ke+=h*Et,Be+=h*It,tt+=h*ut,De+=h*xt,Ve+=h*ht,Oe+=h*dt,je+=h*lt,st+=h*He,Ae+=h*St,bt+=h*Pt,h=C[5],we+=h*ot,wt+=h*Je,pt+=h*at,et+=h*ct,Ce+=h*rt,Ke+=h*Ye,Be+=h*Et,tt+=h*It,De+=h*ut,Ve+=h*xt,Oe+=h*ht,je+=h*dt,st+=h*lt,Ae+=h*He,bt+=h*St,Ct+=h*Pt,h=C[6],wt+=h*ot,pt+=h*Je,et+=h*at,Ce+=h*ct,Ke+=h*rt,Be+=h*Ye,tt+=h*Et,De+=h*It,Ve+=h*ut,Oe+=h*xt,je+=h*ht,st+=h*dt,Ae+=h*lt,bt+=h*He,Ct+=h*St,Ut+=h*Pt,h=C[7],pt+=h*ot,et+=h*Je,Ce+=h*at,Ke+=h*ct,Be+=h*rt,tt+=h*Ye,De+=h*Et,Ve+=h*It,Oe+=h*ut,je+=h*xt,st+=h*ht,Ae+=h*dt,bt+=h*lt,Ct+=h*He,Ut+=h*St,kt+=h*Pt,h=C[8],et+=h*ot,Ce+=h*Je,Ke+=h*at,Be+=h*ct,tt+=h*rt,De+=h*Ye,Ve+=h*Et,Oe+=h*It,je+=h*ut,st+=h*xt,Ae+=h*ht,bt+=h*dt,Ct+=h*lt,Ut+=h*He,kt+=h*St,Dt+=h*Pt,h=C[9],Ce+=h*ot,Ke+=h*Je,Be+=h*at,tt+=h*ct,De+=h*rt,Ve+=h*Ye,Oe+=h*Et,je+=h*It,st+=h*ut,Ae+=h*xt,bt+=h*ht,Ct+=h*dt,Ut+=h*lt,kt+=h*He,Dt+=h*St,Wt+=h*Pt,h=C[10],Ke+=h*ot,Be+=h*Je,tt+=h*at,De+=h*ct,Ve+=h*rt,Oe+=h*Ye,je+=h*Et,st+=h*It,Ae+=h*ut,bt+=h*xt,Ct+=h*ht,Ut+=h*dt,kt+=h*lt,Dt+=h*He,Wt+=h*St,nr+=h*Pt,h=C[11],Be+=h*ot,tt+=h*Je,De+=h*at,Ve+=h*ct,Oe+=h*rt,je+=h*Ye,st+=h*Et,Ae+=h*It,bt+=h*ut,Ct+=h*xt,Ut+=h*ht,kt+=h*dt,Dt+=h*lt,Wt+=h*He,nr+=h*St,Kr+=h*Pt,h=C[12],tt+=h*ot,De+=h*Je,Ve+=h*at,Oe+=h*ct,je+=h*rt,st+=h*Ye,Ae+=h*Et,bt+=h*It,Ct+=h*ut,Ut+=h*xt,kt+=h*ht,Dt+=h*dt,Wt+=h*lt,nr+=h*He,Kr+=h*St,Gt+=h*Pt,h=C[13],De+=h*ot,Ve+=h*Je,Oe+=h*at,je+=h*ct,st+=h*rt,Ae+=h*Ye,bt+=h*Et,Ct+=h*It,Ut+=h*ut,kt+=h*xt,Dt+=h*ht,Wt+=h*dt,nr+=h*lt,Kr+=h*He,Gt+=h*St,Qr+=h*Pt,h=C[14],Ve+=h*ot,Oe+=h*Je,je+=h*at,st+=h*ct,Ae+=h*rt,bt+=h*Ye,Ct+=h*Et,Ut+=h*It,kt+=h*ut,Dt+=h*xt,Wt+=h*ht,nr+=h*dt,Kr+=h*lt,Gt+=h*He,Qr+=h*St,gi+=h*Pt,h=C[15],Oe+=h*ot,je+=h*Je,st+=h*at,Ae+=h*ct,bt+=h*rt,Ct+=h*Ye,Ut+=h*Et,kt+=h*It,Dt+=h*ut,Wt+=h*xt,nr+=h*ht,Kr+=h*dt,Gt+=h*lt,Qr+=h*He,gi+=h*St,Ni+=h*Pt,J+=38*je,ne+=38*st,pe+=38*Ae,Pe+=38*bt,Re+=38*Ct,we+=38*Ut,wt+=38*kt,pt+=38*Dt,et+=38*Wt,Ce+=38*nr,Ke+=38*Kr,Be+=38*Gt,tt+=38*Qr,De+=38*gi,Ve+=38*Ni,E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=ne+E+65535,E=Math.floor(h/65536),ne=h-E*65536,h=pe+E+65535,E=Math.floor(h/65536),pe=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Re+E+65535,E=Math.floor(h/65536),Re=h-E*65536,h=we+E+65535,E=Math.floor(h/65536),we=h-E*65536,h=wt+E+65535,E=Math.floor(h/65536),wt=h-E*65536,h=pt+E+65535,E=Math.floor(h/65536),pt=h-E*65536,h=et+E+65535,E=Math.floor(h/65536),et=h-E*65536,h=Ce+E+65535,E=Math.floor(h/65536),Ce=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Be+E+65535,E=Math.floor(h/65536),Be=h-E*65536,h=tt+E+65535,E=Math.floor(h/65536),tt=h-E*65536,h=De+E+65535,E=Math.floor(h/65536),De=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,J+=E-1+37*(E-1),E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=ne+E+65535,E=Math.floor(h/65536),ne=h-E*65536,h=pe+E+65535,E=Math.floor(h/65536),pe=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Re+E+65535,E=Math.floor(h/65536),Re=h-E*65536,h=we+E+65535,E=Math.floor(h/65536),we=h-E*65536,h=wt+E+65535,E=Math.floor(h/65536),wt=h-E*65536,h=pt+E+65535,E=Math.floor(h/65536),pt=h-E*65536,h=et+E+65535,E=Math.floor(h/65536),et=h-E*65536,h=Ce+E+65535,E=Math.floor(h/65536),Ce=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Be+E+65535,E=Math.floor(h/65536),Be=h-E*65536,h=tt+E+65535,E=Math.floor(h/65536),tt=h-E*65536,h=De+E+65535,E=Math.floor(h/65536),De=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,J+=E-1+37*(E-1),N[0]=J,N[1]=ne,N[2]=pe,N[3]=Pe,N[4]=Re,N[5]=we,N[6]=wt,N[7]=pt,N[8]=et,N[9]=Ce,N[10]=Ke,N[11]=Be,N[12]=tt,N[13]=De,N[14]=Ve,N[15]=Oe}function Se(N,C){Y(N,C,C)}function $t(N,C){const R=o();let h;for(h=0;h<16;h++)R[h]=C[h];for(h=253;h>=0;h--)Se(R,R),h!==2&&h!==4&&Y(R,R,C);for(h=0;h<16;h++)N[h]=R[h]}function _t(N,C){const R=o();let h;for(h=0;h<16;h++)R[h]=C[h];for(h=250;h>=0;h--)Se(R,R),h!==1&&Y(R,R,C);for(h=0;h<16;h++)N[h]=R[h]}function ir(N,C){const R=o(),h=o(),E=o(),J=o(),ne=o(),pe=o(),Pe=o(),Re=o(),we=o();ae(R,N[1],N[0]),ae(we,C[1],C[0]),Y(R,R,we),ie(h,N[0],N[1]),ie(we,C[0],C[1]),Y(h,h,we),Y(E,N[3],C[3]),Y(E,E,d),Y(J,N[2],C[2]),ie(J,J,J),ae(ne,h,R),ae(pe,J,E),ie(Pe,J,E),ie(Re,h,R),Y(N[0],ne,pe),Y(N[1],Re,Pe),Y(N[2],Pe,pe),Y(N[3],ne,Re)}function Ft(N,C,R){for(let h=0;h<4;h++)X(N[h],C[h],R)}function dr(N,C){const R=o(),h=o(),E=o();$t(E,C[2]),Y(R,C[0],E),Y(h,C[1],E),se(N,h),N[31]^=ge(R)<<7}function q(N,C,R){k(N[0],l),k(N[1],g),k(N[2],g),k(N[3],l);for(let h=255;h>=0;--h){const E=R[h/8|0]>>(h&7)&1;Ft(N,C,E),ir(C,N),ir(N,N),Ft(N,C,E)}}function U(N,C){const R=[o(),o(),o(),o()];k(R[0],w),k(R[1],P),k(R[2],g),Y(R[3],w,P),q(N,R,C)}function Ge(N){if(N.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const C=(0,r.hash)(N);C[0]&=248,C[31]&=127,C[31]|=64;const R=new Uint8Array(32),h=[o(),o(),o(),o()];U(h,C),dr(R,h);const E=new Uint8Array(64);return E.set(N),E.set(R,32),{publicKey:R,secretKey:E}}n.generateKeyPairFromSeed=Ge;function Me(N){const C=(0,t.randomBytes)(32,N),R=Ge(C);return(0,s.wipe)(C),R}n.generateKeyPair=Me;function W(N){if(N.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(N.subarray(32))}n.extractPublicKeyFromSecretKey=W;const B=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function H(N,C){let R,h,E,J;for(h=63;h>=32;--h){for(R=0,E=h-32,J=h-12;E<J;++E)C[E]+=R-16*C[h]*B[E-(h-32)],R=Math.floor((C[E]+128)/256),C[E]-=R*256;C[E]+=R,C[h]=0}for(R=0,E=0;E<32;E++)C[E]+=R-(C[31]>>4)*B[E],R=C[E]>>8,C[E]&=255;for(E=0;E<32;E++)C[E]-=R*B[E];for(h=0;h<32;h++)C[h+1]+=C[h]>>8,N[h]=C[h]&255}function V(N){const C=new Float64Array(64);for(let R=0;R<64;R++)C[R]=N[R];for(let R=0;R<64;R++)N[R]=0;H(N,C)}function Tt(N,C){const R=new Float64Array(64),h=[o(),o(),o(),o()],E=(0,r.hash)(N.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const J=new Uint8Array(64);J.set(E.subarray(32),32);const ne=new r.SHA512;ne.update(J.subarray(32)),ne.update(C);const pe=ne.digest();ne.clean(),V(pe),U(h,pe),dr(J,h),ne.reset(),ne.update(J.subarray(0,32)),ne.update(N.subarray(32)),ne.update(C);const Pe=ne.digest();V(Pe);for(let Re=0;Re<32;Re++)R[Re]=pe[Re];for(let Re=0;Re<32;Re++)for(let we=0;we<32;we++)R[Re+we]+=Pe[Re]*E[we];return H(J.subarray(32),R),J}n.sign=Tt;function nt(N,C){const R=o(),h=o(),E=o(),J=o(),ne=o(),pe=o(),Pe=o();return k(N[2],g),ve(N[1],C),Se(E,N[1]),Y(J,E,v),ae(E,E,N[2]),ie(J,N[2],J),Se(ne,J),Se(pe,ne),Y(Pe,pe,ne),Y(R,Pe,E),Y(R,R,J),_t(R,R),Y(R,R,E),Y(R,R,J),Y(R,R,J),Y(N[0],R,J),Se(h,N[0]),Y(h,h,J),le(h,E)&&Y(N[0],N[0],O),Se(h,N[0]),Y(h,h,J),le(h,E)?-1:(ge(N[0])===C[31]>>7&&ae(N[0],l,N[0]),Y(N[3],N[0],N[1]),0)}function Ci(N,C,R){const h=new Uint8Array(32),E=[o(),o(),o(),o()],J=[o(),o(),o(),o()];if(R.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(nt(J,N))return!1;const ne=new r.SHA512;ne.update(R.subarray(0,32)),ne.update(N),ne.update(C);const pe=ne.digest();return V(pe),q(E,J,pe),U(J,R.subarray(32)),ir(E,J),dr(h,E),!oe(R,h)}n.verify=Ci;function _e(N){let C=[o(),o(),o(),o()];if(nt(C,N))throw new Error("Ed25519: invalid public key");let R=o(),h=o(),E=C[1];ie(R,g,E),ae(h,g,E),$t(h,h),Y(R,R,h);let J=new Uint8Array(32);return se(J,R),J}n.convertPublicKeyToX25519=_e;function Dr(N){const C=(0,r.hash)(N.subarray(0,32));C[0]&=248,C[31]&=127,C[31]|=64;const R=new Uint8Array(C.subarray(0,32));return(0,s.wipe)(C),R}n.convertSecretKeyToX25519=Dr})(eu);const Hb="EdDSA",Kb="JWT",ep=".",tp="base64url",Bb="utf8",Vb="utf8",Fb=":",Wb="did",Gb="key",ql="base58btc",Jb="z",Yb="K36",Qb=32;function Co(n){return rr(pr(Gi(n),Bb),tp)}function rp(n){const t=pr(Yb,ql),r=Jb+rr(Rc([t,n]),ql);return[Wb,Gb,r].join(Fb)}function Xb(n){return rr(n,tp)}function Zb(n){return pr([Co(n.header),Co(n.payload)].join(ep),Vb)}function eE(n){return[Co(n.header),Co(n.payload),Xb(n.signature)].join(ep)}function Ul(n=Do.randomBytes(Qb)){return eu.generateKeyPairFromSeed(n)}async function tE(n,t,r,s,o=Z.fromMiliseconds(Date.now())){const c={alg:Hb,typ:Kb},l=rp(s.publicKey),g=o+r,v={iss:l,sub:n,aud:t,iat:o,exp:g},d=Zb({header:c,payload:v}),w=eu.sign(s.secretKey,d);return eE({header:c,payload:v,signature:w})}const rE="PARSE_ERROR",iE="INVALID_REQUEST",nE="METHOD_NOT_FOUND",sE="INVALID_PARAMS",ip="INTERNAL_ERROR",tu="SERVER_ERROR",oE=[-32700,-32600,-32601,-32602,-32603],rs={[rE]:{code:-32700,message:"Parse error"},[iE]:{code:-32600,message:"Invalid Request"},[nE]:{code:-32601,message:"Method not found"},[sE]:{code:-32602,message:"Invalid params"},[ip]:{code:-32603,message:"Internal error"},[tu]:{code:-32e3,message:"Server error"}},np=tu;function aE(n){return oE.includes(n)}function kl(n){return Object.keys(rs).includes(n)?rs[n]:rs[np]}function cE(n){const t=Object.values(rs).find(r=>r.code===n);return t||rs[np]}function sp(n,t,r){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):n}function ru(n=3){const t=Date.now()*Math.pow(10,n),r=Math.floor(Math.random()*Math.pow(10,n));return t+r}function op(n=6){return BigInt(ru(n))}function xn(n,t,r){return{id:r||ru(),jsonrpc:"2.0",method:n,params:t}}function Mo(n,t){return{id:n,jsonrpc:"2.0",result:t}}function jo(n,t,r){return{id:n,jsonrpc:"2.0",error:uE(t)}}function uE(n,t){return typeof n>"u"?kl(ip):(typeof n=="string"&&(n=Object.assign(Object.assign({},kl(tu)),{message:n})),aE(n.code)&&(n=cE(n.code)),n)}class hE{}class lE extends hE{constructor(){super()}}class fE extends lE{constructor(t){super()}}const pE="^https?:",dE="^wss?:";function gE(n){const t=n.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function ap(n,t){const r=gE(n);return typeof r>"u"?!1:new RegExp(t).test(r)}function zl(n){return ap(n,pE)}function Hl(n){return ap(n,dE)}function mE(n){return new RegExp("wss?://localhost(:d{2,5})?").test(n)}function cp(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function iu(n){return cp(n)&&"method"in n}function qo(n){return cp(n)&&(fi(n)||Hr(n))}function fi(n){return"result"in n}function Hr(n){return"error"in n}class pi extends fE{constructor(t){super(t),this.events=new $r.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xn(t.method,t.params||[],t.id||op().toString()),r)}async requestStrict(t,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{Hr(c)?o(c.error):s(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),qo(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const yE=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),vE=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Kl=n=>n.split("?")[0],Bl=10,_E=yE();let wE=class{constructor(t){if(this.url=t,this.events=new $r.EventEmitter,this.registering=!1,!Hl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Gi(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Hl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const o=new URLSearchParams(t).get("origin"),c=c_.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!mE(t)},l=new _E(t,[],c);vE()?l.onerror=g=>{const v=g;s(this.emitError(v.error))}:l.on("error",g=>{s(this.emitError(g))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?hs(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),o=s.message||s.toString(),c=jo(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return sp(t,Kl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Bl&&this.events.setMaxListeners(Bl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Kl(this.url)}`));return this.events.emit("register_error",r),r}};var No={exports:{}};No.exports;(function(n,t){var r=200,s="__lodash_hash_undefined__",o=1,c=2,l=9007199254740991,g="[object Arguments]",v="[object Array]",d="[object AsyncFunction]",w="[object Boolean]",P="[object Date]",O="[object Error]",k="[object Function]",$="[object GeneratorFunction]",X="[object Map]",se="[object Number]",oe="[object Null]",le="[object Object]",ge="[object Promise]",ve="[object Proxy]",ie="[object RegExp]",ae="[object Set]",Y="[object String]",Se="[object Symbol]",$t="[object Undefined]",_t="[object WeakMap]",ir="[object ArrayBuffer]",Ft="[object DataView]",dr="[object Float32Array]",q="[object Float64Array]",U="[object Int8Array]",Ge="[object Int16Array]",Me="[object Int32Array]",W="[object Uint8Array]",B="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",Tt=/[\\^$.*+?()[\]{}|]/g,nt=/^\[object .+?Constructor\]$/,Ci=/^(?:0|[1-9]\d*)$/,_e={};_e[dr]=_e[q]=_e[U]=_e[Ge]=_e[Me]=_e[W]=_e[B]=_e[H]=_e[V]=!0,_e[g]=_e[v]=_e[ir]=_e[w]=_e[Ft]=_e[P]=_e[O]=_e[k]=_e[X]=_e[se]=_e[le]=_e[ie]=_e[ae]=_e[Y]=_e[_t]=!1;var Dr=typeof yo=="object"&&yo&&yo.Object===Object&&yo,N=typeof self=="object"&&self&&self.Object===Object&&self,C=Dr||N||Function("return this")(),R=t&&!t.nodeType&&t,h=R&&!0&&n&&!n.nodeType&&n,E=h&&h.exports===R,J=E&&Dr.process,ne=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),pe=ne&&ne.isTypedArray;function Pe(y,I){for(var M=-1,F=y==null?0:y.length,Ue=0,ue=[];++M<F;){var Fe=y[M];I(Fe,M,y)&&(ue[Ue++]=Fe)}return ue}function Re(y,I){for(var M=-1,F=I.length,Ue=y.length;++M<F;)y[Ue+M]=I[M];return y}function we(y,I){for(var M=-1,F=y==null?0:y.length;++M<F;)if(I(y[M],M,y))return!0;return!1}function wt(y,I){for(var M=-1,F=Array(y);++M<y;)F[M]=I(M);return F}function pt(y){return function(I){return y(I)}}function et(y,I){return y.has(I)}function Ce(y,I){return y==null?void 0:y[I]}function Ke(y){var I=-1,M=Array(y.size);return y.forEach(function(F,Ue){M[++I]=[Ue,F]}),M}function Be(y,I){return function(M){return y(I(M))}}function tt(y){var I=-1,M=Array(y.size);return y.forEach(function(F){M[++I]=F}),M}var De=Array.prototype,Ve=Function.prototype,Oe=Object.prototype,je=C["__core-js_shared__"],st=Ve.toString,Ae=Oe.hasOwnProperty,bt=function(){var y=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Ct=Oe.toString,Ut=RegExp("^"+st.call(Ae).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=E?C.Buffer:void 0,Dt=C.Symbol,Wt=C.Uint8Array,nr=Oe.propertyIsEnumerable,Kr=De.splice,Gt=Dt?Dt.toStringTag:void 0,Qr=Object.getOwnPropertySymbols,gi=kt?kt.isBuffer:void 0,Ni=Be(Object.keys,Object),ot=gr(C,"DataView"),Je=gr(C,"Map"),at=gr(C,"Promise"),ct=gr(C,"Set"),rt=gr(C,"WeakMap"),Ye=gr(Object,"create"),Et=Zr(ot),It=Zr(Je),ut=Zr(at),xt=Zr(ct),ht=Zr(rt),dt=Dt?Dt.prototype:void 0,lt=dt?dt.valueOf:void 0;function He(y){var I=-1,M=y==null?0:y.length;for(this.clear();++I<M;){var F=y[I];this.set(F[0],F[1])}}function St(){this.__data__=Ye?Ye(null):{},this.size=0}function Pt(y){var I=this.has(y)&&delete this.__data__[y];return this.size-=I?1:0,I}function zo(y){var I=this.__data__;if(Ye){var M=I[y];return M===s?void 0:M}return Ae.call(I,y)?I[y]:void 0}function Ho(y){var I=this.__data__;return Ye?I[y]!==void 0:Ae.call(I,y)}function Ko(y,I){var M=this.__data__;return this.size+=this.has(y)?0:1,M[y]=Ye&&I===void 0?s:I,this}He.prototype.clear=St,He.prototype.delete=Pt,He.prototype.get=zo,He.prototype.has=Ho,He.prototype.set=Ko;function Ir(y){var I=-1,M=y==null?0:y.length;for(this.clear();++I<M;){var F=y[I];this.set(F[0],F[1])}}function Bo(){this.__data__=[],this.size=0}function Vo(y){var I=this.__data__,M=Ai(I,y);if(M<0)return!1;var F=I.length-1;return M==F?I.pop():Kr.call(I,M,1),--this.size,!0}function Fo(y){var I=this.__data__,M=Ai(I,y);return M<0?void 0:I[M][1]}function Wo(y){return Ai(this.__data__,y)>-1}function Go(y,I){var M=this.__data__,F=Ai(M,y);return F<0?(++this.size,M.push([y,I])):M[F][1]=I,this}Ir.prototype.clear=Bo,Ir.prototype.delete=Vo,Ir.prototype.get=Fo,Ir.prototype.has=Wo,Ir.prototype.set=Go;function Xr(y){var I=-1,M=y==null?0:y.length;for(this.clear();++I<M;){var F=y[I];this.set(F[0],F[1])}}function Zi(){this.size=0,this.__data__={hash:new He,map:new(Je||Ir),string:new He}}function Jo(y){var I=mi(this,y).delete(y);return this.size-=I?1:0,I}function en(y){return mi(this,y).get(y)}function Yo(y){return mi(this,y).has(y)}function Qo(y,I){var M=mi(this,y),F=M.size;return M.set(y,I),this.size+=M.size==F?0:1,this}Xr.prototype.clear=Zi,Xr.prototype.delete=Jo,Xr.prototype.get=en,Xr.prototype.has=Yo,Xr.prototype.set=Qo;function tn(y){var I=-1,M=y==null?0:y.length;for(this.__data__=new Xr;++I<M;)this.add(y[I])}function fs(y){return this.__data__.set(y,s),this}function ps(y){return this.__data__.has(y)}tn.prototype.add=tn.prototype.push=fs,tn.prototype.has=ps;function Lr(y){var I=this.__data__=new Ir(y);this.size=I.size}function Xo(){this.__data__=new Ir,this.size=0}function Zo(y){var I=this.__data__,M=I.delete(y);return this.size=I.size,M}function ea(y){return this.__data__.get(y)}function ta(y){return this.__data__.has(y)}function ds(y,I){var M=this.__data__;if(M instanceof Ir){var F=M.__data__;if(!Je||F.length<r-1)return F.push([y,I]),this.size=++M.size,this;M=this.__data__=new Xr(F)}return M.set(y,I),this.size=M.size,this}Lr.prototype.clear=Xo,Lr.prototype.delete=Zo,Lr.prototype.get=ea,Lr.prototype.has=ta,Lr.prototype.set=ds;function gs(y,I){var M=sn(y),F=!M&&Os(y),Ue=!M&&!F&&Nn(y),ue=!M&&!F&&!Ue&&Cs(y),Fe=M||F||Ue||ue,Ot=Fe?wt(y.length,String):[],Ie=Ot.length;for(var ke in y)Ae.call(y,ke)&&!(Fe&&(ke=="length"||Ue&&(ke=="offset"||ke=="parent")||ue&&(ke=="buffer"||ke=="byteLength"||ke=="byteOffset")||Es(ke,Ie)))&&Ot.push(ke);return Ot}function Ai(y,I){for(var M=y.length;M--;)if(Ps(y[M][0],I))return M;return-1}function Tn(y,I,M){var F=I(y);return sn(y)?F:Re(F,M(y))}function $i(y){return y==null?y===void 0?$t:oe:Gt&&Gt in Object(y)?ws(y):na(y)}function Cn(y){return Li(y)&&$i(y)==g}function Di(y,I,M,F,Ue){return y===I?!0:y==null||I==null||!Li(y)&&!Li(I)?y!==y&&I!==I:ms(y,I,M,F,Di,Ue)}function ms(y,I,M,F,Ue,ue){var Fe=sn(y),Ot=sn(I),Ie=Fe?v:Br(y),ke=Ot?v:Br(I);Ie=Ie==g?le:Ie,ke=ke==g?le:ke;var gt=Ie==le,sr=ke==le,Rt=Ie==ke;if(Rt&&Nn(y)){if(!Nn(I))return!1;Fe=!0,gt=!1}if(Rt&&!gt)return ue||(ue=new Lr),Fe||Cs(y)?rn(y,I,M,F,Ue,ue):ia(y,I,Ie,M,F,Ue,ue);if(!(M&o)){var We=gt&&Ae.call(y,"__wrapped__"),Jt=sr&&Ae.call(I,"__wrapped__");if(We||Jt){var Mr=We?y.value():y,xr=Jt?I.value():I;return ue||(ue=new Lr),Ue(Mr,xr,M,F,ue)}}return Rt?(ue||(ue=new Lr),_s(y,I,M,F,Ue,ue)):!1}function ra(y){if(!Ts(y)||xs(y))return!1;var I=on(y)?Ut:nt;return I.test(Zr(y))}function ys(y){return Li(y)&&Rs(y.length)&&!!_e[$i(y)]}function vs(y){if(!Ss(y))return Ni(y);var I=[];for(var M in Object(y))Ae.call(y,M)&&M!="constructor"&&I.push(M);return I}function rn(y,I,M,F,Ue,ue){var Fe=M&o,Ot=y.length,Ie=I.length;if(Ot!=Ie&&!(Fe&&Ie>Ot))return!1;var ke=ue.get(y);if(ke&&ue.get(I))return ke==I;var gt=-1,sr=!0,Rt=M&c?new tn:void 0;for(ue.set(y,I),ue.set(I,y);++gt<Ot;){var We=y[gt],Jt=I[gt];if(F)var Mr=Fe?F(Jt,We,gt,I,y,ue):F(We,Jt,gt,y,I,ue);if(Mr!==void 0){if(Mr)continue;sr=!1;break}if(Rt){if(!we(I,function(xr,Vr){if(!et(Rt,Vr)&&(We===xr||Ue(We,xr,M,F,ue)))return Rt.push(Vr)})){sr=!1;break}}else if(!(We===Jt||Ue(We,Jt,M,F,ue))){sr=!1;break}}return ue.delete(y),ue.delete(I),sr}function ia(y,I,M,F,Ue,ue,Fe){switch(M){case Ft:if(y.byteLength!=I.byteLength||y.byteOffset!=I.byteOffset)return!1;y=y.buffer,I=I.buffer;case ir:return!(y.byteLength!=I.byteLength||!ue(new Wt(y),new Wt(I)));case w:case P:case se:return Ps(+y,+I);case O:return y.name==I.name&&y.message==I.message;case ie:case Y:return y==I+"";case X:var Ot=Ke;case ae:var Ie=F&o;if(Ot||(Ot=tt),y.size!=I.size&&!Ie)return!1;var ke=Fe.get(y);if(ke)return ke==I;F|=c,Fe.set(y,I);var gt=rn(Ot(y),Ot(I),F,Ue,ue,Fe);return Fe.delete(y),gt;case Se:if(lt)return lt.call(y)==lt.call(I)}return!1}function _s(y,I,M,F,Ue,ue){var Fe=M&o,Ot=nn(y),Ie=Ot.length,ke=nn(I),gt=ke.length;if(Ie!=gt&&!Fe)return!1;for(var sr=Ie;sr--;){var Rt=Ot[sr];if(!(Fe?Rt in I:Ae.call(I,Rt)))return!1}var We=ue.get(y);if(We&&ue.get(I))return We==I;var Jt=!0;ue.set(y,I),ue.set(I,y);for(var Mr=Fe;++sr<Ie;){Rt=Ot[sr];var xr=y[Rt],Vr=I[Rt];if(F)var An=Fe?F(Vr,xr,Rt,I,y,ue):F(xr,Vr,Rt,y,I,ue);if(!(An===void 0?xr===Vr||Ue(xr,Vr,M,F,ue):An)){Jt=!1;break}Mr||(Mr=Rt=="constructor")}if(Jt&&!Mr){var Mi=y.constructor,Lt=I.constructor;Mi!=Lt&&"constructor"in y&&"constructor"in I&&!(typeof Mi=="function"&&Mi instanceof Mi&&typeof Lt=="function"&&Lt instanceof Lt)&&(Jt=!1)}return ue.delete(y),ue.delete(I),Jt}function nn(y){return Tn(y,aa,bs)}function mi(y,I){var M=y.__data__;return Is(I)?M[typeof I=="string"?"string":"hash"]:M.map}function gr(y,I){var M=Ce(y,I);return ra(M)?M:void 0}function ws(y){var I=Ae.call(y,Gt),M=y[Gt];try{y[Gt]=void 0;var F=!0}catch{}var Ue=Ct.call(y);return F&&(I?y[Gt]=M:delete y[Gt]),Ue}var bs=Qr?function(y){return y==null?[]:(y=Object(y),Pe(Qr(y),function(I){return nr.call(y,I)}))}:qe,Br=$i;(ot&&Br(new ot(new ArrayBuffer(1)))!=Ft||Je&&Br(new Je)!=X||at&&Br(at.resolve())!=ge||ct&&Br(new ct)!=ae||rt&&Br(new rt)!=_t)&&(Br=function(y){var I=$i(y),M=I==le?y.constructor:void 0,F=M?Zr(M):"";if(F)switch(F){case Et:return Ft;case It:return X;case ut:return ge;case xt:return ae;case ht:return _t}return I});function Es(y,I){return I=I??l,!!I&&(typeof y=="number"||Ci.test(y))&&y>-1&&y%1==0&&y<I}function Is(y){var I=typeof y;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?y!=="__proto__":y===null}function xs(y){return!!bt&&bt in y}function Ss(y){var I=y&&y.constructor,M=typeof I=="function"&&I.prototype||Oe;return y===M}function na(y){return Ct.call(y)}function Zr(y){if(y!=null){try{return st.call(y)}catch{}try{return y+""}catch{}}return""}function Ps(y,I){return y===I||y!==y&&I!==I}var Os=Cn(function(){return arguments}())?Cn:function(y){return Li(y)&&Ae.call(y,"callee")&&!nr.call(y,"callee")},sn=Array.isArray;function sa(y){return y!=null&&Rs(y.length)&&!on(y)}var Nn=gi||Le;function oa(y,I){return Di(y,I)}function on(y){if(!Ts(y))return!1;var I=$i(y);return I==k||I==$||I==d||I==ve}function Rs(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=l}function Ts(y){var I=typeof y;return y!=null&&(I=="object"||I=="function")}function Li(y){return y!=null&&typeof y=="object"}var Cs=pe?pt(pe):ys;function aa(y){return sa(y)?gs(y):vs(y)}function qe(){return[]}function Le(){return!1}n.exports=oa})(No,No.exports);var bE=No.exports;const EE=Of(bE);function IE(n,t){return t=t||{},new Promise(function(r,s){var o=new XMLHttpRequest,c=[],l=[],g={},v=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:v,headers:{keys:function(){return c},entries:function(){return l},get:function(w){return g[w.toLowerCase()]},has:function(w){return w.toLowerCase()in g}}}};for(var d in o.open(t.method||"get",n,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(w,P,O){c.push(P=P.toLowerCase()),l.push([P,O]),g[P]=g[P]?g[P]+","+O:O}),r(v())},o.onerror=s,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(d,t.headers[d]);o.send(t.body||null)})}const xE=Object.freeze(Object.defineProperty({__proto__:null,default:IE},Symbol.toStringTag,{value:"Module"})),Vl=$o(xE);var SE=self.fetch||(self.fetch=Vl.default||Vl);const PE=Of(SE);var OE={LESSOPEN:"| /usr/bin/lesspipe %s",npm_package_devDependencies__types_node:"^18.19.3",npm_package_dependencies__wagmi_cli:"^2.1.4",npm_package_dependencies__vitejs_plugin_react:"^4.2.1",USER:"anstak",npm_package_dependencies_react_toastify:"^10.0.5",npm_config_version_commit_hooks:"true",npm_config_user_agent:"yarn/1.22.19 npm/? node/v18.20.2 linux x64",COMP_WORDBREAKS:` 	
"'><;|&(:`,npm_package_scripts_vite_dev:"vite",npm_config_bin_links:"true",GIT_ASKPASS:"/home/anstak/.vscode-server/bin/b58957e67ee1e712cebf466b995adf4c5307b2bd/extensions/git/dist/askpass.sh",BUN_INSTALL:"/home/anstak/.bun",npm_node_execpath:"/home/anstak/.nvm/versions/node/v18.20.2/bin/node",npm_package_devDependencies_eslint_config_next:"^14.1.3",npm_config_init_version:"1.0.0",SHLVL:"1",npm_package_packageManager:"yarn@1.22.19",npm_package_dependencies_wagmi:"^2.5.11",npm_package_dependencies_react_babylonjs:"^3.1.30",npm_package_dependencies_babylonjs_gltf2interface:"^6.49.0",HOME:"/home/anstak",TERM_PROGRAM_VERSION:"1.89.0",NVM_BIN:"/home/anstak/.nvm/versions/node/v18.20.2/bin",VSCODE_IPC_HOOK_CLI:"/mnt/wslg/runtime-dir/vscode-ipc-c2acbc6e-eb65-4465-a59a-f065d69789a0.sock",npm_package_dependencies__babylonjs_loaders:"^6.49.0",NVM_INC:"/home/anstak/.nvm/versions/node/v18.20.2/include/node",COREPACK_ROOT:"/usr/lib/node_modules/corepack",npm_package_dependencies_framer_motion:"^11.1.7",npm_config_init_license:"MIT",VSCODE_GIT_ASKPASS_MAIN:"/home/anstak/.vscode-server/bin/b58957e67ee1e712cebf466b995adf4c5307b2bd/extensions/git/dist/askpass-main.js",YARN_WRAP_OUTPUT:"false",npm_package_dependencies__rainbow_me_rainbowkit:"^2.0.5",npm_config_version_tag_prefix:"v",VSCODE_GIT_ASKPASS_NODE:"/home/anstak/.vscode-server/bin/b58957e67ee1e712cebf466b995adf4c5307b2bd/node",npm_package_dependencies__babylonjs_inspector:"^6.49.0",npm_package_dependencies_dotenv:"^16.4.5",COLORTERM:"truecolor",WSL_DISTRO_NAME:"Ubuntu-20.04",npm_package_description:"First, run the development server:",npm_package_devDependencies_typescript:"5.4.2",NVM_DIR:"/home/anstak/.nvm",npm_package_readmeFilename:"README.md",npm_package_devDependencies__types_react_dom:"^18.2.22",WAYLAND_DISPLAY:"wayland-0",npm_package_scripts_dev:"next dev",LOGNAME:"anstak",npm_package_dependencies_zustand:"^4.5.2",npm_package_dependencies__babylonjs_gui:"^6.49.0",NAME:"DESKTOP-6EULP0M",WSL_INTEROP:"/run/WSL/18337_interop",PULSE_SERVER:"/mnt/wslg/PulseServer",_:"/usr/bin/yarn",npm_package_dependencies__babylonjs_gui_editor:"^6.49.0",npm_package_private:"true",npm_package_scripts_vite_build:"tsc && vite build",npm_package_scripts_lint:"next lint",npm_config_registry:"https://registry.yarnpkg.com",TERM:"xterm-256color",npm_package_scripts_start:"next start",npm_config_ignore_scripts:"",PATH:"/tmp/yarn--1715850293528-0.538224866057931:/home/anstak/erc20/jet-app/node_modules/.bin:/home/anstak/.config/yarn/link/node_modules/.bin:/home/anstak/.yarn/bin:/home/anstak/.nvm/versions/node/v18.20.2/libexec/lib/node_modules/npm/bin/node-gyp-bin:/home/anstak/.nvm/versions/node/v18.20.2/lib/node_modules/npm/bin/node-gyp-bin:/home/anstak/.nvm/versions/node/v18.20.2/bin/node_modules/npm/bin/node-gyp-bin:/home/anstak/.bun/bin:/home/anstak/.turso:/home/anstak/.nvm/versions/node/v18.20.2/bin:/home/anstak/.cargo/bin:/home/anstak/.vscode-server/bin/b58957e67ee1e712cebf466b995adf4c5307b2bd/bin/remote-cli:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Python310/Scripts/:/mnt/c/Python310/:/mnt/c/WINDOWS/system32:/mnt/c/WINDOWS:/mnt/c/WINDOWS/System32/Wbem:/mnt/c/WINDOWS/System32/WindowsPowerShell/v1.0/:/mnt/c/WINDOWS/System32/OpenSSH/:/mnt/c/Program Files/Git/cmd:/mnt/c/Program Files/nodejs/:/mnt/c/ProgramData/chocolatey/bin:/mnt/c/Program Files (x86)/NVIDIA Corporation/PhysX/Common:/Docker/host/bin:/mnt/c/Program Files/dotnet/:/mnt/c/Users/user/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/user/AppData/Local/Programs/Microsoft VS Code/bin:/mnt/c/Users/user/AppData/Roaming/npm:/snap/bin",NODE:"/home/anstak/.nvm/versions/node/v18.20.2/bin/node",npm_package_name:"jet-app",XDG_RUNTIME_DIR:"/mnt/wslg/runtime-dir",npm_package_dependencies_viem:"^2.8.12",DISPLAY:":0",npm_package_devDependencies__types_react_modal:"^3.16.3",LANG:"C.UTF-8",npm_package_devDependencies_eslint:"^8.15.0",npm_package_dependencies_react_dom:"^18.2.0",LS_COLORS:"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:",VSCODE_GIT_IPC_HANDLE:"/mnt/wslg/runtime-dir/vscode-git-e4010be119.sock",TERM_PROGRAM:"vscode",npm_lifecycle_script:"tsc && vite build",npm_package_dependencies_react_cookie:"^7.1.4",npm_config_version_git_message:"v%s",SHELL:"/bin/bash",npm_lifecycle_event:"vite:build",npm_package_devDependencies__types_react:"^18.2.64",npm_package_version:"0.1.0",npm_config_argv:'{"remain":[],"cooked":["run","vite:build"],"original":["vite:build"]}',npm_package_dependencies__twa_dev_sdk:"^7.0.0",npm_package_dependencies__babylonjs_materials:"^6.49.0",npm_package_scripts_build:"next build",npm_config_strict_peer_dependencies:"",LESSCLOSE:"/usr/bin/lesspipe %s %s",npm_package_dependencies_vite:"^5.2.11",npm_package_dependencies__babylonjs_serializers:"^6.49.0",npm_package_dependencies__tanstack_react_query:"^5.28.4",npm_config_version_git_tag:"true",npm_config_version_git_sign:"",npm_package_dependencies_classnames:"^2.5.1",npm_package_dependencies__vitejs_plugin_basic_ssl:"^1.1.0",npm_package_scripts_generate:"wagmi generate",npm_config_strict_ssl:"true",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",PWD:"/home/anstak/erc20/jet-app",npm_execpath:"/home/anstak/.node/corepack/yarn/1.22.19/bin/yarn.js",npm_package_dependencies_bootstrap:"^5.3.3",NVM_CD_FLAGS:"",XDG_DATA_DIRS:"/usr/local/share:/usr/share:/var/lib/snapd/desktop",npm_package_dependencies_react_modal:"^3.16.1",npm_config_save_prefix:"^",npm_config_ignore_optional:"",npm_package_dependencies_next:"^14.1.3",npm_package_dependencies__web3modal_wagmi:"^4.2.0",HOSTTYPE:"x86_64",npm_package_dependencies__babylonjs_core:"^6.49.0",INIT_CWD:"/home/anstak/erc20/jet-app",WSLENV:"VSCODE_WSL_EXT_LOCATION/up",npm_package_dependencies_react:"^18.2.0",NODE_ENV:"production",NEXT_PUBLIC_ENABLE_TESTNETS:"true",NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID:"04e7ef46cd7587fd99b538800fa59a9c",NODE_VERSION:"18",NEXT_PUBLIC_ALCHEMY_API_KEY:"RFt6h2Qn1ZTLDvqr_PZ94HNZ7OEJfW_h",NEXT_PUBLIC_CONTRACT_ARBITRUM_BETS:"0x13020CbCB419C075Fae4C04E469F905b31Bde0B9",NEXT_PUBLIC_CONTRACT_ARBITRUM_LJT:"0x8d6DBb3C052b6ab8c95B722bAacB2f07d82Ea9D1"};function RE(n,t){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<n.length;o++){var c=n.charAt(o),l=c.charCodeAt(0);if(r[l]!==255)throw new TypeError(c+" is ambiguous");r[l]=o}var g=n.length,v=n.charAt(0),d=Math.log(g)/Math.log(256),w=Math.log(256)/Math.log(g);function P($){if($ instanceof Uint8Array||(ArrayBuffer.isView($)?$=new Uint8Array($.buffer,$.byteOffset,$.byteLength):Array.isArray($)&&($=Uint8Array.from($))),!($ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if($.length===0)return"";for(var X=0,se=0,oe=0,le=$.length;oe!==le&&$[oe]===0;)oe++,X++;for(var ge=(le-oe)*w+1>>>0,ve=new Uint8Array(ge);oe!==le;){for(var ie=$[oe],ae=0,Y=ge-1;(ie!==0||ae<se)&&Y!==-1;Y--,ae++)ie+=256*ve[Y]>>>0,ve[Y]=ie%g>>>0,ie=ie/g>>>0;if(ie!==0)throw new Error("Non-zero carry");se=ae,oe++}for(var Se=ge-se;Se!==ge&&ve[Se]===0;)Se++;for(var $t=v.repeat(X);Se<ge;++Se)$t+=n.charAt(ve[Se]);return $t}function O($){if(typeof $!="string")throw new TypeError("Expected String");if($.length===0)return new Uint8Array;var X=0;if($[X]!==" "){for(var se=0,oe=0;$[X]===v;)se++,X++;for(var le=($.length-X)*d+1>>>0,ge=new Uint8Array(le);$[X];){var ve=r[$.charCodeAt(X)];if(ve===255)return;for(var ie=0,ae=le-1;(ve!==0||ie<oe)&&ae!==-1;ae--,ie++)ve+=g*ge[ae]>>>0,ge[ae]=ve%256>>>0,ve=ve/256>>>0;if(ve!==0)throw new Error("Non-zero carry");oe=ie,X++}if($[X]!==" "){for(var Y=le-oe;Y!==le&&ge[Y]===0;)Y++;for(var Se=new Uint8Array(se+(le-Y)),$t=se;Y!==le;)Se[$t++]=ge[Y++];return Se}}}function k($){var X=O($);if(X)return X;throw new Error(`Non-${t} character`)}return{encode:P,decodeUnsafe:O,decode:k}}var TE=RE,CE=TE;const up=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},NE=n=>new TextEncoder().encode(n),AE=n=>new TextDecoder().decode(n);class $E{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class DE{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return hp(this,t)}}class LE{constructor(t){this.decoders=t}or(t){return hp(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const hp=(n,t)=>new LE({...n.decoders||{[n.prefix]:n},...t.decoders||{[t.prefix]:t}});class ME{constructor(t,r,s,o){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new $E(t,r,s),this.decoder=new DE(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Uo=({name:n,prefix:t,encode:r,decode:s})=>new ME(n,t,r,s),ls=({prefix:n,name:t,alphabet:r})=>{const{encode:s,decode:o}=CE(r,t);return Uo({prefix:n,name:t,encode:s,decode:c=>up(o(c))})},jE=(n,t,r,s)=>{const o={};for(let w=0;w<t.length;++w)o[t[w]]=w;let c=n.length;for(;n[c-1]==="=";)--c;const l=new Uint8Array(c*r/8|0);let g=0,v=0,d=0;for(let w=0;w<c;++w){const P=o[n[w]];if(P===void 0)throw new SyntaxError(`Non-${s} character`);v=v<<r|P,g+=r,g>=8&&(g-=8,l[d++]=255&v>>g)}if(g>=r||255&v<<8-g)throw new SyntaxError("Unexpected end of data");return l},qE=(n,t,r)=>{const s=t[t.length-1]==="=",o=(1<<r)-1;let c="",l=0,g=0;for(let v=0;v<n.length;++v)for(g=g<<8|n[v],l+=8;l>r;)l-=r,c+=t[o&g>>l];if(l&&(c+=t[o&g<<r-l]),s)for(;c.length*r&7;)c+="=";return c},Ht=({name:n,prefix:t,bitsPerChar:r,alphabet:s})=>Uo({prefix:t,name:n,encode(o){return qE(o,s,r)},decode(o){return jE(o,s,r,n)}}),UE=Uo({prefix:"\0",name:"identity",encode:n=>AE(n),decode:n=>NE(n)});var kE=Object.freeze({__proto__:null,identity:UE});const zE=Ht({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var HE=Object.freeze({__proto__:null,base2:zE});const KE=Ht({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var BE=Object.freeze({__proto__:null,base8:KE});const VE=ls({prefix:"9",name:"base10",alphabet:"0123456789"});var FE=Object.freeze({__proto__:null,base10:VE});const WE=Ht({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),GE=Ht({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var JE=Object.freeze({__proto__:null,base16:WE,base16upper:GE});const YE=Ht({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),QE=Ht({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),XE=Ht({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ZE=Ht({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eI=Ht({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),tI=Ht({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),rI=Ht({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),iI=Ht({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),nI=Ht({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var sI=Object.freeze({__proto__:null,base32:YE,base32upper:QE,base32pad:XE,base32padupper:ZE,base32hex:eI,base32hexupper:tI,base32hexpad:rI,base32hexpadupper:iI,base32z:nI});const oI=ls({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),aI=ls({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var cI=Object.freeze({__proto__:null,base36:oI,base36upper:aI});const uI=ls({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hI=ls({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var lI=Object.freeze({__proto__:null,base58btc:uI,base58flickr:hI});const fI=Ht({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pI=Ht({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),dI=Ht({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gI=Ht({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var mI=Object.freeze({__proto__:null,base64:fI,base64pad:pI,base64url:dI,base64urlpad:gI});const lp=Array.from(""),yI=lp.reduce((n,t,r)=>(n[r]=t,n),[]),vI=lp.reduce((n,t,r)=>(n[t.codePointAt(0)]=r,n),[]);function _I(n){return n.reduce((t,r)=>(t+=yI[r],t),"")}function wI(n){const t=[];for(const r of n){const s=vI[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const bI=Uo({prefix:"",name:"base256emoji",encode:_I,decode:wI});var EI=Object.freeze({__proto__:null,base256emoji:bI}),II=fp,Fl=128,xI=127,SI=~xI,PI=Math.pow(2,31);function fp(n,t,r){t=t||[],r=r||0;for(var s=r;n>=PI;)t[r++]=n&255|Fl,n/=128;for(;n&SI;)t[r++]=n&255|Fl,n>>>=7;return t[r]=n|0,fp.bytes=r-s+1,t}var OI=kc,RI=128,Wl=127;function kc(n,s){var r=0,s=s||0,o=0,c=s,l,g=n.length;do{if(c>=g)throw kc.bytes=0,new RangeError("Could not decode varint");l=n[c++],r+=o<28?(l&Wl)<<o:(l&Wl)*Math.pow(2,o),o+=7}while(l>=RI);return kc.bytes=c-s,r}var TI=Math.pow(2,7),CI=Math.pow(2,14),NI=Math.pow(2,21),AI=Math.pow(2,28),$I=Math.pow(2,35),DI=Math.pow(2,42),LI=Math.pow(2,49),MI=Math.pow(2,56),jI=Math.pow(2,63),qI=function(n){return n<TI?1:n<CI?2:n<NI?3:n<AI?4:n<$I?5:n<DI?6:n<LI?7:n<MI?8:n<jI?9:10},UI={encode:II,decode:OI,encodingLength:qI},pp=UI;const Gl=(n,t,r=0)=>(pp.encode(n,t,r),t),Jl=n=>pp.encodingLength(n),zc=(n,t)=>{const r=t.byteLength,s=Jl(n),o=s+Jl(r),c=new Uint8Array(o+r);return Gl(n,c,0),Gl(r,c,s),c.set(t,o),new kI(n,r,t,c)};class kI{constructor(t,r,s,o){this.code=t,this.size=r,this.digest=s,this.bytes=o}}const dp=({name:n,code:t,encode:r})=>new zI(n,t,r);class zI{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?zc(this.code,r):r.then(s=>zc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const gp=n=>async t=>new Uint8Array(await crypto.subtle.digest(n,t)),HI=dp({name:"sha2-256",code:18,encode:gp("SHA-256")}),KI=dp({name:"sha2-512",code:19,encode:gp("SHA-512")});var BI=Object.freeze({__proto__:null,sha256:HI,sha512:KI});const mp=0,VI="identity",yp=up,FI=n=>zc(mp,yp(n)),WI={code:mp,name:VI,encode:yp,digest:FI};var GI=Object.freeze({__proto__:null,identity:WI});new TextEncoder,new TextDecoder;const Yl={...kE,...HE,...BE,...FE,...JE,...sI,...cI,...lI,...mI,...EI};({...BI,...GI});function vp(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function JI(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?vp(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function _p(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const Ql=_p("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),_c=_p("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=JI(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),YI={utf8:Ql,"utf-8":Ql,hex:Yl.base16,latin1:_c,ascii:_c,binary:_c,...Yl};function QI(n,t="utf8"){const r=YI[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?vp(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const wp="wc",XI=2,nu="core",Oi=`${wp}@2:${nu}:`,ZI={name:nu,logger:"error"},ex={database:":memory:"},tx="crypto",Xl="client_ed25519_seed",rx=Z.ONE_DAY,ix="keychain",nx="0.3",sx="messages",ox="0.3",ax=Z.SIX_HOURS,cx="publisher",bp="irn",ux="error",Ep="wss://relay.walletconnect.com",Zl="wss://relay.walletconnect.org",hx="relayer",Vt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},lx="_subscription",ui={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},fx=Z.ONE_SECOND,px="2.11.2",dx=1e4,gx="0.3",mx="WALLETCONNECT_CLIENT_ID",zr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},yx="subscription",vx="0.3",_x=Z.FIVE_SECONDS*1e3,wx="pairing",bx="0.3",Yn={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},es={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Jr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Ex="history",Ix="0.3",xx="expirer",Ar={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Sx="0.3",wc="verify-api",En="https://verify.walletconnect.com",Hc="https://verify.walletconnect.org",Px=[En,Hc],Ox="echo",Rx="https://echo.walletconnect.com";class Tx{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=ix,this.version=nx,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:c}=z("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(c)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,kf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?zf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Cx{constructor(t,r,s){this.core=t,this.logger=r,this.name=tx,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=Ul(o);return rp(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=K_();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),l=Ul(c),g=Nc();return await tE(g,o,rx,l)},this.generateSharedKey=(o,c,l)=>{this.isInitialized();const g=this.getPrivateKey(o),v=B_(g,c);return this.setSymKey(v,l)},this.setSymKey=async(o,c)=>{this.isInitialized();const l=c||V_(o);return await this.keychain.set(l,o),l},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,l)=>{this.isInitialized();const g=Uf(l),v=Gi(c);if(gl(g)){const O=g.senderPublicKey,k=g.receiverPublicKey;o=await this.generateSharedKey(O,k)}const d=this.getSymKey(o),{type:w,senderPublicKey:P}=g;return W_({type:w,symKey:d,message:v,senderPublicKey:P})},this.decode=async(o,c,l)=>{this.isInitialized();const g=Y_(c,l);if(gl(g)){const v=g.receiverPublicKey,d=g.senderPublicKey;o=await this.generateSharedKey(v,d)}try{const v=this.getSymKey(o),d=G_({symKey:v,encoded:c});return hs(d)}catch(v){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(v)}},this.getPayloadType=o=>{const c=Ro(o);return as(c.type)},this.getPayloadSenderPublicKey=o=>{const c=Ro(o);return c.senderPublicKey?rr(c.senderPublicKey,tr):void 0},this.core=t,this.logger=Ee.generateChildLogger(r,this.name),this.keychain=s||new Tx(this.core,this.logger)}get context(){return Ee.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Xl)}catch{t=Nc(),await this.keychain.set(Xl,t)}return QI(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Nx extends Ab{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=sx,this.version=ox,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const c=In(o);let l=this.messages.get(s);return typeof l>"u"&&(l={}),typeof l[c]<"u"||(l[c]=o,this.messages.set(s,l),await this.persist()),c},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const c=this.get(s),l=In(o);return typeof c[l]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Ee.generateChildLogger(t,this.name),this.core=r}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,kf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?zf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Ax extends $b{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new $r.EventEmitter,this.name=cx,this.queue=new Map,this.publishTimeout=Z.toMiliseconds(Z.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(s,o,c)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:c}});try{const g=(c==null?void 0:c.ttl)||ax,v=Ac(c),d=(c==null?void 0:c.prompt)||!1,w=(c==null?void 0:c.tag)||0,P=(c==null?void 0:c.id)||op().toString(),O={topic:s,message:o,opts:{ttl:g,relay:v,prompt:d,tag:w,id:P}},k=setTimeout(()=>this.queue.set(P,O),this.publishTimeout);try{await await is(this.rpcPublish(s,o,g,v,d,w,P),this.publishTimeout,`Failed to publish payload, please try again. id:${P} tag:${w}`),this.removeRequestFromQueue(P),this.relayer.events.emit(Vt.publish,O)}catch($){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=c==null?void 0:c.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(P),$;return}finally{clearTimeout(k)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:c}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=t,this.logger=Ee.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ee.getLoggerContext(this.logger)}rpcPublish(t,r,s,o,c,l,g){var v,d,w,P;const O={method:xo(o.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:c,tag:l},id:g};return fr((v=O.params)==null?void 0:v.prompt)&&((d=O.params)==null||delete d.prompt),fr((w=O.params)==null?void 0:w.tag)&&((P=O.params)==null||delete P.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:O}),this.relayer.request(O)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:o}=t;await this.publish(r,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Vt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Vt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class $x{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const o=s.filter(c=>c!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Dx=Object.defineProperty,Lx=Object.defineProperties,Mx=Object.getOwnPropertyDescriptors,ef=Object.getOwnPropertySymbols,jx=Object.prototype.hasOwnProperty,qx=Object.prototype.propertyIsEnumerable,tf=(n,t,r)=>t in n?Dx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Qn=(n,t)=>{for(var r in t||(t={}))jx.call(t,r)&&tf(n,r,t[r]);if(ef)for(var r of ef(t))qx.call(t,r)&&tf(n,r,t[r]);return n},bc=(n,t)=>Lx(n,Mx(t));class Ux extends Mb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new $x,this.events=new $r.EventEmitter,this.name=yx,this.version=vx,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Oi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const c=Ac(o),l={topic:s,relay:c};this.pending.set(s,l);const g=await this.rpcSubscribe(s,c);return this.onSubscribe(g,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),g}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>{if(this.topics.includes(s))return!0;const o=`${this.pendingSubscriptionWatchLabel}_${s}`;return await new Promise((c,l)=>{const g=new Z.Watch;g.start(o);const v=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(v),g.stop(o),c(!0)),g.elapsed(o)>=_x&&(clearInterval(v),g.stop(o),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ee.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const o=Ac(s);await this.rpcUnsubscribe(t,r,o);const c=Xe("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const s={method:xo(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await is(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Vt.connection_stalled)}return In(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:xo(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await is(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Vt.connection_stalled)}}rpcUnsubscribe(t,r,s){const o={method:xo(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,bc(Qn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Qn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Qn({},r)),this.topicMap.set(r.topic,t),this.events.emit(zr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(zr.deleted,bc(Qn({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(zr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(zr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);Yr(r)&&this.onBatchSubscribe(r.map((s,o)=>bc(Qn({},t[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Vt.connect,async()=>{await this.onConnect()}),this.relayer.on(Vt.disconnect,()=>{this.onDisconnect()}),this.events.on(zr.created,async t=>{const r=zr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(zr.deleted,async t=>{const r=zr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var kx=Object.defineProperty,rf=Object.getOwnPropertySymbols,zx=Object.prototype.hasOwnProperty,Hx=Object.prototype.propertyIsEnumerable,nf=(n,t,r)=>t in n?kx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Kx=(n,t)=>{for(var r in t||(t={}))zx.call(t,r)&&nf(n,r,t[r]);if(rf)for(var r of rf(t))Hx.call(t,r)&&nf(n,r,t[r]);return n};class Bx extends Db{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new $r.EventEmitter,this.name=hx,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async r=>{this.logger.debug("Publishing Request Payload");const s=r.id;try{await this.toEstablishConnection();const o=this.provider.request(r);return this.requestsInFlight.set(s,{promise:o,request:r}),await o}catch(o){throw this.logger.debug("Failed to Publish Request"),this.logger.error(o),o}finally{this.requestsInFlight.delete(s)}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Vt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Vt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ui.payload,this.onPayloadHandler),this.provider.on(ui.connect,this.onConnectHandler),this.provider.on(ui.disconnect,this.onDisconnectHandler),this.provider.on(ui.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ee.generateChildLogger(t.logger,this.name):Ee.pino(Ee.getDefaultLoggerOptions({level:t.logger||ux})),this.messages=new Nx(this.logger,t.core),this.subscriber=new Ux(this,this.logger),this.publisher=new Ax(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Ep,this.projectId=t.projectId,this.bundleId=rw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Zl}...`),await this.restartTransport(Zl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},dx)}get context(){return Ee.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(o)return o;let c;const l=g=>{g.topic===t&&(this.subscriber.off(zr.created,l),c())};return await Promise.all([new Promise(g=>{c=g,this.subscriber.on(zr.created,l)}),new Promise(async g=>{o=await this.subscriber.subscribe(t,r),g()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async t=>{await t.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await is(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(zr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await is(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){s(o);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ui.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Pl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new pi(new wE(cw({sdkVersion:px,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),iu(t)){if(!t.method.endsWith(lx))return;const r=t.params,{topic:s,message:o,publishedAt:c}=r.data,l={topic:s,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Kx({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else qo(t)&&this.events.emit(Vt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Vt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Mo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ui.payload,this.onPayloadHandler),this.provider.off(ui.connect,this.onConnectHandler),this.provider.off(ui.disconnect,this.onDisconnectHandler),this.provider.off(ui.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Vt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Pl();r1(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Vt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},Z.toMiliseconds(fx)))}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Vx=Object.defineProperty,sf=Object.getOwnPropertySymbols,Fx=Object.prototype.hasOwnProperty,Wx=Object.prototype.propertyIsEnumerable,of=(n,t,r)=>t in n?Vx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,af=(n,t)=>{for(var r in t||(t={}))Fx.call(t,r)&&of(n,r,t[r]);if(sf)for(var r of sf(t))Wx.call(t,r)&&of(n,r,t[r]);return n};class ko extends Lb{constructor(t,r,s,o=Oi,c=void 0){super(t,r,s,o),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=gx,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!fr(l)?this.map.set(this.getKey(l),l):$w(l)?this.map.set(l.id,l):Dw(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,g)=>{this.isInitialized(),this.map.has(l)?await this.update(l,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:g}),this.map.set(l,g),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(g=>Object.keys(l).every(v=>EE(g[v],l[v]))):this.values),this.update=async(l,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:g});const v=af(af({},this.getData(l)),g);this.map.set(l,v),await this.persist()},this.delete=async(l,g)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:g}),this.map.delete(l),await this.persist())},this.logger=Ee.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=c}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Gx{constructor(t,r){this.core=t,this.logger=r,this.name=wx,this.version=bx,this.events=new Fc,this.initialized=!1,this.storagePrefix=Oi,this.ignoredPayloadTypes=[Ji],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Nc(),o=await this.core.crypto.setSymKey(s),c=br(Z.FIVE_MINUTES),l={protocol:bp},g={topic:o,expiry:c,relay:l,active:!1},v=xw({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:l,expiryTimestamp:c});return await this.pairings.set(o,g),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:v}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:c,relay:l,expiryTimestamp:g}=bl(s.uri);let v;if(this.pairings.keys.includes(o)&&(v=this.pairings.get(o),v.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const d=g||br(Z.FIVE_MINUTES),w={topic:o,relay:l,expiry:d,active:!1};return await this.pairings.set(o,w),this.core.expirer.set(o,d),s.activatePairing&&await this.activate({topic:o}),this.events.emit(es.create,w),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:l})),w},this.activate=async({topic:s})=>{this.isInitialized();const o=br(Z.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:l,resolve:g,reject:v}=bn();this.events.once(vt("pairing_ping",c),({error:d})=>{d?v(d):g()}),await l()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Xe("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,c)=>{const l=xn(o,c),g=await this.core.crypto.encode(s,l),v=Yn[o].req;return this.core.history.set(s,l),this.core.relayer.publish(s,g,v),l.id},this.sendResult=async(s,o,c)=>{const l=Mo(s,c),g=await this.core.crypto.encode(o,l),v=await this.core.history.get(o,s),d=Yn[v.request.method].res;await this.core.relayer.publish(o,g,d),await this.core.history.resolve(l)},this.sendError=async(s,o,c)=>{const l=jo(s,c),g=await this.core.crypto.encode(o,l),v=await this.core.history.get(o,s),d=Yn[v.request.method]?Yn[v.request.method].res:Yn.unregistered_method.res;await this.core.relayer.publish(o,g,d),await this.core.history.resolve(l)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Xe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>Pi(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:c}=s;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:c}=s,l=(await this.core.history.get(o,c.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(s,o)=>{const{id:c}=o;try{this.isValidPing({topic:s}),await this.sendResult(c,s,!0),this.events.emit(es.ping,{id:c,topic:s})}catch(l){await this.sendError(c,s,l),this.logger.error(l)}},this.onPairingPingResponse=(s,o)=>{const{id:c}=o;setTimeout(()=>{fi(o)?this.events.emit(vt("pairing_ping",c),{}):Hr(o)&&this.events.emit(vt("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(es.delete,{id:c,topic:s})}catch(l){await this.sendError(c,s,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:c,method:l}=o;try{if(this.registeredMethods.includes(l))return;const g=Xe("WC_METHOD_UNSUPPORTED",l);await this.sendError(c,s,g),this.logger.error(g)}catch(g){await this.sendError(c,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Xe("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var o;if(!lr(s)){const{message:l}=z("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(l)}if(!Aw(s.uri)){const{message:l}=z("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(l)}const c=bl(s.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:l}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(c!=null&&c.symKey)){const{message:l}=z("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}if(c!=null&&c.expiryTimestamp&&Z.toMiliseconds(c==null?void 0:c.expiryTimestamp)<Date.now()){const{message:l}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(l)}},this.isValidPing=async s=>{if(!lr(s)){const{message:c}=z("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(c)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!lr(s)){const{message:c}=z("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(c)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!qt(s,!1)){const{message:o}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(Pi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=z("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=t,this.logger=Ee.generateChildLogger(r,this.name),this.pairings=new ko(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ee.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Vt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(r,s);try{iu(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):qo(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Ar.expired,async t=>{const{topic:r}=Kf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(es.expire,{topic:r}))})}}class Jx extends Nb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new $r.EventEmitter,this.name=Ex,this.version=Ix,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:c}),this.records.has(o.id))return;const l={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:c,expiry:br(Z.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(Jr.created,l)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=Hr(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(Jr.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===s){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(Jr.deleted,c)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:xn(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Jr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Jr.created,t=>{const r=Jr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Jr.updated,t=>{const r=Jr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Jr.deleted,t=>{const r=Jr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{Z.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Yx extends jb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new $r.EventEmitter,this.name=xx,this.version=Sx,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const c=this.formatTarget(s),l={target:c,expiry:o};this.expirations.set(c,l),this.checkExpiry(c,l),this.events.emit(Ar.created,{target:c,expiration:l})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Ar.deleted,{target:o,expiration:c})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return uw(t);if(typeof t=="number")return hw(t);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ar.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;Z.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Ar.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Rn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ar.created,t=>{const r=Ar.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.expired,t=>{const r=Ar.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.deleted,t=>{const r=Ar.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Qx extends qb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=wc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Sn()||!Pn())return;const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Hc;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let c;try{c=await this.fetchAttestation(s.attestationId,o)}catch(l){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${o}`),this.logger.info(l),c=await this.fetchAttestation(s.attestationId,Hc)}return c},this.fetchAttestation=async(s,o)=>{this.logger.info(`resolving attestation: ${s} from url: ${o}`);const c=this.startAbortTimer(Z.ONE_SECOND*2),l=await fetch(`${o}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(c),l.status===200?await l.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),s())};await Promise.race([new Promise(c=>{if(document.getElementById(wc))return c();window.addEventListener("message",o);const l=document.createElement("iframe");l.id=wc,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,s=c}),new Promise((c,l)=>setTimeout(()=>{window.removeEventListener("message",o),l("verify iframe load timeout")},Z.toMiliseconds(Z.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let o=s||En;return Px.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${En}`),o=En),o},this.logger=Ee.generateChildLogger(r,this.name),this.verifyUrl=En,this.abortController=new AbortController,this.isDevEnv=Qc()&&OE.IS_VITEST}get context(){return Ee.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Z.toMiliseconds(t))}}class Xx extends Ub{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=Ox,this.registerDeviceToken=async s=>{const{clientId:o,token:c,notificationType:l,enableEncrypted:g=!1}=s,v=`${Rx}/${this.projectId}/clients`;await PE(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:l,token:c,always_raw:g})})},this.logger=Ee.generateChildLogger(r,this.context)}}var Zx=Object.defineProperty,cf=Object.getOwnPropertySymbols,eS=Object.prototype.hasOwnProperty,tS=Object.prototype.propertyIsEnumerable,uf=(n,t,r)=>t in n?Zx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,hf=(n,t)=>{for(var r in t||(t={}))eS.call(t,r)&&uf(n,r,t[r]);if(cf)for(var r of cf(t))tS.call(t,r)&&uf(n,r,t[r]);return n};class su extends Cb{constructor(t){super(t),this.protocol=wp,this.version=XI,this.name=nu,this.events=new $r.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Ep,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||ZI.logger}));this.logger=Ee.generateChildLogger(r,this.name),this.heartbeat=new Rn.HeartBeat,this.crypto=new Cx(this,this.logger,t==null?void 0:t.keychain),this.history=new Jx(this,this.logger),this.expirer=new Yx(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new M1(hf(hf({},ex),t==null?void 0:t.storageOptions)),this.relayer=new Bx({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Gx(this,this.logger),this.verify=new Qx(this.projectId||"",this.logger),this.echoClient=new Xx(this.projectId||"",this.logger)}static async init(t){const r=new su(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(mx,s),r}get context(){return Ee.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const rS=su,Ip="wc",xp=2,Sp="client",ou=`${Ip}@${xp}:${Sp}:`,Ec={name:Sp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},lf="WALLETCONNECT_DEEPLINK_CHOICE",iS="proposal",Pp="Proposal expired",nS="session",bo=Z.SEVEN_DAYS,sS="engine",hi={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ic={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},li={idle:"IDLE",active:"ACTIVE"},oS="request",aS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var cS=Object.defineProperty,uS=Object.defineProperties,hS=Object.getOwnPropertyDescriptors,ff=Object.getOwnPropertySymbols,lS=Object.prototype.hasOwnProperty,fS=Object.prototype.propertyIsEnumerable,pf=(n,t,r)=>t in n?cS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,er=(n,t)=>{for(var r in t||(t={}))lS.call(t,r)&&pf(n,r,t[r]);if(ff)for(var r of ff(t))fS.call(t,r)&&pf(n,r,t[r]);return n},wn=(n,t)=>uS(n,hS(t));class pS extends zb{constructor(t){super(t),this.name=sS,this.events=new Fc,this.initialized=!1,this.ignoredPayloadTypes=[Ji],this.requestQueue={state:li.idle,queue:[]},this.sessionRequestQueue={state:li.idle,queue:[]},this.requestQueueDelay=Z.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(hi)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},Z.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=wn(er({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:l,sessionProperties:g,relays:v}=s;let d=o,w,P=!1;if(d&&(P=this.client.core.pairing.pairings.get(d).active),!d||!P){const{topic:ve,uri:ie}=await this.client.core.pairing.create();d=ve,w=ie}const O=await this.client.core.crypto.generateKeyPair(),k=hi.wc_sessionPropose.req.ttl||Z.FIVE_MINUTES,$=br(k),X=er({requiredNamespaces:c,optionalNamespaces:l,relays:v??[{protocol:bp}],proposer:{publicKey:O,metadata:this.client.metadata},expiryTimestamp:$},g&&{sessionProperties:g}),{reject:se,resolve:oe,done:le}=bn(k,Pp);if(this.events.once(vt("session_connect"),async({error:ve,session:ie})=>{if(ve)se(ve);else if(ie){ie.self.publicKey=O;const ae=wn(er({},ie),{requiredNamespaces:X.requiredNamespaces,optionalNamespaces:X.optionalNamespaces});await this.client.session.set(ie.topic,ae),await this.setExpiry(ie.topic,ie.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:ie.peer.metadata}),oe(ae)}}),!d){const{message:ve}=z("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(ve)}const ge=await this.sendRequest({topic:d,method:"wc_sessionPropose",params:X,throwOnFailedPublish:!0});return await this.setProposal(ge,er({id:ge},X)),{uri:w,approval:le}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:o,namespaces:c,sessionProperties:l}=r,g=this.client.proposal.get(s);let{pairingTopic:v,proposer:d,requiredNamespaces:w,optionalNamespaces:P}=g;v=v||"";const O=await this.client.core.crypto.generateKeyPair(),k=d.publicKey,$=await this.client.core.crypto.generateSharedKey(O,k);v&&s&&(await this.client.core.pairing.updateMetadata({topic:v,metadata:d.metadata}),await this.sendResult({id:s,topic:v,result:{relay:{protocol:o??"irn"},responderPublicKey:O}}),await this.client.proposal.delete(s,Xe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:v}));const X=er({relay:{protocol:o??"irn"},namespaces:c,pairingTopic:v,controller:{publicKey:O,metadata:this.client.metadata},expiry:br(bo)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe($);const se=wn(er({},X),{topic:$,requiredNamespaces:w,optionalNamespaces:P,pairingTopic:v,acknowledged:!1,self:X.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:O});await this.client.session.set($,se);try{await this.sendRequest({topic:$,method:"wc_sessionSettle",params:X,throwOnFailedPublish:!0})}catch(oe){throw this.client.logger.error(oe),this.client.session.delete($,Xe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe($),oe}return await this.setExpiry($,br(bo)),{topic:$,acknowledged:()=>new Promise(oe=>setTimeout(()=>oe(this.client.session.get($)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:o}=r,{pairingTopic:c}=this.client.proposal.get(s);c&&(await this.sendError(s,c,o),await this.client.proposal.delete(s,Xe("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:o}=r,c=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:l,resolve:g,reject:v}=bn();return this.events.once(vt("session_update",c),({error:d})=>{d?v(d):g()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,o=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:c,resolve:l,reject:g}=bn();return this.events.once(vt("session_extend",o),({error:v})=>{v?g(v):l()}),await this.setExpiry(s,br(bo)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:o,topic:c,expiry:l=hi.wc_sessionRequest.req.ttl}=r,g=ru(),{done:v,resolve:d,reject:w}=bn(l,"Request expired. Please try again.");return this.events.once(vt("session_request",g),({error:P,result:O})=>{P?w(P):d(O)}),await Promise.all([new Promise(async P=>{await this.sendRequest({clientRpcId:g,topic:c,method:"wc_sessionRequest",params:{request:wn(er({},o),{expiryTimestamp:br(l)}),chainId:s},expiry:l,throwOnFailedPublish:!0}).catch(O=>w(O)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:s,id:g}),P()}),new Promise(async P=>{const O=await fw(this.client.core.storage,lf);lw({id:g,topic:c,wcDeepLink:O}),P()}),v()]).then(P=>P[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:o}=r,{id:c}=o;fi(o)?await this.sendResult({id:c,topic:s,result:o.result,throwOnFailedPublish:!0}):Hr(o)&&await this.sendError(c,s,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:c,resolve:l,reject:g}=bn();this.events.once(vt("session_ping",o),({error:v})=>{v?g(v):l()}),await c()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:o,chainId:c}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;if(this.client.session.keys.includes(s))await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Xe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:s,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(s))await this.client.core.pairing.disconnect({topic:s});else{const{message:o}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(o)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Cw(s,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var l,g;return((l=c.peerMetadata)==null?void 0:l.url)&&((g=c.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&c.topic&&c.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async r=>{const{topic:s,expirerHasDeleted:o=!1,emitEvent:c=!0,id:l=0}=r,{self:g}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,Xe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),o||this.client.core.expirer.del(s),this.client.core.storage.removeItem(lf).catch(v=>this.client.logger.warn(v)),this.getPendingSessionRequests().forEach(v=>{v.topic===s&&this.deletePendingSessionRequest(v.id,Xe("USER_DISCONNECTED"))}),c&&this.client.events.emit("session_delete",{id:l,topic:s})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,Xe("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),o&&(this.sessionRequestQueue.state=li.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,br(hi.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:s,topic:o,params:c,verifyContext:l}=r,g=c.request.expiryTimestamp||br(hi.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(s,{id:s,topic:o,params:c,verifyContext:l}),g&&this.client.core.expirer.set(s,g)},this.sendRequest=async r=>{const{topic:s,method:o,params:c,expiry:l,relayRpcId:g,clientRpcId:v,throwOnFailedPublish:d}=r,w=xn(o,c,v);if(Pn()&&aS.includes(o)){const k=In(JSON.stringify(w));this.client.core.verify.register({attestationId:k})}const P=await this.client.core.crypto.encode(s,w),O=hi[o].req;return l&&(O.ttl=l),g&&(O.id=g),this.client.core.history.set(s,w),d?(O.internal=wn(er({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,P,O)):this.client.core.relayer.publish(s,P,O).catch(k=>this.client.logger.error(k)),w.id},this.sendResult=async r=>{const{id:s,topic:o,result:c,throwOnFailedPublish:l}=r,g=Mo(s,c),v=await this.client.core.crypto.encode(o,g),d=await this.client.core.history.get(o,s),w=hi[d.request.method].res;l?(w.internal=wn(er({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,v,w)):this.client.core.relayer.publish(o,v,w).catch(P=>this.client.logger.error(P)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,o)=>{const c=jo(r,o),l=await this.client.core.crypto.encode(s,c),g=await this.client.core.history.get(s,r),v=hi[g.request.method].res;this.client.core.relayer.publish(s,l,v),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(o=>{let c=!1;Pi(o.expiry)&&(c=!0),this.client.core.crypto.keychain.has(o.topic)||(c=!0),c&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Pi(o.expiryTimestamp)&&s.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession({topic:o})),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===li.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=li.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=li.idle},this.processRequest=r=>{const{topic:s,payload:o}=r,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,c=(await this.client.core.history.get(s,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:o}=z("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,s)=>{const{params:o,id:c}=s;try{this.isValidConnect(er({},s.params));const l=o.expiryTimestamp||br(hi.wc_sessionPropose.req.ttl),g=er({id:c,pairingTopic:r,expiryTimestamp:l},o);await this.setProposal(c,g);const v=In(JSON.stringify(s)),d=await this.getVerifyContext(v,g.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:g,verifyContext:d})}catch(l){await this.sendError(c,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,s)=>{const{id:o}=s;if(fi(s)){const{result:c}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const l=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const g=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const v=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:v});const d=await this.client.core.crypto.generateSharedKey(g,v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const w=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:w}),await this.client.core.pairing.activate({topic:r})}else Hr(s)&&(await this.client.proposal.delete(o,Xe("USER_DISCONNECTED")),this.events.emit(vt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:o,params:c}=s;try{this.isValidSessionSettleRequest(c);const{relay:l,controller:g,expiry:v,namespaces:d,sessionProperties:w,pairingTopic:P}=s.params,O=er({topic:r,relay:l,expiry:v,namespaces:d,acknowledged:!0,pairingTopic:P,requiredNamespaces:{},optionalNamespaces:{},controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},w&&{sessionProperties:w});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(vt("session_connect"),{session:O}),this.cleanupDuplicatePairings(O)}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,s)=>{const{id:o}=s;fi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(vt("session_approve",o),{})):Hr(s)&&(await this.client.session.delete(r,Xe("USER_DISCONNECTED")),this.events.emit(vt("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:o,id:c}=s;try{const l=`${r}_session_update`,g=vo.get(l);if(g&&this.isRequestOutOfSync(g,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(er({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:o}),vo.set(l,c)}catch(l){await this.sendError(c,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:o}=s;fi(s)?this.events.emit(vt("session_update",o),{}):Hr(s)&&this.events.emit(vt("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:o}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,br(bo)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,s)=>{const{id:o}=s;fi(s)?this.events.emit(vt("session_extend",o),{}):Hr(s)&&this.events.emit(vt("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{fi(s)?this.events.emit(vt("session_ping",o),{}):Hr(s)&&this.events.emit(vt("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Vt.publish,async()=>{c(await this.deleteSession({topic:r,id:o}))})}),this.sendResult({id:o,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:Xe("USER_DISCONNECTED")})])}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,s)=>{const{id:o,params:c}=s;try{this.isValidRequest(er({topic:r},c));const l=In(JSON.stringify(xn("wc_sessionRequest",c,o))),g=this.client.session.get(r),v=await this.getVerifyContext(l,g.peer.metadata),d={id:o,topic:r,params:c,verifyContext:v};await this.setPendingSessionRequest(d),this.addSessionRequestToSessionRequestQueue(d),this.processSessionRequestQueue()}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,s)=>{const{id:o}=s;fi(s)?this.events.emit(vt("session_request",o),{result:s.result}):Hr(s)&&this.events.emit(vt("session_request",o),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:o,params:c}=s;try{const l=`${r}_session_event_${c.event.name}`,g=vo.get(l);if(g&&this.isRequestOutOfSync(g,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(er({topic:r},c)),this.client.events.emit("session_event",{id:o,topic:r,params:c}),vo.set(l,o)}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=li.idle,this.processSessionRequestQueue()},Z.toMiliseconds(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:s})=>{const o=this.client.core.history.pending;o.length>0&&o.filter(c=>c.topic===r&&c.request.method==="wc_sessionRequest").forEach(c=>{this.events.emit(vt("session_request",c.request.id),{error:s})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===li.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=li.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,xn("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!lr(r)){const{message:v}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(v)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:l,relays:g}=r;if(fr(s)||await this.isValidPairingTopic(s),!Hw(g)){const{message:v}=z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(v)}!fr(o)&&ns(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!fr(c)&&ns(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),fr(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,s)=>{const o=zw(r,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!lr(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:o,relayProtocol:c,sessionProperties:l}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),v=pc(o,"approve()");if(v)throw new Error(v.message);const d=xl(g.requiredNamespaces,o,"approve()");if(d)throw new Error(d.message);if(!qt(c,!0)){const{message:w}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(w)}fr(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!lr(r)){const{message:c}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:s,reason:o}=r;if(await this.isValidProposalId(s),!Bw(o)){const{message:c}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!lr(r)){const{message:d}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(d)}const{relay:s,controller:o,namespaces:c,expiry:l}=r;if(!Vf(s)){const{message:d}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const g=Lw(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);const v=pc(c,"onSessionSettleRequest()");if(v)throw new Error(v.message);if(Pi(l)){const{message:d}=z("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async r=>{if(!lr(r)){const{message:v}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(v)}const{topic:s,namespaces:o}=r;await this.isValidSessionTopic(s);const c=this.client.session.get(s),l=pc(o,"update()");if(l)throw new Error(l.message);const g=xl(c.requiredNamespaces,o,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!lr(r)){const{message:o}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!lr(r)){const{message:v}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(v)}const{topic:s,request:o,chainId:c,expiry:l}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!Il(g,c)){const{message:v}=z("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(v)}if(!Vw(o)){const{message:v}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(v)}if(!Gw(g,c,o.method)){const{message:v}=z("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(v)}if(l&&!Xw(l,Ic)){const{message:v}=z("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${Ic.min} and ${Ic.max}`);throw new Error(v)}},this.isValidRespond=async r=>{var s;if(!lr(r)){const{message:l}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:o,response:c}=r;try{await this.isValidSessionTopic(o)}catch(l){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),l}if(!Fw(c)){const{message:l}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!lr(r)){const{message:o}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!lr(r)){const{message:g}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:o,chainId:c}=r;await this.isValidSessionTopic(s);const{namespaces:l}=this.client.session.get(s);if(!Il(l,c)){const{message:g}=z("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(g)}if(!Ww(o)){const{message:g}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}if(!Jw(l,c,o.name)){const{message:g}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!lr(r)){const{message:o}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const o={verified:{verifyUrl:s.verifyUrl||En,validation:"UNKNOWN",origin:s.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(o=>{if(!qt(o,!1)){const{message:c}=z("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Vt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(r,s);try{iu(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):qo(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Ar.expired,async t=>{const{topic:r,id:s}=Kf(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(es.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!qt(t,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!qt(t,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.session.get(t).expiry)){await this.deleteSession({topic:t});const{message:r}=z("EXPIRED",`session topic: ${t}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(t)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${t}`);throw await this.deleteSession({topic:t}),new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(qt(t,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!Kw(t)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.proposal.get(t).expiryTimestamp)){await this.deleteProposal(t);const{message:r}=z("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class dS extends ko{constructor(t,r){super(t,r,iS,ou),this.core=t,this.logger=r}}let gS=class extends ko{constructor(t,r){super(t,r,nS,ou),this.core=t,this.logger=r}};class mS extends ko{constructor(t,r){super(t,r,oS,ou,s=>s.id),this.core=t,this.logger=r}}let yS=class Op extends kb{constructor(t){super(t),this.protocol=Ip,this.version=xp,this.name=Ec.name,this.events=new $r.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||Ec.name,this.metadata=(t==null?void 0:t.metadata)||nw();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Ec.logger}));this.core=(t==null?void 0:t.core)||new rS(t),this.logger=Ee.generateChildLogger(r,this.name),this.session=new gS(this.core,this.logger),this.proposal=new dS(this.core,this.logger),this.pendingRequest=new mS(this.core,this.logger),this.engine=new pS(this)}static async init(t){const r=new Op(t);return await r.initialize(),r}get context(){return Ee.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const vS={Accept:"application/json","Content-Type":"application/json"},_S="POST",df={headers:vS,method:_S},gf=10;class Ti{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new $r.EventEmitter,this.isAvailable=!1,this.registering=!1,!zl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const s=Gi(t),c=await(await cl(this.url,Object.assign(Object.assign({},df),{body:s}))).json();this.onPayload({data:c})}catch(s){this.onError(t.id,s)}}async register(t=this.url){if(!zl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Gi({id:1,jsonrpc:"2.0",method:"test",params:[]});await cl(t,Object.assign(Object.assign({},df),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?hs(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),o=s.message||s.toString(),c=jo(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return sp(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>gf&&this.events.setMaxListeners(gf)}}const mf="error",wS="wss://relay.walletconnect.com",bS="wc",ES="universal_provider",yf=`${bS}@2:${ES}:`,IS="https://rpc.walletconnect.com/v1/",di={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,t){(function(){var r,s="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",g="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",d=500,w="__lodash_placeholder__",P=1,O=2,k=4,$=1,X=2,se=1,oe=2,le=4,ge=8,ve=16,ie=32,ae=64,Y=128,Se=256,$t=512,_t=30,ir="...",Ft=800,dr=16,q=1,U=2,Ge=3,Me=1/0,W=9007199254740991,B=17976931348623157e292,H=NaN,V=4294967295,Tt=V-1,nt=V>>>1,Ci=[["ary",Y],["bind",se],["bindKey",oe],["curry",ge],["curryRight",ve],["flip",$t],["partial",ie],["partialRight",ae],["rearg",Se]],_e="[object Arguments]",Dr="[object Array]",N="[object AsyncFunction]",C="[object Boolean]",R="[object Date]",h="[object DOMException]",E="[object Error]",J="[object Function]",ne="[object GeneratorFunction]",pe="[object Map]",Pe="[object Number]",Re="[object Null]",we="[object Object]",wt="[object Promise]",pt="[object Proxy]",et="[object RegExp]",Ce="[object Set]",Ke="[object String]",Be="[object Symbol]",tt="[object Undefined]",De="[object WeakMap]",Ve="[object WeakSet]",Oe="[object ArrayBuffer]",je="[object DataView]",st="[object Float32Array]",Ae="[object Float64Array]",bt="[object Int8Array]",Ct="[object Int16Array]",Ut="[object Int32Array]",kt="[object Uint8Array]",Dt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",nr="[object Uint32Array]",Kr=/\b__p \+= '';/g,Gt=/\b(__p \+=) '' \+/g,Qr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gi=/&(?:amp|lt|gt|quot|#39);/g,Ni=/[&<>"']/g,ot=RegExp(gi.source),Je=RegExp(Ni.source),at=/<%-([\s\S]+?)%>/g,ct=/<%([\s\S]+?)%>/g,rt=/<%=([\s\S]+?)%>/g,Ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Et=/^\w*$/,It=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ut=/[\\^$.*+?()[\]{}|]/g,xt=RegExp(ut.source),ht=/^\s+/,dt=/\s/,lt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,He=/\{\n\/\* \[wrapped with (.+)\] \*/,St=/,? & /,Pt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,zo=/[()=,{}\[\]\/\s]/,Ho=/\\(\\)?/g,Ko=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ir=/\w*$/,Bo=/^[-+]0x[0-9a-f]+$/i,Vo=/^0b[01]+$/i,Fo=/^\[object .+?Constructor\]$/,Wo=/^0o[0-7]+$/i,Go=/^(?:0|[1-9]\d*)$/,Xr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zi=/($^)/,Jo=/['\n\r\u2028\u2029\\]/g,en="\\ud800-\\udfff",Yo="\\u0300-\\u036f",Qo="\\ufe20-\\ufe2f",tn="\\u20d0-\\u20ff",fs=Yo+Qo+tn,ps="\\u2700-\\u27bf",Lr="a-z\\xdf-\\xf6\\xf8-\\xff",Xo="\\xac\\xb1\\xd7\\xf7",Zo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ea="\\u2000-\\u206f",ta=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ds="A-Z\\xc0-\\xd6\\xd8-\\xde",gs="\\ufe0e\\ufe0f",Ai=Xo+Zo+ea+ta,Tn="[']",$i="["+en+"]",Cn="["+Ai+"]",Di="["+fs+"]",ms="\\d+",ra="["+ps+"]",ys="["+Lr+"]",vs="[^"+en+Ai+ms+ps+Lr+ds+"]",rn="\\ud83c[\\udffb-\\udfff]",ia="(?:"+Di+"|"+rn+")",_s="[^"+en+"]",nn="(?:\\ud83c[\\udde6-\\uddff]){2}",mi="[\\ud800-\\udbff][\\udc00-\\udfff]",gr="["+ds+"]",ws="\\u200d",bs="(?:"+ys+"|"+vs+")",Br="(?:"+gr+"|"+vs+")",Es="(?:"+Tn+"(?:d|ll|m|re|s|t|ve))?",Is="(?:"+Tn+"(?:D|LL|M|RE|S|T|VE))?",xs=ia+"?",Ss="["+gs+"]?",na="(?:"+ws+"(?:"+[_s,nn,mi].join("|")+")"+Ss+xs+")*",Zr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ps="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Os=Ss+xs+na,sn="(?:"+[ra,nn,mi].join("|")+")"+Os,sa="(?:"+[_s+Di+"?",Di,nn,mi,$i].join("|")+")",Nn=RegExp(Tn,"g"),oa=RegExp(Di,"g"),on=RegExp(rn+"(?="+rn+")|"+sa+Os,"g"),Rs=RegExp([gr+"?"+ys+"+"+Es+"(?="+[Cn,gr,"$"].join("|")+")",Br+"+"+Is+"(?="+[Cn,gr+bs,"$"].join("|")+")",gr+"?"+bs+"+"+Es,gr+"+"+Is,Ps,Zr,ms,sn].join("|"),"g"),Ts=RegExp("["+ws+en+fs+gs+"]"),Li=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],aa=-1,qe={};qe[st]=qe[Ae]=qe[bt]=qe[Ct]=qe[Ut]=qe[kt]=qe[Dt]=qe[Wt]=qe[nr]=!0,qe[_e]=qe[Dr]=qe[Oe]=qe[C]=qe[je]=qe[R]=qe[E]=qe[J]=qe[pe]=qe[Pe]=qe[we]=qe[et]=qe[Ce]=qe[Ke]=qe[De]=!1;var Le={};Le[_e]=Le[Dr]=Le[Oe]=Le[je]=Le[C]=Le[R]=Le[st]=Le[Ae]=Le[bt]=Le[Ct]=Le[Ut]=Le[pe]=Le[Pe]=Le[we]=Le[et]=Le[Ce]=Le[Ke]=Le[Be]=Le[kt]=Le[Dt]=Le[Wt]=Le[nr]=!0,Le[E]=Le[J]=Le[De]=!1;var y={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},M={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},F={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ue=parseFloat,ue=parseInt,Fe=typeof Xn=="object"&&Xn&&Xn.Object===Object&&Xn,Ot=typeof self=="object"&&self&&self.Object===Object&&self,Ie=Fe||Ot||Function("return this")(),ke=t&&!t.nodeType&&t,gt=ke&&!0&&n&&!n.nodeType&&n,sr=gt&&gt.exports===ke,Rt=sr&&Fe.process,We=function(){try{var x=gt&&gt.require&&gt.require("util").types;return x||Rt&&Rt.binding&&Rt.binding("util")}catch{}}(),Jt=We&&We.isArrayBuffer,Mr=We&&We.isDate,xr=We&&We.isMap,Vr=We&&We.isRegExp,An=We&&We.isSet,Mi=We&&We.isTypedArray;function Lt(x,A,T){switch(T.length){case 0:return x.call(A);case 1:return x.call(A,T[0]);case 2:return x.call(A,T[0],T[1]);case 3:return x.call(A,T[0],T[1],T[2])}return x.apply(A,T)}function Cp(x,A,T,G){for(var ce=-1,Te=x==null?0:x.length;++ce<Te;){var Nt=x[ce];A(G,Nt,T(Nt),x)}return G}function Sr(x,A){for(var T=-1,G=x==null?0:x.length;++T<G&&A(x[T],T,x)!==!1;);return x}function Np(x,A){for(var T=x==null?0:x.length;T--&&A(x[T],T,x)!==!1;);return x}function uu(x,A){for(var T=-1,G=x==null?0:x.length;++T<G;)if(!A(x[T],T,x))return!1;return!0}function yi(x,A){for(var T=-1,G=x==null?0:x.length,ce=0,Te=[];++T<G;){var Nt=x[T];A(Nt,T,x)&&(Te[ce++]=Nt)}return Te}function Ns(x,A){var T=x==null?0:x.length;return!!T&&an(x,A,0)>-1}function ca(x,A,T){for(var G=-1,ce=x==null?0:x.length;++G<ce;)if(T(A,x[G]))return!0;return!1}function Qe(x,A){for(var T=-1,G=x==null?0:x.length,ce=Array(G);++T<G;)ce[T]=A(x[T],T,x);return ce}function vi(x,A){for(var T=-1,G=A.length,ce=x.length;++T<G;)x[ce+T]=A[T];return x}function ua(x,A,T,G){var ce=-1,Te=x==null?0:x.length;for(G&&Te&&(T=x[++ce]);++ce<Te;)T=A(T,x[ce],ce,x);return T}function Ap(x,A,T,G){var ce=x==null?0:x.length;for(G&&ce&&(T=x[--ce]);ce--;)T=A(T,x[ce],ce,x);return T}function ha(x,A){for(var T=-1,G=x==null?0:x.length;++T<G;)if(A(x[T],T,x))return!0;return!1}var $p=la("length");function Dp(x){return x.split("")}function Lp(x){return x.match(Pt)||[]}function hu(x,A,T){var G;return T(x,function(ce,Te,Nt){if(A(ce,Te,Nt))return G=Te,!1}),G}function As(x,A,T,G){for(var ce=x.length,Te=T+(G?1:-1);G?Te--:++Te<ce;)if(A(x[Te],Te,x))return Te;return-1}function an(x,A,T){return A===A?Wp(x,A,T):As(x,lu,T)}function Mp(x,A,T,G){for(var ce=T-1,Te=x.length;++ce<Te;)if(G(x[ce],A))return ce;return-1}function lu(x){return x!==x}function fu(x,A){var T=x==null?0:x.length;return T?pa(x,A)/T:H}function la(x){return function(A){return A==null?r:A[x]}}function fa(x){return function(A){return x==null?r:x[A]}}function pu(x,A,T,G,ce){return ce(x,function(Te,Nt,ze){T=G?(G=!1,Te):A(T,Te,Nt,ze)}),T}function jp(x,A){var T=x.length;for(x.sort(A);T--;)x[T]=x[T].value;return x}function pa(x,A){for(var T,G=-1,ce=x.length;++G<ce;){var Te=A(x[G]);Te!==r&&(T=T===r?Te:T+Te)}return T}function da(x,A){for(var T=-1,G=Array(x);++T<x;)G[T]=A(T);return G}function qp(x,A){return Qe(A,function(T){return[T,x[T]]})}function du(x){return x&&x.slice(0,vu(x)+1).replace(ht,"")}function mr(x){return function(A){return x(A)}}function ga(x,A){return Qe(A,function(T){return x[T]})}function $n(x,A){return x.has(A)}function gu(x,A){for(var T=-1,G=x.length;++T<G&&an(A,x[T],0)>-1;);return T}function mu(x,A){for(var T=x.length;T--&&an(A,x[T],0)>-1;);return T}function Up(x,A){for(var T=x.length,G=0;T--;)x[T]===A&&++G;return G}var kp=fa(y),zp=fa(I);function Hp(x){return"\\"+F[x]}function Kp(x,A){return x==null?r:x[A]}function cn(x){return Ts.test(x)}function Bp(x){return Li.test(x)}function Vp(x){for(var A,T=[];!(A=x.next()).done;)T.push(A.value);return T}function ma(x){var A=-1,T=Array(x.size);return x.forEach(function(G,ce){T[++A]=[ce,G]}),T}function yu(x,A){return function(T){return x(A(T))}}function _i(x,A){for(var T=-1,G=x.length,ce=0,Te=[];++T<G;){var Nt=x[T];(Nt===A||Nt===w)&&(x[T]=w,Te[ce++]=T)}return Te}function $s(x){var A=-1,T=Array(x.size);return x.forEach(function(G){T[++A]=G}),T}function Fp(x){var A=-1,T=Array(x.size);return x.forEach(function(G){T[++A]=[G,G]}),T}function Wp(x,A,T){for(var G=T-1,ce=x.length;++G<ce;)if(x[G]===A)return G;return-1}function Gp(x,A,T){for(var G=T+1;G--;)if(x[G]===A)return G;return G}function un(x){return cn(x)?Yp(x):$p(x)}function jr(x){return cn(x)?Qp(x):Dp(x)}function vu(x){for(var A=x.length;A--&&dt.test(x.charAt(A)););return A}var Jp=fa(M);function Yp(x){for(var A=on.lastIndex=0;on.test(x);)++A;return A}function Qp(x){return x.match(on)||[]}function Xp(x){return x.match(Rs)||[]}var Zp=function x(A){A=A==null?Ie:hn.defaults(Ie.Object(),A,hn.pick(Ie,Cs));var T=A.Array,G=A.Date,ce=A.Error,Te=A.Function,Nt=A.Math,ze=A.Object,ya=A.RegExp,ed=A.String,Pr=A.TypeError,Ds=T.prototype,td=Te.prototype,ln=ze.prototype,Ls=A["__core-js_shared__"],Ms=td.toString,$e=ln.hasOwnProperty,rd=0,_u=function(){var e=/[^.]+$/.exec(Ls&&Ls.keys&&Ls.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),js=ln.toString,id=Ms.call(ze),nd=Ie._,sd=ya("^"+Ms.call($e).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qs=sr?A.Buffer:r,wi=A.Symbol,Us=A.Uint8Array,wu=qs?qs.allocUnsafe:r,ks=yu(ze.getPrototypeOf,ze),bu=ze.create,Eu=ln.propertyIsEnumerable,zs=Ds.splice,Iu=wi?wi.isConcatSpreadable:r,Dn=wi?wi.iterator:r,ji=wi?wi.toStringTag:r,Hs=function(){try{var e=Hi(ze,"defineProperty");return e({},"",{}),e}catch{}}(),od=A.clearTimeout!==Ie.clearTimeout&&A.clearTimeout,ad=G&&G.now!==Ie.Date.now&&G.now,cd=A.setTimeout!==Ie.setTimeout&&A.setTimeout,Ks=Nt.ceil,Bs=Nt.floor,va=ze.getOwnPropertySymbols,ud=qs?qs.isBuffer:r,xu=A.isFinite,hd=Ds.join,ld=yu(ze.keys,ze),At=Nt.max,Kt=Nt.min,fd=G.now,pd=A.parseInt,Su=Nt.random,dd=Ds.reverse,_a=Hi(A,"DataView"),Ln=Hi(A,"Map"),wa=Hi(A,"Promise"),fn=Hi(A,"Set"),Mn=Hi(A,"WeakMap"),jn=Hi(ze,"create"),Vs=Mn&&new Mn,pn={},gd=Ki(_a),md=Ki(Ln),yd=Ki(wa),vd=Ki(fn),_d=Ki(Mn),Fs=wi?wi.prototype:r,qn=Fs?Fs.valueOf:r,Pu=Fs?Fs.toString:r;function p(e){if(ft(e)&&!he(e)&&!(e instanceof be)){if(e instanceof Or)return e;if($e.call(e,"__wrapped__"))return Oh(e)}return new Or(e)}var dn=function(){function e(){}return function(i){if(!it(i))return{};if(bu)return bu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Ws(){}function Or(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:at,evaluate:ct,interpolate:rt,variable:"",imports:{_:p}},p.prototype=Ws.prototype,p.prototype.constructor=p,Or.prototype=dn(Ws.prototype),Or.prototype.constructor=Or;function be(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function wd(){var e=new be(this.__wrapped__);return e.__actions__=or(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=or(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=or(this.__views__),e}function bd(){if(this.__filtered__){var e=new be(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ed(){var e=this.__wrapped__.value(),i=this.__dir__,a=he(e),u=i<0,f=a?e.length:0,m=Dg(0,f,this.__views__),_=m.start,b=m.end,S=b-_,D=u?b:_-1,L=this.__iteratees__,j=L.length,K=0,Q=Kt(S,this.__takeCount__);if(!a||!u&&f==S&&Q==S)return Yu(e,this.__actions__);var te=[];e:for(;S--&&K<Q;){D+=i;for(var de=-1,re=e[D];++de<j;){var ye=L[de],xe=ye.iteratee,_r=ye.type,Xt=xe(re);if(_r==U)re=Xt;else if(!Xt){if(_r==q)continue e;break e}}te[K++]=re}return te}be.prototype=dn(Ws.prototype),be.prototype.constructor=be;function qi(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function Id(){this.__data__=jn?jn(null):{},this.size=0}function xd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Sd(e){var i=this.__data__;if(jn){var a=i[e];return a===v?r:a}return $e.call(i,e)?i[e]:r}function Pd(e){var i=this.__data__;return jn?i[e]!==r:$e.call(i,e)}function Od(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=jn&&i===r?v:i,this}qi.prototype.clear=Id,qi.prototype.delete=xd,qi.prototype.get=Sd,qi.prototype.has=Pd,qi.prototype.set=Od;function ei(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function Rd(){this.__data__=[],this.size=0}function Td(e){var i=this.__data__,a=Gs(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():zs.call(i,a,1),--this.size,!0}function Cd(e){var i=this.__data__,a=Gs(i,e);return a<0?r:i[a][1]}function Nd(e){return Gs(this.__data__,e)>-1}function Ad(e,i){var a=this.__data__,u=Gs(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}ei.prototype.clear=Rd,ei.prototype.delete=Td,ei.prototype.get=Cd,ei.prototype.has=Nd,ei.prototype.set=Ad;function ti(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function $d(){this.size=0,this.__data__={hash:new qi,map:new(Ln||ei),string:new qi}}function Dd(e){var i=oo(this,e).delete(e);return this.size-=i?1:0,i}function Ld(e){return oo(this,e).get(e)}function Md(e){return oo(this,e).has(e)}function jd(e,i){var a=oo(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}ti.prototype.clear=$d,ti.prototype.delete=Dd,ti.prototype.get=Ld,ti.prototype.has=Md,ti.prototype.set=jd;function Ui(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new ti;++i<a;)this.add(e[i])}function qd(e){return this.__data__.set(e,v),this}function Ud(e){return this.__data__.has(e)}Ui.prototype.add=Ui.prototype.push=qd,Ui.prototype.has=Ud;function qr(e){var i=this.__data__=new ei(e);this.size=i.size}function kd(){this.__data__=new ei,this.size=0}function zd(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function Hd(e){return this.__data__.get(e)}function Kd(e){return this.__data__.has(e)}function Bd(e,i){var a=this.__data__;if(a instanceof ei){var u=a.__data__;if(!Ln||u.length<o-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new ti(u)}return a.set(e,i),this.size=a.size,this}qr.prototype.clear=kd,qr.prototype.delete=zd,qr.prototype.get=Hd,qr.prototype.has=Kd,qr.prototype.set=Bd;function Ou(e,i){var a=he(e),u=!a&&Bi(e),f=!a&&!u&&Si(e),m=!a&&!u&&!f&&vn(e),_=a||u||f||m,b=_?da(e.length,ed):[],S=b.length;for(var D in e)(i||$e.call(e,D))&&!(_&&(D=="length"||f&&(D=="offset"||D=="parent")||m&&(D=="buffer"||D=="byteLength"||D=="byteOffset")||si(D,S)))&&b.push(D);return b}function Ru(e){var i=e.length;return i?e[Na(0,i-1)]:r}function Vd(e,i){return ao(or(e),ki(i,0,e.length))}function Fd(e){return ao(or(e))}function ba(e,i,a){(a!==r&&!Ur(e[i],a)||a===r&&!(i in e))&&ri(e,i,a)}function Un(e,i,a){var u=e[i];(!($e.call(e,i)&&Ur(u,a))||a===r&&!(i in e))&&ri(e,i,a)}function Gs(e,i){for(var a=e.length;a--;)if(Ur(e[a][0],i))return a;return-1}function Wd(e,i,a,u){return bi(e,function(f,m,_){i(u,f,a(f),_)}),u}function Tu(e,i){return e&&Wr(i,Mt(i),e)}function Gd(e,i){return e&&Wr(i,cr(i),e)}function ri(e,i,a){i=="__proto__"&&Hs?Hs(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function Ea(e,i){for(var a=-1,u=i.length,f=T(u),m=e==null;++a<u;)f[a]=m?r:rc(e,i[a]);return f}function ki(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Rr(e,i,a,u,f,m){var _,b=i&P,S=i&O,D=i&k;if(a&&(_=f?a(e,u,f,m):a(e)),_!==r)return _;if(!it(e))return e;var L=he(e);if(L){if(_=Mg(e),!b)return or(e,_)}else{var j=Bt(e),K=j==J||j==ne;if(Si(e))return Zu(e,b);if(j==we||j==_e||K&&!f){if(_=S||K?{}:vh(e),!b)return S?Sg(e,Gd(_,e)):xg(e,Tu(_,e))}else{if(!Le[j])return f?e:{};_=jg(e,j,b)}}m||(m=new qr);var Q=m.get(e);if(Q)return Q;m.set(e,_),Wh(e)?e.forEach(function(re){_.add(Rr(re,i,a,re,e,m))}):Vh(e)&&e.forEach(function(re,ye){_.set(ye,Rr(re,i,a,ye,e,m))});var te=D?S?Ha:za:S?cr:Mt,de=L?r:te(e);return Sr(de||e,function(re,ye){de&&(ye=re,re=e[ye]),Un(_,ye,Rr(re,i,a,ye,e,m))}),_}function Jd(e){var i=Mt(e);return function(a){return Cu(a,e,i)}}function Cu(e,i,a){var u=a.length;if(e==null)return!u;for(e=ze(e);u--;){var f=a[u],m=i[f],_=e[f];if(_===r&&!(f in e)||!m(_))return!1}return!0}function Nu(e,i,a){if(typeof e!="function")throw new Pr(l);return Fn(function(){e.apply(r,a)},i)}function kn(e,i,a,u){var f=-1,m=Ns,_=!0,b=e.length,S=[],D=i.length;if(!b)return S;a&&(i=Qe(i,mr(a))),u?(m=ca,_=!1):i.length>=o&&(m=$n,_=!1,i=new Ui(i));e:for(;++f<b;){var L=e[f],j=a==null?L:a(L);if(L=u||L!==0?L:0,_&&j===j){for(var K=D;K--;)if(i[K]===j)continue e;S.push(L)}else m(i,j,u)||S.push(L)}return S}var bi=nh(Fr),Au=nh(xa,!0);function Yd(e,i){var a=!0;return bi(e,function(u,f,m){return a=!!i(u,f,m),a}),a}function Js(e,i,a){for(var u=-1,f=e.length;++u<f;){var m=e[u],_=i(m);if(_!=null&&(b===r?_===_&&!vr(_):a(_,b)))var b=_,S=m}return S}function Qd(e,i,a,u){var f=e.length;for(a=fe(a),a<0&&(a=-a>f?0:f+a),u=u===r||u>f?f:fe(u),u<0&&(u+=f),u=a>u?0:Jh(u);a<u;)e[a++]=i;return e}function $u(e,i){var a=[];return bi(e,function(u,f,m){i(u,f,m)&&a.push(u)}),a}function zt(e,i,a,u,f){var m=-1,_=e.length;for(a||(a=Ug),f||(f=[]);++m<_;){var b=e[m];i>0&&a(b)?i>1?zt(b,i-1,a,u,f):vi(f,b):u||(f[f.length]=b)}return f}var Ia=sh(),Du=sh(!0);function Fr(e,i){return e&&Ia(e,i,Mt)}function xa(e,i){return e&&Du(e,i,Mt)}function Ys(e,i){return yi(i,function(a){return oi(e[a])})}function zi(e,i){i=Ii(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[Gr(i[a++])];return a&&a==u?e:r}function Lu(e,i,a){var u=i(e);return he(e)?u:vi(u,a(e))}function Yt(e){return e==null?e===r?tt:Re:ji&&ji in ze(e)?$g(e):Fg(e)}function Sa(e,i){return e>i}function Xd(e,i){return e!=null&&$e.call(e,i)}function Zd(e,i){return e!=null&&i in ze(e)}function eg(e,i,a){return e>=Kt(i,a)&&e<At(i,a)}function Pa(e,i,a){for(var u=a?ca:Ns,f=e[0].length,m=e.length,_=m,b=T(m),S=1/0,D=[];_--;){var L=e[_];_&&i&&(L=Qe(L,mr(i))),S=Kt(L.length,S),b[_]=!a&&(i||f>=120&&L.length>=120)?new Ui(_&&L):r}L=e[0];var j=-1,K=b[0];e:for(;++j<f&&D.length<S;){var Q=L[j],te=i?i(Q):Q;if(Q=a||Q!==0?Q:0,!(K?$n(K,te):u(D,te,a))){for(_=m;--_;){var de=b[_];if(!(de?$n(de,te):u(e[_],te,a)))continue e}K&&K.push(te),D.push(Q)}}return D}function tg(e,i,a,u){return Fr(e,function(f,m,_){i(u,a(f),m,_)}),u}function zn(e,i,a){i=Ii(i,e),e=Eh(e,i);var u=e==null?e:e[Gr(Cr(i))];return u==null?r:Lt(u,e,a)}function Mu(e){return ft(e)&&Yt(e)==_e}function rg(e){return ft(e)&&Yt(e)==Oe}function ig(e){return ft(e)&&Yt(e)==R}function Hn(e,i,a,u,f){return e===i?!0:e==null||i==null||!ft(e)&&!ft(i)?e!==e&&i!==i:ng(e,i,a,u,Hn,f)}function ng(e,i,a,u,f,m){var _=he(e),b=he(i),S=_?Dr:Bt(e),D=b?Dr:Bt(i);S=S==_e?we:S,D=D==_e?we:D;var L=S==we,j=D==we,K=S==D;if(K&&Si(e)){if(!Si(i))return!1;_=!0,L=!1}if(K&&!L)return m||(m=new qr),_||vn(e)?gh(e,i,a,u,f,m):Ng(e,i,S,a,u,f,m);if(!(a&$)){var Q=L&&$e.call(e,"__wrapped__"),te=j&&$e.call(i,"__wrapped__");if(Q||te){var de=Q?e.value():e,re=te?i.value():i;return m||(m=new qr),f(de,re,a,u,m)}}return K?(m||(m=new qr),Ag(e,i,a,u,f,m)):!1}function sg(e){return ft(e)&&Bt(e)==pe}function Oa(e,i,a,u){var f=a.length,m=f,_=!u;if(e==null)return!m;for(e=ze(e);f--;){var b=a[f];if(_&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++f<m;){b=a[f];var S=b[0],D=e[S],L=b[1];if(_&&b[2]){if(D===r&&!(S in e))return!1}else{var j=new qr;if(u)var K=u(D,L,S,e,i,j);if(!(K===r?Hn(L,D,$|X,u,j):K))return!1}}return!0}function ju(e){if(!it(e)||zg(e))return!1;var i=oi(e)?sd:Fo;return i.test(Ki(e))}function og(e){return ft(e)&&Yt(e)==et}function ag(e){return ft(e)&&Bt(e)==Ce}function cg(e){return ft(e)&&po(e.length)&&!!qe[Yt(e)]}function qu(e){return typeof e=="function"?e:e==null?ur:typeof e=="object"?he(e)?zu(e[0],e[1]):ku(e):ol(e)}function Ra(e){if(!Vn(e))return ld(e);var i=[];for(var a in ze(e))$e.call(e,a)&&a!="constructor"&&i.push(a);return i}function ug(e){if(!it(e))return Vg(e);var i=Vn(e),a=[];for(var u in e)u=="constructor"&&(i||!$e.call(e,u))||a.push(u);return a}function Ta(e,i){return e<i}function Uu(e,i){var a=-1,u=ar(e)?T(e.length):[];return bi(e,function(f,m,_){u[++a]=i(f,m,_)}),u}function ku(e){var i=Ba(e);return i.length==1&&i[0][2]?wh(i[0][0],i[0][1]):function(a){return a===e||Oa(a,e,i)}}function zu(e,i){return Fa(e)&&_h(i)?wh(Gr(e),i):function(a){var u=rc(a,e);return u===r&&u===i?ic(a,e):Hn(i,u,$|X)}}function Qs(e,i,a,u,f){e!==i&&Ia(i,function(m,_){if(f||(f=new qr),it(m))hg(e,i,_,a,Qs,u,f);else{var b=u?u(Ga(e,_),m,_+"",e,i,f):r;b===r&&(b=m),ba(e,_,b)}},cr)}function hg(e,i,a,u,f,m,_){var b=Ga(e,a),S=Ga(i,a),D=_.get(S);if(D){ba(e,a,D);return}var L=m?m(b,S,a+"",e,i,_):r,j=L===r;if(j){var K=he(S),Q=!K&&Si(S),te=!K&&!Q&&vn(S);L=S,K||Q||te?he(b)?L=b:mt(b)?L=or(b):Q?(j=!1,L=Zu(S,!0)):te?(j=!1,L=eh(S,!0)):L=[]:Wn(S)||Bi(S)?(L=b,Bi(b)?L=Yh(b):(!it(b)||oi(b))&&(L=vh(S))):j=!1}j&&(_.set(S,L),f(L,S,u,m,_),_.delete(S)),ba(e,a,L)}function Hu(e,i){var a=e.length;if(a)return i+=i<0?a:0,si(i,a)?e[i]:r}function Ku(e,i,a){i.length?i=Qe(i,function(m){return he(m)?function(_){return zi(_,m.length===1?m[0]:m)}:m}):i=[ur];var u=-1;i=Qe(i,mr(ee()));var f=Uu(e,function(m,_,b){var S=Qe(i,function(D){return D(m)});return{criteria:S,index:++u,value:m}});return jp(f,function(m,_){return Ig(m,_,a)})}function lg(e,i){return Bu(e,i,function(a,u){return ic(e,u)})}function Bu(e,i,a){for(var u=-1,f=i.length,m={};++u<f;){var _=i[u],b=zi(e,_);a(b,_)&&Kn(m,Ii(_,e),b)}return m}function fg(e){return function(i){return zi(i,e)}}function Ca(e,i,a,u){var f=u?Mp:an,m=-1,_=i.length,b=e;for(e===i&&(i=or(i)),a&&(b=Qe(e,mr(a)));++m<_;)for(var S=0,D=i[m],L=a?a(D):D;(S=f(b,L,S,u))>-1;)b!==e&&zs.call(b,S,1),zs.call(e,S,1);return e}function Vu(e,i){for(var a=e?i.length:0,u=a-1;a--;){var f=i[a];if(a==u||f!==m){var m=f;si(f)?zs.call(e,f,1):Da(e,f)}}return e}function Na(e,i){return e+Bs(Su()*(i-e+1))}function pg(e,i,a,u){for(var f=-1,m=At(Ks((i-e)/(a||1)),0),_=T(m);m--;)_[u?m:++f]=e,e+=a;return _}function Aa(e,i){var a="";if(!e||i<1||i>W)return a;do i%2&&(a+=e),i=Bs(i/2),i&&(e+=e);while(i);return a}function me(e,i){return Ja(bh(e,i,ur),e+"")}function dg(e){return Ru(_n(e))}function gg(e,i){var a=_n(e);return ao(a,ki(i,0,a.length))}function Kn(e,i,a,u){if(!it(e))return e;i=Ii(i,e);for(var f=-1,m=i.length,_=m-1,b=e;b!=null&&++f<m;){var S=Gr(i[f]),D=a;if(S==="__proto__"||S==="constructor"||S==="prototype")return e;if(f!=_){var L=b[S];D=u?u(L,S,b):r,D===r&&(D=it(L)?L:si(i[f+1])?[]:{})}Un(b,S,D),b=b[S]}return e}var Fu=Vs?function(e,i){return Vs.set(e,i),e}:ur,mg=Hs?function(e,i){return Hs(e,"toString",{configurable:!0,enumerable:!1,value:sc(i),writable:!0})}:ur;function yg(e){return ao(_n(e))}function Tr(e,i,a){var u=-1,f=e.length;i<0&&(i=-i>f?0:f+i),a=a>f?f:a,a<0&&(a+=f),f=i>a?0:a-i>>>0,i>>>=0;for(var m=T(f);++u<f;)m[u]=e[u+i];return m}function vg(e,i){var a;return bi(e,function(u,f,m){return a=i(u,f,m),!a}),!!a}function Xs(e,i,a){var u=0,f=e==null?u:e.length;if(typeof i=="number"&&i===i&&f<=nt){for(;u<f;){var m=u+f>>>1,_=e[m];_!==null&&!vr(_)&&(a?_<=i:_<i)?u=m+1:f=m}return f}return $a(e,i,ur,a)}function $a(e,i,a,u){var f=0,m=e==null?0:e.length;if(m===0)return 0;i=a(i);for(var _=i!==i,b=i===null,S=vr(i),D=i===r;f<m;){var L=Bs((f+m)/2),j=a(e[L]),K=j!==r,Q=j===null,te=j===j,de=vr(j);if(_)var re=u||te;else D?re=te&&(u||K):b?re=te&&K&&(u||!Q):S?re=te&&K&&!Q&&(u||!de):Q||de?re=!1:re=u?j<=i:j<i;re?f=L+1:m=L}return Kt(m,Tt)}function Wu(e,i){for(var a=-1,u=e.length,f=0,m=[];++a<u;){var _=e[a],b=i?i(_):_;if(!a||!Ur(b,S)){var S=b;m[f++]=_===0?0:_}}return m}function Gu(e){return typeof e=="number"?e:vr(e)?H:+e}function yr(e){if(typeof e=="string")return e;if(he(e))return Qe(e,yr)+"";if(vr(e))return Pu?Pu.call(e):"";var i=e+"";return i=="0"&&1/e==-Me?"-0":i}function Ei(e,i,a){var u=-1,f=Ns,m=e.length,_=!0,b=[],S=b;if(a)_=!1,f=ca;else if(m>=o){var D=i?null:Tg(e);if(D)return $s(D);_=!1,f=$n,S=new Ui}else S=i?[]:b;e:for(;++u<m;){var L=e[u],j=i?i(L):L;if(L=a||L!==0?L:0,_&&j===j){for(var K=S.length;K--;)if(S[K]===j)continue e;i&&S.push(j),b.push(L)}else f(S,j,a)||(S!==b&&S.push(j),b.push(L))}return b}function Da(e,i){return i=Ii(i,e),e=Eh(e,i),e==null||delete e[Gr(Cr(i))]}function Ju(e,i,a,u){return Kn(e,i,a(zi(e,i)),u)}function Zs(e,i,a,u){for(var f=e.length,m=u?f:-1;(u?m--:++m<f)&&i(e[m],m,e););return a?Tr(e,u?0:m,u?m+1:f):Tr(e,u?m+1:0,u?f:m)}function Yu(e,i){var a=e;return a instanceof be&&(a=a.value()),ua(i,function(u,f){return f.func.apply(f.thisArg,vi([u],f.args))},a)}function La(e,i,a){var u=e.length;if(u<2)return u?Ei(e[0]):[];for(var f=-1,m=T(u);++f<u;)for(var _=e[f],b=-1;++b<u;)b!=f&&(m[f]=kn(m[f]||_,e[b],i,a));return Ei(zt(m,1),i,a)}function Qu(e,i,a){for(var u=-1,f=e.length,m=i.length,_={};++u<f;){var b=u<m?i[u]:r;a(_,e[u],b)}return _}function Ma(e){return mt(e)?e:[]}function ja(e){return typeof e=="function"?e:ur}function Ii(e,i){return he(e)?e:Fa(e,i)?[e]:Ph(Ne(e))}var _g=me;function xi(e,i,a){var u=e.length;return a=a===r?u:a,!i&&a>=u?e:Tr(e,i,a)}var Xu=od||function(e){return Ie.clearTimeout(e)};function Zu(e,i){if(i)return e.slice();var a=e.length,u=wu?wu(a):new e.constructor(a);return e.copy(u),u}function qa(e){var i=new e.constructor(e.byteLength);return new Us(i).set(new Us(e)),i}function wg(e,i){var a=i?qa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function bg(e){var i=new e.constructor(e.source,Ir.exec(e));return i.lastIndex=e.lastIndex,i}function Eg(e){return qn?ze(qn.call(e)):{}}function eh(e,i){var a=i?qa(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function th(e,i){if(e!==i){var a=e!==r,u=e===null,f=e===e,m=vr(e),_=i!==r,b=i===null,S=i===i,D=vr(i);if(!b&&!D&&!m&&e>i||m&&_&&S&&!b&&!D||u&&_&&S||!a&&S||!f)return 1;if(!u&&!m&&!D&&e<i||D&&a&&f&&!u&&!m||b&&a&&f||!_&&f||!S)return-1}return 0}function Ig(e,i,a){for(var u=-1,f=e.criteria,m=i.criteria,_=f.length,b=a.length;++u<_;){var S=th(f[u],m[u]);if(S){if(u>=b)return S;var D=a[u];return S*(D=="desc"?-1:1)}}return e.index-i.index}function rh(e,i,a,u){for(var f=-1,m=e.length,_=a.length,b=-1,S=i.length,D=At(m-_,0),L=T(S+D),j=!u;++b<S;)L[b]=i[b];for(;++f<_;)(j||f<m)&&(L[a[f]]=e[f]);for(;D--;)L[b++]=e[f++];return L}function ih(e,i,a,u){for(var f=-1,m=e.length,_=-1,b=a.length,S=-1,D=i.length,L=At(m-b,0),j=T(L+D),K=!u;++f<L;)j[f]=e[f];for(var Q=f;++S<D;)j[Q+S]=i[S];for(;++_<b;)(K||f<m)&&(j[Q+a[_]]=e[f++]);return j}function or(e,i){var a=-1,u=e.length;for(i||(i=T(u));++a<u;)i[a]=e[a];return i}function Wr(e,i,a,u){var f=!a;a||(a={});for(var m=-1,_=i.length;++m<_;){var b=i[m],S=u?u(a[b],e[b],b,a,e):r;S===r&&(S=e[b]),f?ri(a,b,S):Un(a,b,S)}return a}function xg(e,i){return Wr(e,Va(e),i)}function Sg(e,i){return Wr(e,mh(e),i)}function eo(e,i){return function(a,u){var f=he(a)?Cp:Wd,m=i?i():{};return f(a,e,ee(u,2),m)}}function gn(e){return me(function(i,a){var u=-1,f=a.length,m=f>1?a[f-1]:r,_=f>2?a[2]:r;for(m=e.length>3&&typeof m=="function"?(f--,m):r,_&&Qt(a[0],a[1],_)&&(m=f<3?r:m,f=1),i=ze(i);++u<f;){var b=a[u];b&&e(i,b,u,m)}return i})}function nh(e,i){return function(a,u){if(a==null)return a;if(!ar(a))return e(a,u);for(var f=a.length,m=i?f:-1,_=ze(a);(i?m--:++m<f)&&u(_[m],m,_)!==!1;);return a}}function sh(e){return function(i,a,u){for(var f=-1,m=ze(i),_=u(i),b=_.length;b--;){var S=_[e?b:++f];if(a(m[S],S,m)===!1)break}return i}}function Pg(e,i,a){var u=i&se,f=Bn(e);function m(){var _=this&&this!==Ie&&this instanceof m?f:e;return _.apply(u?a:this,arguments)}return m}function oh(e){return function(i){i=Ne(i);var a=cn(i)?jr(i):r,u=a?a[0]:i.charAt(0),f=a?xi(a,1).join(""):i.slice(1);return u[e]()+f}}function mn(e){return function(i){return ua(nl(il(i).replace(Nn,"")),e,"")}}function Bn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=dn(e.prototype),u=e.apply(a,i);return it(u)?u:a}}function Og(e,i,a){var u=Bn(e);function f(){for(var m=arguments.length,_=T(m),b=m,S=yn(f);b--;)_[b]=arguments[b];var D=m<3&&_[0]!==S&&_[m-1]!==S?[]:_i(_,S);if(m-=D.length,m<a)return lh(e,i,to,f.placeholder,r,_,D,r,r,a-m);var L=this&&this!==Ie&&this instanceof f?u:e;return Lt(L,this,_)}return f}function ah(e){return function(i,a,u){var f=ze(i);if(!ar(i)){var m=ee(a,3);i=Mt(i),a=function(b){return m(f[b],b,f)}}var _=e(i,a,u);return _>-1?f[m?i[_]:_]:r}}function ch(e){return ni(function(i){var a=i.length,u=a,f=Or.prototype.thru;for(e&&i.reverse();u--;){var m=i[u];if(typeof m!="function")throw new Pr(l);if(f&&!_&&so(m)=="wrapper")var _=new Or([],!0)}for(u=_?u:a;++u<a;){m=i[u];var b=so(m),S=b=="wrapper"?Ka(m):r;S&&Wa(S[0])&&S[1]==(Y|ge|ie|Se)&&!S[4].length&&S[9]==1?_=_[so(S[0])].apply(_,S[3]):_=m.length==1&&Wa(m)?_[b]():_.thru(m)}return function(){var D=arguments,L=D[0];if(_&&D.length==1&&he(L))return _.plant(L).value();for(var j=0,K=a?i[j].apply(this,D):L;++j<a;)K=i[j].call(this,K);return K}})}function to(e,i,a,u,f,m,_,b,S,D){var L=i&Y,j=i&se,K=i&oe,Q=i&(ge|ve),te=i&$t,de=K?r:Bn(e);function re(){for(var ye=arguments.length,xe=T(ye),_r=ye;_r--;)xe[_r]=arguments[_r];if(Q)var Xt=yn(re),wr=Up(xe,Xt);if(u&&(xe=rh(xe,u,f,Q)),m&&(xe=ih(xe,m,_,Q)),ye-=wr,Q&&ye<D){var yt=_i(xe,Xt);return lh(e,i,to,re.placeholder,a,xe,yt,b,S,D-ye)}var kr=j?a:this,ci=K?kr[e]:e;return ye=xe.length,b?xe=Wg(xe,b):te&&ye>1&&xe.reverse(),L&&S<ye&&(xe.length=S),this&&this!==Ie&&this instanceof re&&(ci=de||Bn(ci)),ci.apply(kr,xe)}return re}function uh(e,i){return function(a,u){return tg(a,e,i(u),{})}}function ro(e,i){return function(a,u){var f;if(a===r&&u===r)return i;if(a!==r&&(f=a),u!==r){if(f===r)return u;typeof a=="string"||typeof u=="string"?(a=yr(a),u=yr(u)):(a=Gu(a),u=Gu(u)),f=e(a,u)}return f}}function Ua(e){return ni(function(i){return i=Qe(i,mr(ee())),me(function(a){var u=this;return e(i,function(f){return Lt(f,u,a)})})})}function io(e,i){i=i===r?" ":yr(i);var a=i.length;if(a<2)return a?Aa(i,e):i;var u=Aa(i,Ks(e/un(i)));return cn(i)?xi(jr(u),0,e).join(""):u.slice(0,e)}function Rg(e,i,a,u){var f=i&se,m=Bn(e);function _(){for(var b=-1,S=arguments.length,D=-1,L=u.length,j=T(L+S),K=this&&this!==Ie&&this instanceof _?m:e;++D<L;)j[D]=u[D];for(;S--;)j[D++]=arguments[++b];return Lt(K,f?a:this,j)}return _}function hh(e){return function(i,a,u){return u&&typeof u!="number"&&Qt(i,a,u)&&(a=u=r),i=ai(i),a===r?(a=i,i=0):a=ai(a),u=u===r?i<a?1:-1:ai(u),pg(i,a,u,e)}}function no(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Nr(i),a=Nr(a)),e(i,a)}}function lh(e,i,a,u,f,m,_,b,S,D){var L=i&ge,j=L?_:r,K=L?r:_,Q=L?m:r,te=L?r:m;i|=L?ie:ae,i&=~(L?ae:ie),i&le||(i&=~(se|oe));var de=[e,i,f,Q,j,te,K,b,S,D],re=a.apply(r,de);return Wa(e)&&Ih(re,de),re.placeholder=u,xh(re,e,i)}function ka(e){var i=Nt[e];return function(a,u){if(a=Nr(a),u=u==null?0:Kt(fe(u),292),u&&xu(a)){var f=(Ne(a)+"e").split("e"),m=i(f[0]+"e"+(+f[1]+u));return f=(Ne(m)+"e").split("e"),+(f[0]+"e"+(+f[1]-u))}return i(a)}}var Tg=fn&&1/$s(new fn([,-0]))[1]==Me?function(e){return new fn(e)}:cc;function fh(e){return function(i){var a=Bt(i);return a==pe?ma(i):a==Ce?Fp(i):qp(i,e(i))}}function ii(e,i,a,u,f,m,_,b){var S=i&oe;if(!S&&typeof e!="function")throw new Pr(l);var D=u?u.length:0;if(D||(i&=~(ie|ae),u=f=r),_=_===r?_:At(fe(_),0),b=b===r?b:fe(b),D-=f?f.length:0,i&ae){var L=u,j=f;u=f=r}var K=S?r:Ka(e),Q=[e,i,a,u,f,L,j,m,_,b];if(K&&Bg(Q,K),e=Q[0],i=Q[1],a=Q[2],u=Q[3],f=Q[4],b=Q[9]=Q[9]===r?S?0:e.length:At(Q[9]-D,0),!b&&i&(ge|ve)&&(i&=~(ge|ve)),!i||i==se)var te=Pg(e,i,a);else i==ge||i==ve?te=Og(e,i,b):(i==ie||i==(se|ie))&&!f.length?te=Rg(e,i,a,u):te=to.apply(r,Q);var de=K?Fu:Ih;return xh(de(te,Q),e,i)}function ph(e,i,a,u){return e===r||Ur(e,ln[a])&&!$e.call(u,a)?i:e}function dh(e,i,a,u,f,m){return it(e)&&it(i)&&(m.set(i,e),Qs(e,i,r,dh,m),m.delete(i)),e}function Cg(e){return Wn(e)?r:e}function gh(e,i,a,u,f,m){var _=a&$,b=e.length,S=i.length;if(b!=S&&!(_&&S>b))return!1;var D=m.get(e),L=m.get(i);if(D&&L)return D==i&&L==e;var j=-1,K=!0,Q=a&X?new Ui:r;for(m.set(e,i),m.set(i,e);++j<b;){var te=e[j],de=i[j];if(u)var re=_?u(de,te,j,i,e,m):u(te,de,j,e,i,m);if(re!==r){if(re)continue;K=!1;break}if(Q){if(!ha(i,function(ye,xe){if(!$n(Q,xe)&&(te===ye||f(te,ye,a,u,m)))return Q.push(xe)})){K=!1;break}}else if(!(te===de||f(te,de,a,u,m))){K=!1;break}}return m.delete(e),m.delete(i),K}function Ng(e,i,a,u,f,m,_){switch(a){case je:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Oe:return!(e.byteLength!=i.byteLength||!m(new Us(e),new Us(i)));case C:case R:case Pe:return Ur(+e,+i);case E:return e.name==i.name&&e.message==i.message;case et:case Ke:return e==i+"";case pe:var b=ma;case Ce:var S=u&$;if(b||(b=$s),e.size!=i.size&&!S)return!1;var D=_.get(e);if(D)return D==i;u|=X,_.set(e,i);var L=gh(b(e),b(i),u,f,m,_);return _.delete(e),L;case Be:if(qn)return qn.call(e)==qn.call(i)}return!1}function Ag(e,i,a,u,f,m){var _=a&$,b=za(e),S=b.length,D=za(i),L=D.length;if(S!=L&&!_)return!1;for(var j=S;j--;){var K=b[j];if(!(_?K in i:$e.call(i,K)))return!1}var Q=m.get(e),te=m.get(i);if(Q&&te)return Q==i&&te==e;var de=!0;m.set(e,i),m.set(i,e);for(var re=_;++j<S;){K=b[j];var ye=e[K],xe=i[K];if(u)var _r=_?u(xe,ye,K,i,e,m):u(ye,xe,K,e,i,m);if(!(_r===r?ye===xe||f(ye,xe,a,u,m):_r)){de=!1;break}re||(re=K=="constructor")}if(de&&!re){var Xt=e.constructor,wr=i.constructor;Xt!=wr&&"constructor"in e&&"constructor"in i&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof wr=="function"&&wr instanceof wr)&&(de=!1)}return m.delete(e),m.delete(i),de}function ni(e){return Ja(bh(e,r,Ch),e+"")}function za(e){return Lu(e,Mt,Va)}function Ha(e){return Lu(e,cr,mh)}var Ka=Vs?function(e){return Vs.get(e)}:cc;function so(e){for(var i=e.name+"",a=pn[i],u=$e.call(pn,i)?a.length:0;u--;){var f=a[u],m=f.func;if(m==null||m==e)return f.name}return i}function yn(e){var i=$e.call(p,"placeholder")?p:e;return i.placeholder}function ee(){var e=p.iteratee||oc;return e=e===oc?qu:e,arguments.length?e(arguments[0],arguments[1]):e}function oo(e,i){var a=e.__data__;return kg(i)?a[typeof i=="string"?"string":"hash"]:a.map}function Ba(e){for(var i=Mt(e),a=i.length;a--;){var u=i[a],f=e[u];i[a]=[u,f,_h(f)]}return i}function Hi(e,i){var a=Kp(e,i);return ju(a)?a:r}function $g(e){var i=$e.call(e,ji),a=e[ji];try{e[ji]=r;var u=!0}catch{}var f=js.call(e);return u&&(i?e[ji]=a:delete e[ji]),f}var Va=va?function(e){return e==null?[]:(e=ze(e),yi(va(e),function(i){return Eu.call(e,i)}))}:uc,mh=va?function(e){for(var i=[];e;)vi(i,Va(e)),e=ks(e);return i}:uc,Bt=Yt;(_a&&Bt(new _a(new ArrayBuffer(1)))!=je||Ln&&Bt(new Ln)!=pe||wa&&Bt(wa.resolve())!=wt||fn&&Bt(new fn)!=Ce||Mn&&Bt(new Mn)!=De)&&(Bt=function(e){var i=Yt(e),a=i==we?e.constructor:r,u=a?Ki(a):"";if(u)switch(u){case gd:return je;case md:return pe;case yd:return wt;case vd:return Ce;case _d:return De}return i});function Dg(e,i,a){for(var u=-1,f=a.length;++u<f;){var m=a[u],_=m.size;switch(m.type){case"drop":e+=_;break;case"dropRight":i-=_;break;case"take":i=Kt(i,e+_);break;case"takeRight":e=At(e,i-_);break}}return{start:e,end:i}}function Lg(e){var i=e.match(He);return i?i[1].split(St):[]}function yh(e,i,a){i=Ii(i,e);for(var u=-1,f=i.length,m=!1;++u<f;){var _=Gr(i[u]);if(!(m=e!=null&&a(e,_)))break;e=e[_]}return m||++u!=f?m:(f=e==null?0:e.length,!!f&&po(f)&&si(_,f)&&(he(e)||Bi(e)))}function Mg(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&$e.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function vh(e){return typeof e.constructor=="function"&&!Vn(e)?dn(ks(e)):{}}function jg(e,i,a){var u=e.constructor;switch(i){case Oe:return qa(e);case C:case R:return new u(+e);case je:return wg(e,a);case st:case Ae:case bt:case Ct:case Ut:case kt:case Dt:case Wt:case nr:return eh(e,a);case pe:return new u;case Pe:case Ke:return new u(e);case et:return bg(e);case Ce:return new u;case Be:return Eg(e)}}function qg(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(lt,`{
/* [wrapped with `+i+`] */
`)}function Ug(e){return he(e)||Bi(e)||!!(Iu&&e&&e[Iu])}function si(e,i){var a=typeof e;return i=i??W,!!i&&(a=="number"||a!="symbol"&&Go.test(e))&&e>-1&&e%1==0&&e<i}function Qt(e,i,a){if(!it(a))return!1;var u=typeof i;return(u=="number"?ar(a)&&si(i,a.length):u=="string"&&i in a)?Ur(a[i],e):!1}function Fa(e,i){if(he(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||vr(e)?!0:Et.test(e)||!Ye.test(e)||i!=null&&e in ze(i)}function kg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Wa(e){var i=so(e),a=p[i];if(typeof a!="function"||!(i in be.prototype))return!1;if(e===a)return!0;var u=Ka(a);return!!u&&e===u[0]}function zg(e){return!!_u&&_u in e}var Hg=Ls?oi:hc;function Vn(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||ln;return e===a}function _h(e){return e===e&&!it(e)}function wh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in ze(a))}}function Kg(e){var i=lo(e,function(u){return a.size===d&&a.clear(),u}),a=i.cache;return i}function Bg(e,i){var a=e[1],u=i[1],f=a|u,m=f<(se|oe|Y),_=u==Y&&a==ge||u==Y&&a==Se&&e[7].length<=i[8]||u==(Y|Se)&&i[7].length<=i[8]&&a==ge;if(!(m||_))return e;u&se&&(e[2]=i[2],f|=a&se?0:le);var b=i[3];if(b){var S=e[3];e[3]=S?rh(S,b,i[4]):b,e[4]=S?_i(e[3],w):i[4]}return b=i[5],b&&(S=e[5],e[5]=S?ih(S,b,i[6]):b,e[6]=S?_i(e[5],w):i[6]),b=i[7],b&&(e[7]=b),u&Y&&(e[8]=e[8]==null?i[8]:Kt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function Vg(e){var i=[];if(e!=null)for(var a in ze(e))i.push(a);return i}function Fg(e){return js.call(e)}function bh(e,i,a){return i=At(i===r?e.length-1:i,0),function(){for(var u=arguments,f=-1,m=At(u.length-i,0),_=T(m);++f<m;)_[f]=u[i+f];f=-1;for(var b=T(i+1);++f<i;)b[f]=u[f];return b[i]=a(_),Lt(e,this,b)}}function Eh(e,i){return i.length<2?e:zi(e,Tr(i,0,-1))}function Wg(e,i){for(var a=e.length,u=Kt(i.length,a),f=or(e);u--;){var m=i[u];e[u]=si(m,a)?f[m]:r}return e}function Ga(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Ih=Sh(Fu),Fn=cd||function(e,i){return Ie.setTimeout(e,i)},Ja=Sh(mg);function xh(e,i,a){var u=i+"";return Ja(e,qg(u,Gg(Lg(u),a)))}function Sh(e){var i=0,a=0;return function(){var u=fd(),f=dr-(u-a);if(a=u,f>0){if(++i>=Ft)return arguments[0]}else i=0;return e.apply(r,arguments)}}function ao(e,i){var a=-1,u=e.length,f=u-1;for(i=i===r?u:i;++a<i;){var m=Na(a,f),_=e[m];e[m]=e[a],e[a]=_}return e.length=i,e}var Ph=Kg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(It,function(a,u,f,m){i.push(f?m.replace(Ho,"$1"):u||a)}),i});function Gr(e){if(typeof e=="string"||vr(e))return e;var i=e+"";return i=="0"&&1/e==-Me?"-0":i}function Ki(e){if(e!=null){try{return Ms.call(e)}catch{}try{return e+""}catch{}}return""}function Gg(e,i){return Sr(Ci,function(a){var u="_."+a[0];i&a[1]&&!Ns(e,u)&&e.push(u)}),e.sort()}function Oh(e){if(e instanceof be)return e.clone();var i=new Or(e.__wrapped__,e.__chain__);return i.__actions__=or(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Jg(e,i,a){(a?Qt(e,i,a):i===r)?i=1:i=At(fe(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var f=0,m=0,_=T(Ks(u/i));f<u;)_[m++]=Tr(e,f,f+=i);return _}function Yg(e){for(var i=-1,a=e==null?0:e.length,u=0,f=[];++i<a;){var m=e[i];m&&(f[u++]=m)}return f}function Qg(){var e=arguments.length;if(!e)return[];for(var i=T(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return vi(he(a)?or(a):[a],zt(i,1))}var Xg=me(function(e,i){return mt(e)?kn(e,zt(i,1,mt,!0)):[]}),Zg=me(function(e,i){var a=Cr(i);return mt(a)&&(a=r),mt(e)?kn(e,zt(i,1,mt,!0),ee(a,2)):[]}),em=me(function(e,i){var a=Cr(i);return mt(a)&&(a=r),mt(e)?kn(e,zt(i,1,mt,!0),r,a):[]});function tm(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:fe(i),Tr(e,i<0?0:i,u)):[]}function rm(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:fe(i),i=u-i,Tr(e,0,i<0?0:i)):[]}function im(e,i){return e&&e.length?Zs(e,ee(i,3),!0,!0):[]}function nm(e,i){return e&&e.length?Zs(e,ee(i,3),!0):[]}function sm(e,i,a,u){var f=e==null?0:e.length;return f?(a&&typeof a!="number"&&Qt(e,i,a)&&(a=0,u=f),Qd(e,i,a,u)):[]}function Rh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:fe(a);return f<0&&(f=At(u+f,0)),As(e,ee(i,3),f)}function Th(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u-1;return a!==r&&(f=fe(a),f=a<0?At(u+f,0):Kt(f,u-1)),As(e,ee(i,3),f,!0)}function Ch(e){var i=e==null?0:e.length;return i?zt(e,1):[]}function om(e){var i=e==null?0:e.length;return i?zt(e,Me):[]}function am(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:fe(i),zt(e,i)):[]}function cm(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var f=e[i];u[f[0]]=f[1]}return u}function Nh(e){return e&&e.length?e[0]:r}function um(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=a==null?0:fe(a);return f<0&&(f=At(u+f,0)),an(e,i,f)}function hm(e){var i=e==null?0:e.length;return i?Tr(e,0,-1):[]}var lm=me(function(e){var i=Qe(e,Ma);return i.length&&i[0]===e[0]?Pa(i):[]}),fm=me(function(e){var i=Cr(e),a=Qe(e,Ma);return i===Cr(a)?i=r:a.pop(),a.length&&a[0]===e[0]?Pa(a,ee(i,2)):[]}),pm=me(function(e){var i=Cr(e),a=Qe(e,Ma);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?Pa(a,r,i):[]});function dm(e,i){return e==null?"":hd.call(e,i)}function Cr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function gm(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var f=u;return a!==r&&(f=fe(a),f=f<0?At(u+f,0):Kt(f,u-1)),i===i?Gp(e,i,f):As(e,lu,f,!0)}function mm(e,i){return e&&e.length?Hu(e,fe(i)):r}var ym=me(Ah);function Ah(e,i){return e&&e.length&&i&&i.length?Ca(e,i):e}function vm(e,i,a){return e&&e.length&&i&&i.length?Ca(e,i,ee(a,2)):e}function _m(e,i,a){return e&&e.length&&i&&i.length?Ca(e,i,r,a):e}var wm=ni(function(e,i){var a=e==null?0:e.length,u=Ea(e,i);return Vu(e,Qe(i,function(f){return si(f,a)?+f:f}).sort(th)),u});function bm(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,f=[],m=e.length;for(i=ee(i,3);++u<m;){var _=e[u];i(_,u,e)&&(a.push(_),f.push(u))}return Vu(e,f),a}function Ya(e){return e==null?e:dd.call(e)}function Em(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&Qt(e,i,a)?(i=0,a=u):(i=i==null?0:fe(i),a=a===r?u:fe(a)),Tr(e,i,a)):[]}function Im(e,i){return Xs(e,i)}function xm(e,i,a){return $a(e,i,ee(a,2))}function Sm(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i);if(u<a&&Ur(e[u],i))return u}return-1}function Pm(e,i){return Xs(e,i,!0)}function Om(e,i,a){return $a(e,i,ee(a,2),!0)}function Rm(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i,!0)-1;if(Ur(e[u],i))return u}return-1}function Tm(e){return e&&e.length?Wu(e):[]}function Cm(e,i){return e&&e.length?Wu(e,ee(i,2)):[]}function Nm(e){var i=e==null?0:e.length;return i?Tr(e,1,i):[]}function Am(e,i,a){return e&&e.length?(i=a||i===r?1:fe(i),Tr(e,0,i<0?0:i)):[]}function $m(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:fe(i),i=u-i,Tr(e,i<0?0:i,u)):[]}function Dm(e,i){return e&&e.length?Zs(e,ee(i,3),!1,!0):[]}function Lm(e,i){return e&&e.length?Zs(e,ee(i,3)):[]}var Mm=me(function(e){return Ei(zt(e,1,mt,!0))}),jm=me(function(e){var i=Cr(e);return mt(i)&&(i=r),Ei(zt(e,1,mt,!0),ee(i,2))}),qm=me(function(e){var i=Cr(e);return i=typeof i=="function"?i:r,Ei(zt(e,1,mt,!0),r,i)});function Um(e){return e&&e.length?Ei(e):[]}function km(e,i){return e&&e.length?Ei(e,ee(i,2)):[]}function zm(e,i){return i=typeof i=="function"?i:r,e&&e.length?Ei(e,r,i):[]}function Qa(e){if(!(e&&e.length))return[];var i=0;return e=yi(e,function(a){if(mt(a))return i=At(a.length,i),!0}),da(i,function(a){return Qe(e,la(a))})}function $h(e,i){if(!(e&&e.length))return[];var a=Qa(e);return i==null?a:Qe(a,function(u){return Lt(i,r,u)})}var Hm=me(function(e,i){return mt(e)?kn(e,i):[]}),Km=me(function(e){return La(yi(e,mt))}),Bm=me(function(e){var i=Cr(e);return mt(i)&&(i=r),La(yi(e,mt),ee(i,2))}),Vm=me(function(e){var i=Cr(e);return i=typeof i=="function"?i:r,La(yi(e,mt),r,i)}),Fm=me(Qa);function Wm(e,i){return Qu(e||[],i||[],Un)}function Gm(e,i){return Qu(e||[],i||[],Kn)}var Jm=me(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,$h(e,a)});function Dh(e){var i=p(e);return i.__chain__=!0,i}function Ym(e,i){return i(e),e}function co(e,i){return i(e)}var Qm=ni(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,f=function(m){return Ea(m,e)};return i>1||this.__actions__.length||!(u instanceof be)||!si(a)?this.thru(f):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:co,args:[f],thisArg:r}),new Or(u,this.__chain__).thru(function(m){return i&&!m.length&&m.push(r),m}))});function Xm(){return Dh(this)}function Zm(){return new Or(this.value(),this.__chain__)}function ey(){this.__values__===r&&(this.__values__=Gh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function ty(){return this}function ry(e){for(var i,a=this;a instanceof Ws;){var u=Oh(a);u.__index__=0,u.__values__=r,i?f.__wrapped__=u:i=u;var f=u;a=a.__wrapped__}return f.__wrapped__=e,i}function iy(){var e=this.__wrapped__;if(e instanceof be){var i=e;return this.__actions__.length&&(i=new be(this)),i=i.reverse(),i.__actions__.push({func:co,args:[Ya],thisArg:r}),new Or(i,this.__chain__)}return this.thru(Ya)}function ny(){return Yu(this.__wrapped__,this.__actions__)}var sy=eo(function(e,i,a){$e.call(e,a)?++e[a]:ri(e,a,1)});function oy(e,i,a){var u=he(e)?uu:Yd;return a&&Qt(e,i,a)&&(i=r),u(e,ee(i,3))}function ay(e,i){var a=he(e)?yi:$u;return a(e,ee(i,3))}var cy=ah(Rh),uy=ah(Th);function hy(e,i){return zt(uo(e,i),1)}function ly(e,i){return zt(uo(e,i),Me)}function fy(e,i,a){return a=a===r?1:fe(a),zt(uo(e,i),a)}function Lh(e,i){var a=he(e)?Sr:bi;return a(e,ee(i,3))}function Mh(e,i){var a=he(e)?Np:Au;return a(e,ee(i,3))}var py=eo(function(e,i,a){$e.call(e,a)?e[a].push(i):ri(e,a,[i])});function dy(e,i,a,u){e=ar(e)?e:_n(e),a=a&&!u?fe(a):0;var f=e.length;return a<0&&(a=At(f+a,0)),go(e)?a<=f&&e.indexOf(i,a)>-1:!!f&&an(e,i,a)>-1}var gy=me(function(e,i,a){var u=-1,f=typeof i=="function",m=ar(e)?T(e.length):[];return bi(e,function(_){m[++u]=f?Lt(i,_,a):zn(_,i,a)}),m}),my=eo(function(e,i,a){ri(e,a,i)});function uo(e,i){var a=he(e)?Qe:Uu;return a(e,ee(i,3))}function yy(e,i,a,u){return e==null?[]:(he(i)||(i=i==null?[]:[i]),a=u?r:a,he(a)||(a=a==null?[]:[a]),Ku(e,i,a))}var vy=eo(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function _y(e,i,a){var u=he(e)?ua:pu,f=arguments.length<3;return u(e,ee(i,4),a,f,bi)}function wy(e,i,a){var u=he(e)?Ap:pu,f=arguments.length<3;return u(e,ee(i,4),a,f,Au)}function by(e,i){var a=he(e)?yi:$u;return a(e,fo(ee(i,3)))}function Ey(e){var i=he(e)?Ru:dg;return i(e)}function Iy(e,i,a){(a?Qt(e,i,a):i===r)?i=1:i=fe(i);var u=he(e)?Vd:gg;return u(e,i)}function xy(e){var i=he(e)?Fd:yg;return i(e)}function Sy(e){if(e==null)return 0;if(ar(e))return go(e)?un(e):e.length;var i=Bt(e);return i==pe||i==Ce?e.size:Ra(e).length}function Py(e,i,a){var u=he(e)?ha:vg;return a&&Qt(e,i,a)&&(i=r),u(e,ee(i,3))}var Oy=me(function(e,i){if(e==null)return[];var a=i.length;return a>1&&Qt(e,i[0],i[1])?i=[]:a>2&&Qt(i[0],i[1],i[2])&&(i=[i[0]]),Ku(e,zt(i,1),[])}),ho=ad||function(){return Ie.Date.now()};function Ry(e,i){if(typeof i!="function")throw new Pr(l);return e=fe(e),function(){if(--e<1)return i.apply(this,arguments)}}function jh(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,ii(e,Y,r,r,r,r,i)}function qh(e,i){var a;if(typeof i!="function")throw new Pr(l);return e=fe(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var Xa=me(function(e,i,a){var u=se;if(a.length){var f=_i(a,yn(Xa));u|=ie}return ii(e,u,i,a,f)}),Uh=me(function(e,i,a){var u=se|oe;if(a.length){var f=_i(a,yn(Uh));u|=ie}return ii(i,u,e,a,f)});function kh(e,i,a){i=a?r:i;var u=ii(e,ge,r,r,r,r,r,i);return u.placeholder=kh.placeholder,u}function zh(e,i,a){i=a?r:i;var u=ii(e,ve,r,r,r,r,r,i);return u.placeholder=zh.placeholder,u}function Hh(e,i,a){var u,f,m,_,b,S,D=0,L=!1,j=!1,K=!0;if(typeof e!="function")throw new Pr(l);i=Nr(i)||0,it(a)&&(L=!!a.leading,j="maxWait"in a,m=j?At(Nr(a.maxWait)||0,i):m,K="trailing"in a?!!a.trailing:K);function Q(yt){var kr=u,ci=f;return u=f=r,D=yt,_=e.apply(ci,kr),_}function te(yt){return D=yt,b=Fn(ye,i),L?Q(yt):_}function de(yt){var kr=yt-S,ci=yt-D,al=i-kr;return j?Kt(al,m-ci):al}function re(yt){var kr=yt-S,ci=yt-D;return S===r||kr>=i||kr<0||j&&ci>=m}function ye(){var yt=ho();if(re(yt))return xe(yt);b=Fn(ye,de(yt))}function xe(yt){return b=r,K&&u?Q(yt):(u=f=r,_)}function _r(){b!==r&&Xu(b),D=0,u=S=f=b=r}function Xt(){return b===r?_:xe(ho())}function wr(){var yt=ho(),kr=re(yt);if(u=arguments,f=this,S=yt,kr){if(b===r)return te(S);if(j)return Xu(b),b=Fn(ye,i),Q(S)}return b===r&&(b=Fn(ye,i)),_}return wr.cancel=_r,wr.flush=Xt,wr}var Ty=me(function(e,i){return Nu(e,1,i)}),Cy=me(function(e,i,a){return Nu(e,Nr(i)||0,a)});function Ny(e){return ii(e,$t)}function lo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Pr(l);var a=function(){var u=arguments,f=i?i.apply(this,u):u[0],m=a.cache;if(m.has(f))return m.get(f);var _=e.apply(this,u);return a.cache=m.set(f,_)||m,_};return a.cache=new(lo.Cache||ti),a}lo.Cache=ti;function fo(e){if(typeof e!="function")throw new Pr(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Ay(e){return qh(2,e)}var $y=_g(function(e,i){i=i.length==1&&he(i[0])?Qe(i[0],mr(ee())):Qe(zt(i,1),mr(ee()));var a=i.length;return me(function(u){for(var f=-1,m=Kt(u.length,a);++f<m;)u[f]=i[f].call(this,u[f]);return Lt(e,this,u)})}),Za=me(function(e,i){var a=_i(i,yn(Za));return ii(e,ie,r,i,a)}),Kh=me(function(e,i){var a=_i(i,yn(Kh));return ii(e,ae,r,i,a)}),Dy=ni(function(e,i){return ii(e,Se,r,r,r,i)});function Ly(e,i){if(typeof e!="function")throw new Pr(l);return i=i===r?i:fe(i),me(e,i)}function My(e,i){if(typeof e!="function")throw new Pr(l);return i=i==null?0:At(fe(i),0),me(function(a){var u=a[i],f=xi(a,0,i);return u&&vi(f,u),Lt(e,this,f)})}function jy(e,i,a){var u=!0,f=!0;if(typeof e!="function")throw new Pr(l);return it(a)&&(u="leading"in a?!!a.leading:u,f="trailing"in a?!!a.trailing:f),Hh(e,i,{leading:u,maxWait:i,trailing:f})}function qy(e){return jh(e,1)}function Uy(e,i){return Za(ja(i),e)}function ky(){if(!arguments.length)return[];var e=arguments[0];return he(e)?e:[e]}function zy(e){return Rr(e,k)}function Hy(e,i){return i=typeof i=="function"?i:r,Rr(e,k,i)}function Ky(e){return Rr(e,P|k)}function By(e,i){return i=typeof i=="function"?i:r,Rr(e,P|k,i)}function Vy(e,i){return i==null||Cu(e,i,Mt(i))}function Ur(e,i){return e===i||e!==e&&i!==i}var Fy=no(Sa),Wy=no(function(e,i){return e>=i}),Bi=Mu(function(){return arguments}())?Mu:function(e){return ft(e)&&$e.call(e,"callee")&&!Eu.call(e,"callee")},he=T.isArray,Gy=Jt?mr(Jt):rg;function ar(e){return e!=null&&po(e.length)&&!oi(e)}function mt(e){return ft(e)&&ar(e)}function Jy(e){return e===!0||e===!1||ft(e)&&Yt(e)==C}var Si=ud||hc,Yy=Mr?mr(Mr):ig;function Qy(e){return ft(e)&&e.nodeType===1&&!Wn(e)}function Xy(e){if(e==null)return!0;if(ar(e)&&(he(e)||typeof e=="string"||typeof e.splice=="function"||Si(e)||vn(e)||Bi(e)))return!e.length;var i=Bt(e);if(i==pe||i==Ce)return!e.size;if(Vn(e))return!Ra(e).length;for(var a in e)if($e.call(e,a))return!1;return!0}function Zy(e,i){return Hn(e,i)}function e0(e,i,a){a=typeof a=="function"?a:r;var u=a?a(e,i):r;return u===r?Hn(e,i,r,a):!!u}function ec(e){if(!ft(e))return!1;var i=Yt(e);return i==E||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Wn(e)}function t0(e){return typeof e=="number"&&xu(e)}function oi(e){if(!it(e))return!1;var i=Yt(e);return i==J||i==ne||i==N||i==pt}function Bh(e){return typeof e=="number"&&e==fe(e)}function po(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=W}function it(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function ft(e){return e!=null&&typeof e=="object"}var Vh=xr?mr(xr):sg;function r0(e,i){return e===i||Oa(e,i,Ba(i))}function i0(e,i,a){return a=typeof a=="function"?a:r,Oa(e,i,Ba(i),a)}function n0(e){return Fh(e)&&e!=+e}function s0(e){if(Hg(e))throw new ce(c);return ju(e)}function o0(e){return e===null}function a0(e){return e==null}function Fh(e){return typeof e=="number"||ft(e)&&Yt(e)==Pe}function Wn(e){if(!ft(e)||Yt(e)!=we)return!1;var i=ks(e);if(i===null)return!0;var a=$e.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&Ms.call(a)==id}var tc=Vr?mr(Vr):og;function c0(e){return Bh(e)&&e>=-W&&e<=W}var Wh=An?mr(An):ag;function go(e){return typeof e=="string"||!he(e)&&ft(e)&&Yt(e)==Ke}function vr(e){return typeof e=="symbol"||ft(e)&&Yt(e)==Be}var vn=Mi?mr(Mi):cg;function u0(e){return e===r}function h0(e){return ft(e)&&Bt(e)==De}function l0(e){return ft(e)&&Yt(e)==Ve}var f0=no(Ta),p0=no(function(e,i){return e<=i});function Gh(e){if(!e)return[];if(ar(e))return go(e)?jr(e):or(e);if(Dn&&e[Dn])return Vp(e[Dn]());var i=Bt(e),a=i==pe?ma:i==Ce?$s:_n;return a(e)}function ai(e){if(!e)return e===0?e:0;if(e=Nr(e),e===Me||e===-Me){var i=e<0?-1:1;return i*B}return e===e?e:0}function fe(e){var i=ai(e),a=i%1;return i===i?a?i-a:i:0}function Jh(e){return e?ki(fe(e),0,V):0}function Nr(e){if(typeof e=="number")return e;if(vr(e))return H;if(it(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=it(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=du(e);var a=Vo.test(e);return a||Wo.test(e)?ue(e.slice(2),a?2:8):Bo.test(e)?H:+e}function Yh(e){return Wr(e,cr(e))}function d0(e){return e?ki(fe(e),-W,W):e===0?e:0}function Ne(e){return e==null?"":yr(e)}var g0=gn(function(e,i){if(Vn(i)||ar(i)){Wr(i,Mt(i),e);return}for(var a in i)$e.call(i,a)&&Un(e,a,i[a])}),Qh=gn(function(e,i){Wr(i,cr(i),e)}),mo=gn(function(e,i,a,u){Wr(i,cr(i),e,u)}),m0=gn(function(e,i,a,u){Wr(i,Mt(i),e,u)}),y0=ni(Ea);function v0(e,i){var a=dn(e);return i==null?a:Tu(a,i)}var _0=me(function(e,i){e=ze(e);var a=-1,u=i.length,f=u>2?i[2]:r;for(f&&Qt(i[0],i[1],f)&&(u=1);++a<u;)for(var m=i[a],_=cr(m),b=-1,S=_.length;++b<S;){var D=_[b],L=e[D];(L===r||Ur(L,ln[D])&&!$e.call(e,D))&&(e[D]=m[D])}return e}),w0=me(function(e){return e.push(r,dh),Lt(Xh,r,e)});function b0(e,i){return hu(e,ee(i,3),Fr)}function E0(e,i){return hu(e,ee(i,3),xa)}function I0(e,i){return e==null?e:Ia(e,ee(i,3),cr)}function x0(e,i){return e==null?e:Du(e,ee(i,3),cr)}function S0(e,i){return e&&Fr(e,ee(i,3))}function P0(e,i){return e&&xa(e,ee(i,3))}function O0(e){return e==null?[]:Ys(e,Mt(e))}function R0(e){return e==null?[]:Ys(e,cr(e))}function rc(e,i,a){var u=e==null?r:zi(e,i);return u===r?a:u}function T0(e,i){return e!=null&&yh(e,i,Xd)}function ic(e,i){return e!=null&&yh(e,i,Zd)}var C0=uh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=js.call(i)),e[i]=a},sc(ur)),N0=uh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=js.call(i)),$e.call(e,i)?e[i].push(a):e[i]=[a]},ee),A0=me(zn);function Mt(e){return ar(e)?Ou(e):Ra(e)}function cr(e){return ar(e)?Ou(e,!0):ug(e)}function $0(e,i){var a={};return i=ee(i,3),Fr(e,function(u,f,m){ri(a,i(u,f,m),u)}),a}function D0(e,i){var a={};return i=ee(i,3),Fr(e,function(u,f,m){ri(a,f,i(u,f,m))}),a}var L0=gn(function(e,i,a){Qs(e,i,a)}),Xh=gn(function(e,i,a,u){Qs(e,i,a,u)}),M0=ni(function(e,i){var a={};if(e==null)return a;var u=!1;i=Qe(i,function(m){return m=Ii(m,e),u||(u=m.length>1),m}),Wr(e,Ha(e),a),u&&(a=Rr(a,P|O|k,Cg));for(var f=i.length;f--;)Da(a,i[f]);return a});function j0(e,i){return Zh(e,fo(ee(i)))}var q0=ni(function(e,i){return e==null?{}:lg(e,i)});function Zh(e,i){if(e==null)return{};var a=Qe(Ha(e),function(u){return[u]});return i=ee(i),Bu(e,a,function(u,f){return i(u,f[0])})}function U0(e,i,a){i=Ii(i,e);var u=-1,f=i.length;for(f||(f=1,e=r);++u<f;){var m=e==null?r:e[Gr(i[u])];m===r&&(u=f,m=a),e=oi(m)?m.call(e):m}return e}function k0(e,i,a){return e==null?e:Kn(e,i,a)}function z0(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:Kn(e,i,a,u)}var el=fh(Mt),tl=fh(cr);function H0(e,i,a){var u=he(e),f=u||Si(e)||vn(e);if(i=ee(i,4),a==null){var m=e&&e.constructor;f?a=u?new m:[]:it(e)?a=oi(m)?dn(ks(e)):{}:a={}}return(f?Sr:Fr)(e,function(_,b,S){return i(a,_,b,S)}),a}function K0(e,i){return e==null?!0:Da(e,i)}function B0(e,i,a){return e==null?e:Ju(e,i,ja(a))}function V0(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:Ju(e,i,ja(a),u)}function _n(e){return e==null?[]:ga(e,Mt(e))}function F0(e){return e==null?[]:ga(e,cr(e))}function W0(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Nr(a),a=a===a?a:0),i!==r&&(i=Nr(i),i=i===i?i:0),ki(Nr(e),i,a)}function G0(e,i,a){return i=ai(i),a===r?(a=i,i=0):a=ai(a),e=Nr(e),eg(e,i,a)}function J0(e,i,a){if(a&&typeof a!="boolean"&&Qt(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ai(e),i===r?(i=e,e=0):i=ai(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var f=Su();return Kt(e+f*(i-e+Ue("1e-"+((f+"").length-1))),i)}return Na(e,i)}var Y0=mn(function(e,i,a){return i=i.toLowerCase(),e+(a?rl(i):i)});function rl(e){return nc(Ne(e).toLowerCase())}function il(e){return e=Ne(e),e&&e.replace(Xr,kp).replace(oa,"")}function Q0(e,i,a){e=Ne(e),i=yr(i);var u=e.length;a=a===r?u:ki(fe(a),0,u);var f=a;return a-=i.length,a>=0&&e.slice(a,f)==i}function X0(e){return e=Ne(e),e&&Je.test(e)?e.replace(Ni,zp):e}function Z0(e){return e=Ne(e),e&&xt.test(e)?e.replace(ut,"\\$&"):e}var ev=mn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),tv=mn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),rv=oh("toLowerCase");function iv(e,i,a){e=Ne(e),i=fe(i);var u=i?un(e):0;if(!i||u>=i)return e;var f=(i-u)/2;return io(Bs(f),a)+e+io(Ks(f),a)}function nv(e,i,a){e=Ne(e),i=fe(i);var u=i?un(e):0;return i&&u<i?e+io(i-u,a):e}function sv(e,i,a){e=Ne(e),i=fe(i);var u=i?un(e):0;return i&&u<i?io(i-u,a)+e:e}function ov(e,i,a){return a||i==null?i=0:i&&(i=+i),pd(Ne(e).replace(ht,""),i||0)}function av(e,i,a){return(a?Qt(e,i,a):i===r)?i=1:i=fe(i),Aa(Ne(e),i)}function cv(){var e=arguments,i=Ne(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var uv=mn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function hv(e,i,a){return a&&typeof a!="number"&&Qt(e,i,a)&&(i=a=r),a=a===r?V:a>>>0,a?(e=Ne(e),e&&(typeof i=="string"||i!=null&&!tc(i))&&(i=yr(i),!i&&cn(e))?xi(jr(e),0,a):e.split(i,a)):[]}var lv=mn(function(e,i,a){return e+(a?" ":"")+nc(i)});function fv(e,i,a){return e=Ne(e),a=a==null?0:ki(fe(a),0,e.length),i=yr(i),e.slice(a,a+i.length)==i}function pv(e,i,a){var u=p.templateSettings;a&&Qt(e,i,a)&&(i=r),e=Ne(e),i=mo({},i,u,ph);var f=mo({},i.imports,u.imports,ph),m=Mt(f),_=ga(f,m),b,S,D=0,L=i.interpolate||Zi,j="__p += '",K=ya((i.escape||Zi).source+"|"+L.source+"|"+(L===rt?Ko:Zi).source+"|"+(i.evaluate||Zi).source+"|$","g"),Q="//# sourceURL="+($e.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++aa+"]")+`
`;e.replace(K,function(re,ye,xe,_r,Xt,wr){return xe||(xe=_r),j+=e.slice(D,wr).replace(Jo,Hp),ye&&(b=!0,j+=`' +
__e(`+ye+`) +
'`),Xt&&(S=!0,j+=`';
`+Xt+`;
__p += '`),xe&&(j+=`' +
((__t = (`+xe+`)) == null ? '' : __t) +
'`),D=wr+re.length,re}),j+=`';
`;var te=$e.call(i,"variable")&&i.variable;if(!te)j=`with (obj) {
`+j+`
}
`;else if(zo.test(te))throw new ce(g);j=(S?j.replace(Kr,""):j).replace(Gt,"$1").replace(Qr,"$1;"),j="function("+(te||"obj")+`) {
`+(te?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(S?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+j+`return __p
}`;var de=sl(function(){return Te(m,Q+"return "+j).apply(r,_)});if(de.source=j,ec(de))throw de;return de}function dv(e){return Ne(e).toLowerCase()}function gv(e){return Ne(e).toUpperCase()}function mv(e,i,a){if(e=Ne(e),e&&(a||i===r))return du(e);if(!e||!(i=yr(i)))return e;var u=jr(e),f=jr(i),m=gu(u,f),_=mu(u,f)+1;return xi(u,m,_).join("")}function yv(e,i,a){if(e=Ne(e),e&&(a||i===r))return e.slice(0,vu(e)+1);if(!e||!(i=yr(i)))return e;var u=jr(e),f=mu(u,jr(i))+1;return xi(u,0,f).join("")}function vv(e,i,a){if(e=Ne(e),e&&(a||i===r))return e.replace(ht,"");if(!e||!(i=yr(i)))return e;var u=jr(e),f=gu(u,jr(i));return xi(u,f).join("")}function _v(e,i){var a=_t,u=ir;if(it(i)){var f="separator"in i?i.separator:f;a="length"in i?fe(i.length):a,u="omission"in i?yr(i.omission):u}e=Ne(e);var m=e.length;if(cn(e)){var _=jr(e);m=_.length}if(a>=m)return e;var b=a-un(u);if(b<1)return u;var S=_?xi(_,0,b).join(""):e.slice(0,b);if(f===r)return S+u;if(_&&(b+=S.length-b),tc(f)){if(e.slice(b).search(f)){var D,L=S;for(f.global||(f=ya(f.source,Ne(Ir.exec(f))+"g")),f.lastIndex=0;D=f.exec(L);)var j=D.index;S=S.slice(0,j===r?b:j)}}else if(e.indexOf(yr(f),b)!=b){var K=S.lastIndexOf(f);K>-1&&(S=S.slice(0,K))}return S+u}function wv(e){return e=Ne(e),e&&ot.test(e)?e.replace(gi,Jp):e}var bv=mn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),nc=oh("toUpperCase");function nl(e,i,a){return e=Ne(e),i=a?r:i,i===r?Bp(e)?Xp(e):Lp(e):e.match(i)||[]}var sl=me(function(e,i){try{return Lt(e,r,i)}catch(a){return ec(a)?a:new ce(a)}}),Ev=ni(function(e,i){return Sr(i,function(a){a=Gr(a),ri(e,a,Xa(e[a],e))}),e});function Iv(e){var i=e==null?0:e.length,a=ee();return e=i?Qe(e,function(u){if(typeof u[1]!="function")throw new Pr(l);return[a(u[0]),u[1]]}):[],me(function(u){for(var f=-1;++f<i;){var m=e[f];if(Lt(m[0],this,u))return Lt(m[1],this,u)}})}function xv(e){return Jd(Rr(e,P))}function sc(e){return function(){return e}}function Sv(e,i){return e==null||e!==e?i:e}var Pv=ch(),Ov=ch(!0);function ur(e){return e}function oc(e){return qu(typeof e=="function"?e:Rr(e,P))}function Rv(e){return ku(Rr(e,P))}function Tv(e,i){return zu(e,Rr(i,P))}var Cv=me(function(e,i){return function(a){return zn(a,e,i)}}),Nv=me(function(e,i){return function(a){return zn(e,a,i)}});function ac(e,i,a){var u=Mt(i),f=Ys(i,u);a==null&&!(it(i)&&(f.length||!u.length))&&(a=i,i=e,e=this,f=Ys(i,Mt(i)));var m=!(it(a)&&"chain"in a)||!!a.chain,_=oi(e);return Sr(f,function(b){var S=i[b];e[b]=S,_&&(e.prototype[b]=function(){var D=this.__chain__;if(m||D){var L=e(this.__wrapped__),j=L.__actions__=or(this.__actions__);return j.push({func:S,args:arguments,thisArg:e}),L.__chain__=D,L}return S.apply(e,vi([this.value()],arguments))})}),e}function Av(){return Ie._===this&&(Ie._=nd),this}function cc(){}function $v(e){return e=fe(e),me(function(i){return Hu(i,e)})}var Dv=Ua(Qe),Lv=Ua(uu),Mv=Ua(ha);function ol(e){return Fa(e)?la(Gr(e)):fg(e)}function jv(e){return function(i){return e==null?r:zi(e,i)}}var qv=hh(),Uv=hh(!0);function uc(){return[]}function hc(){return!1}function kv(){return{}}function zv(){return""}function Hv(){return!0}function Kv(e,i){if(e=fe(e),e<1||e>W)return[];var a=V,u=Kt(e,V);i=ee(i),e-=V;for(var f=da(u,i);++a<e;)i(a);return f}function Bv(e){return he(e)?Qe(e,Gr):vr(e)?[e]:or(Ph(Ne(e)))}function Vv(e){var i=++rd;return Ne(e)+i}var Fv=ro(function(e,i){return e+i},0),Wv=ka("ceil"),Gv=ro(function(e,i){return e/i},1),Jv=ka("floor");function Yv(e){return e&&e.length?Js(e,ur,Sa):r}function Qv(e,i){return e&&e.length?Js(e,ee(i,2),Sa):r}function Xv(e){return fu(e,ur)}function Zv(e,i){return fu(e,ee(i,2))}function e_(e){return e&&e.length?Js(e,ur,Ta):r}function t_(e,i){return e&&e.length?Js(e,ee(i,2),Ta):r}var r_=ro(function(e,i){return e*i},1),i_=ka("round"),n_=ro(function(e,i){return e-i},0);function s_(e){return e&&e.length?pa(e,ur):0}function o_(e,i){return e&&e.length?pa(e,ee(i,2)):0}return p.after=Ry,p.ary=jh,p.assign=g0,p.assignIn=Qh,p.assignInWith=mo,p.assignWith=m0,p.at=y0,p.before=qh,p.bind=Xa,p.bindAll=Ev,p.bindKey=Uh,p.castArray=ky,p.chain=Dh,p.chunk=Jg,p.compact=Yg,p.concat=Qg,p.cond=Iv,p.conforms=xv,p.constant=sc,p.countBy=sy,p.create=v0,p.curry=kh,p.curryRight=zh,p.debounce=Hh,p.defaults=_0,p.defaultsDeep=w0,p.defer=Ty,p.delay=Cy,p.difference=Xg,p.differenceBy=Zg,p.differenceWith=em,p.drop=tm,p.dropRight=rm,p.dropRightWhile=im,p.dropWhile=nm,p.fill=sm,p.filter=ay,p.flatMap=hy,p.flatMapDeep=ly,p.flatMapDepth=fy,p.flatten=Ch,p.flattenDeep=om,p.flattenDepth=am,p.flip=Ny,p.flow=Pv,p.flowRight=Ov,p.fromPairs=cm,p.functions=O0,p.functionsIn=R0,p.groupBy=py,p.initial=hm,p.intersection=lm,p.intersectionBy=fm,p.intersectionWith=pm,p.invert=C0,p.invertBy=N0,p.invokeMap=gy,p.iteratee=oc,p.keyBy=my,p.keys=Mt,p.keysIn=cr,p.map=uo,p.mapKeys=$0,p.mapValues=D0,p.matches=Rv,p.matchesProperty=Tv,p.memoize=lo,p.merge=L0,p.mergeWith=Xh,p.method=Cv,p.methodOf=Nv,p.mixin=ac,p.negate=fo,p.nthArg=$v,p.omit=M0,p.omitBy=j0,p.once=Ay,p.orderBy=yy,p.over=Dv,p.overArgs=$y,p.overEvery=Lv,p.overSome=Mv,p.partial=Za,p.partialRight=Kh,p.partition=vy,p.pick=q0,p.pickBy=Zh,p.property=ol,p.propertyOf=jv,p.pull=ym,p.pullAll=Ah,p.pullAllBy=vm,p.pullAllWith=_m,p.pullAt=wm,p.range=qv,p.rangeRight=Uv,p.rearg=Dy,p.reject=by,p.remove=bm,p.rest=Ly,p.reverse=Ya,p.sampleSize=Iy,p.set=k0,p.setWith=z0,p.shuffle=xy,p.slice=Em,p.sortBy=Oy,p.sortedUniq=Tm,p.sortedUniqBy=Cm,p.split=hv,p.spread=My,p.tail=Nm,p.take=Am,p.takeRight=$m,p.takeRightWhile=Dm,p.takeWhile=Lm,p.tap=Ym,p.throttle=jy,p.thru=co,p.toArray=Gh,p.toPairs=el,p.toPairsIn=tl,p.toPath=Bv,p.toPlainObject=Yh,p.transform=H0,p.unary=qy,p.union=Mm,p.unionBy=jm,p.unionWith=qm,p.uniq=Um,p.uniqBy=km,p.uniqWith=zm,p.unset=K0,p.unzip=Qa,p.unzipWith=$h,p.update=B0,p.updateWith=V0,p.values=_n,p.valuesIn=F0,p.without=Hm,p.words=nl,p.wrap=Uy,p.xor=Km,p.xorBy=Bm,p.xorWith=Vm,p.zip=Fm,p.zipObject=Wm,p.zipObjectDeep=Gm,p.zipWith=Jm,p.entries=el,p.entriesIn=tl,p.extend=Qh,p.extendWith=mo,ac(p,p),p.add=Fv,p.attempt=sl,p.camelCase=Y0,p.capitalize=rl,p.ceil=Wv,p.clamp=W0,p.clone=zy,p.cloneDeep=Ky,p.cloneDeepWith=By,p.cloneWith=Hy,p.conformsTo=Vy,p.deburr=il,p.defaultTo=Sv,p.divide=Gv,p.endsWith=Q0,p.eq=Ur,p.escape=X0,p.escapeRegExp=Z0,p.every=oy,p.find=cy,p.findIndex=Rh,p.findKey=b0,p.findLast=uy,p.findLastIndex=Th,p.findLastKey=E0,p.floor=Jv,p.forEach=Lh,p.forEachRight=Mh,p.forIn=I0,p.forInRight=x0,p.forOwn=S0,p.forOwnRight=P0,p.get=rc,p.gt=Fy,p.gte=Wy,p.has=T0,p.hasIn=ic,p.head=Nh,p.identity=ur,p.includes=dy,p.indexOf=um,p.inRange=G0,p.invoke=A0,p.isArguments=Bi,p.isArray=he,p.isArrayBuffer=Gy,p.isArrayLike=ar,p.isArrayLikeObject=mt,p.isBoolean=Jy,p.isBuffer=Si,p.isDate=Yy,p.isElement=Qy,p.isEmpty=Xy,p.isEqual=Zy,p.isEqualWith=e0,p.isError=ec,p.isFinite=t0,p.isFunction=oi,p.isInteger=Bh,p.isLength=po,p.isMap=Vh,p.isMatch=r0,p.isMatchWith=i0,p.isNaN=n0,p.isNative=s0,p.isNil=a0,p.isNull=o0,p.isNumber=Fh,p.isObject=it,p.isObjectLike=ft,p.isPlainObject=Wn,p.isRegExp=tc,p.isSafeInteger=c0,p.isSet=Wh,p.isString=go,p.isSymbol=vr,p.isTypedArray=vn,p.isUndefined=u0,p.isWeakMap=h0,p.isWeakSet=l0,p.join=dm,p.kebabCase=ev,p.last=Cr,p.lastIndexOf=gm,p.lowerCase=tv,p.lowerFirst=rv,p.lt=f0,p.lte=p0,p.max=Yv,p.maxBy=Qv,p.mean=Xv,p.meanBy=Zv,p.min=e_,p.minBy=t_,p.stubArray=uc,p.stubFalse=hc,p.stubObject=kv,p.stubString=zv,p.stubTrue=Hv,p.multiply=r_,p.nth=mm,p.noConflict=Av,p.noop=cc,p.now=ho,p.pad=iv,p.padEnd=nv,p.padStart=sv,p.parseInt=ov,p.random=J0,p.reduce=_y,p.reduceRight=wy,p.repeat=av,p.replace=cv,p.result=U0,p.round=i_,p.runInContext=x,p.sample=Ey,p.size=Sy,p.snakeCase=uv,p.some=Py,p.sortedIndex=Im,p.sortedIndexBy=xm,p.sortedIndexOf=Sm,p.sortedLastIndex=Pm,p.sortedLastIndexBy=Om,p.sortedLastIndexOf=Rm,p.startCase=lv,p.startsWith=fv,p.subtract=n_,p.sum=s_,p.sumBy=o_,p.template=pv,p.times=Kv,p.toFinite=ai,p.toInteger=fe,p.toLength=Jh,p.toLower=dv,p.toNumber=Nr,p.toSafeInteger=d0,p.toString=Ne,p.toUpper=gv,p.trim=mv,p.trimEnd=yv,p.trimStart=vv,p.truncate=_v,p.unescape=wv,p.uniqueId=Vv,p.upperCase=bv,p.upperFirst=nc,p.each=Lh,p.eachRight=Mh,p.first=Nh,ac(p,function(){var e={};return Fr(p,function(i,a){$e.call(p.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),p.VERSION=s,Sr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),Sr(["drop","take"],function(e,i){be.prototype[e]=function(a){a=a===r?1:At(fe(a),0);var u=this.__filtered__&&!i?new be(this):this.clone();return u.__filtered__?u.__takeCount__=Kt(a,u.__takeCount__):u.__views__.push({size:Kt(a,V),type:e+(u.__dir__<0?"Right":"")}),u},be.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),Sr(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==q||a==Ge;be.prototype[e]=function(f){var m=this.clone();return m.__iteratees__.push({iteratee:ee(f,3),type:a}),m.__filtered__=m.__filtered__||u,m}}),Sr(["head","last"],function(e,i){var a="take"+(i?"Right":"");be.prototype[e]=function(){return this[a](1).value()[0]}}),Sr(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");be.prototype[e]=function(){return this.__filtered__?new be(this):this[a](1)}}),be.prototype.compact=function(){return this.filter(ur)},be.prototype.find=function(e){return this.filter(e).head()},be.prototype.findLast=function(e){return this.reverse().find(e)},be.prototype.invokeMap=me(function(e,i){return typeof e=="function"?new be(this):this.map(function(a){return zn(a,e,i)})}),be.prototype.reject=function(e){return this.filter(fo(ee(e)))},be.prototype.slice=function(e,i){e=fe(e);var a=this;return a.__filtered__&&(e>0||i<0)?new be(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=fe(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},be.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},be.prototype.toArray=function(){return this.take(V)},Fr(be.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),f=p[u?"take"+(i=="last"?"Right":""):i],m=u||/^find/.test(i);f&&(p.prototype[i]=function(){var _=this.__wrapped__,b=u?[1]:arguments,S=_ instanceof be,D=b[0],L=S||he(_),j=function(ye){var xe=f.apply(p,vi([ye],b));return u&&K?xe[0]:xe};L&&a&&typeof D=="function"&&D.length!=1&&(S=L=!1);var K=this.__chain__,Q=!!this.__actions__.length,te=m&&!K,de=S&&!Q;if(!m&&L){_=de?_:new be(this);var re=e.apply(_,b);return re.__actions__.push({func:co,args:[j],thisArg:r}),new Or(re,K)}return te&&de?e.apply(this,b):(re=this.thru(j),te?u?re.value()[0]:re.value():re)})}),Sr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ds[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var f=arguments;if(u&&!this.__chain__){var m=this.value();return i.apply(he(m)?m:[],f)}return this[a](function(_){return i.apply(he(_)?_:[],f)})}}),Fr(be.prototype,function(e,i){var a=p[i];if(a){var u=a.name+"";$e.call(pn,u)||(pn[u]=[]),pn[u].push({name:i,func:a})}}),pn[to(r,oe).name]=[{name:"wrapper",func:r}],be.prototype.clone=wd,be.prototype.reverse=bd,be.prototype.value=Ed,p.prototype.at=Qm,p.prototype.chain=Xm,p.prototype.commit=Zm,p.prototype.next=ey,p.prototype.plant=ry,p.prototype.reverse=iy,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=ny,p.prototype.first=p.prototype.head,Dn&&(p.prototype[Dn]=ty),p},hn=Zp();gt?((gt.exports=hn)._=hn,ke._=hn):Ie._=hn}).call(Xn)})(Kc,Kc.exports);var xS=Object.defineProperty,SS=Object.defineProperties,PS=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,OS=Object.prototype.hasOwnProperty,RS=Object.prototype.propertyIsEnumerable,_f=(n,t,r)=>t in n?xS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Eo=(n,t)=>{for(var r in t||(t={}))OS.call(t,r)&&_f(n,r,t[r]);if(vf)for(var r of vf(t))RS.call(t,r)&&_f(n,r,t[r]);return n},TS=(n,t)=>SS(n,PS(t));function Ri(n,t,r){var s;const o=k_(n);return((s=t.rpcMap)==null?void 0:s[o.reference])||`${IS}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Xi(n){return n.includes(":")?n.split(":")[1]:n}function Rp(n){return n.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function CS(n,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(n));if(!r.length)return[];const s=[];return r.forEach(o=>{const c=t.namespaces[o].accounts;s.push(...c)}),s}function wf(n={},t={}){const r=bf(n),s=bf(t);return Kc.exports.merge(r,s)}function bf(n){var t,r,s,o;const c={};if(!ns(n))return c;for(const[l,g]of Object.entries(n)){const v=Xc(l)?[l]:g.chains,d=g.methods||[],w=g.events||[],P=g.rpcMap||{},O=Zn(l);c[O]=TS(Eo(Eo({},c[O]),g),{chains:fc(v,(t=c[O])==null?void 0:t.chains),methods:fc(d,(r=c[O])==null?void 0:r.methods),events:fc(w,(s=c[O])==null?void 0:s.events),rpcMap:Eo(Eo({},P),(o=c[O])==null?void 0:o.rpcMap)})}return c}function NS(n){return n.includes(":")?n.split(":")[2]:n}function AS(n){const t={};for(const[r,s]of Object.entries(n)){const o=s.methods||[],c=s.events||[],l=s.accounts||[],g=Xc(r)?[r]:s.chains?s.chains:Rp(s.accounts);t[r]={chains:g,methods:o,events:c,accounts:l}}return t}function xc(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):(n=n.includes(":")?n.split(":")[1]:n,isNaN(Number(n))?n:Number(n))}const Tp={},Ze=n=>Tp[n],Sc=(n,t)=>{Tp[n]=t};class $S{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Xi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ri(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}}class DS{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Ri(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=parseInt(Xi(r));t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class LS{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Xi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ri(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}}class MS{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Xi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ri(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}}class jS{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),o=Xi(r);t[o]=this.createHttpProvider(o,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}}class qS{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Xi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ri(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}}class US{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=Xi(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ri(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new pi(new Ti(s,Ze("disableProviderPing")))}}class kS{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Ri(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ri(t,this.namespace);return typeof s>"u"?void 0:new pi(new Ti(s,Ze("disableProviderPing")))}}var zS=Object.defineProperty,HS=Object.defineProperties,KS=Object.getOwnPropertyDescriptors,Ef=Object.getOwnPropertySymbols,BS=Object.prototype.hasOwnProperty,VS=Object.prototype.propertyIsEnumerable,If=(n,t,r)=>t in n?zS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Io=(n,t)=>{for(var r in t||(t={}))BS.call(t,r)&&If(n,r,t[r]);if(Ef)for(var r of Ef(t))VS.call(t,r)&&If(n,r,t[r]);return n},Pc=(n,t)=>HS(n,KS(t));class au{constructor(t){this.events=new Fc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||mf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new au(t);return await r.initialize(),r}async request(t,r,s){const[o,c]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(o).request({request:Io({},t),chainId:`${o}:${c}`,topic:this.session.topic,expiry:s})}sendAsync(t,r,s,o){const c=new Date().getTime();this.request(t,s,o).then(l=>r(null,Mo(c,l))).catch(l=>r(l,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Xe("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(c=>{this.session=c;const l=AS(c.namespaces);this.namespaces=wf(this.namespaces,l),this.persist("namespaces",this.namespaces)}).catch(c=>{if(c.message!==Pp)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,o]=this.validateChain(t);this.getProvider(s).setDefaultChain(o,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Yr(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await yS.init({logger:this.providerOpts.logger||mf,relayUrl:this.providerOpts.relayUrl||wS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Zn(r)))];Sc("client",this.client),Sc("events",this.events),Sc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=CS(r,this.session),o=Rp(s),c=wf(this.namespaces,this.optionalNamespaces),l=Pc(Io({},c[r]),{accounts:s,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new DS({namespace:l});break;case"solana":this.rpcProviders[r]=new LS({namespace:l});break;case"cosmos":this.rpcProviders[r]=new MS({namespace:l});break;case"polkadot":this.rpcProviders[r]=new $S({namespace:l});break;case"cip34":this.rpcProviders[r]=new jS({namespace:l});break;case"elrond":this.rpcProviders[r]=new qS({namespace:l});break;case"multiversx":this.rpcProviders[r]=new US({namespace:l});break;case"near":this.rpcProviders[r]=new kS({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const o=s.data;o&&Yr(o)&&this.events.emit("accountsChanged",o.map(NS))}else if(s.name==="chainChanged"){const o=r.chainId,c=r.event.data,l=Zn(o),g=xc(o)!==xc(c)?`${l}:${xc(c)}`:o;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:o}=r,c=(s=this.client)==null?void 0:s.session.get(t);this.session=Pc(Io({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Pc(Io({},Xe("USER_DISCONNECTED")),{data:t.topic}))}),this.on(di.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(l=>Zn(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const o=Zn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){if(!this.namespaces)return;const[s,o]=this.validateChain(t);o&&(r||this.getProvider(s).setDefaultChain(o),this.namespaces[s]?this.namespaces[s].defaultChain=o:this.namespaces[`${s}:${o}`]?this.namespaces[`${s}:${o}`].defaultChain=o:this.namespaces[`${s}:${o}`]={defaultChain:o},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",o))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${yf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${yf}/${t}`)}}const FS=au,WS="wc",GS="ethereum_provider",JS=`${WS}@2:${GS}:`,YS="https://rpc.walletconnect.com/v1/",Bc=["eth_sendTransaction","personal_sign"],QS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Vc=["chainChanged","accountsChanged"],XS=["chainChanged","accountsChanged","message","disconnect","connect"];var ZS=Object.defineProperty,eP=Object.defineProperties,tP=Object.getOwnPropertyDescriptors,xf=Object.getOwnPropertySymbols,rP=Object.prototype.hasOwnProperty,iP=Object.prototype.propertyIsEnumerable,Sf=(n,t,r)=>t in n?ZS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,ts=(n,t)=>{for(var r in t||(t={}))rP.call(t,r)&&Sf(n,r,t[r]);if(xf)for(var r of xf(t))iP.call(t,r)&&Sf(n,r,t[r]);return n},Pf=(n,t)=>eP(n,tP(t));function Ao(n){return Number(n[0].split(":")[1])}function Oc(n){return`0x${n.toString(16)}`}function nP(n){const{chains:t,optionalChains:r,methods:s,optionalMethods:o,events:c,optionalEvents:l,rpcMap:g}=n;if(!Yr(t))throw new Error("Invalid chains");const v={chains:t,methods:s||Bc,events:c||Vc,rpcMap:ts({},t.length?{[Ao(t)]:g[Ao(t)]}:{})},d=c==null?void 0:c.filter(k=>!Vc.includes(k)),w=s==null?void 0:s.filter(k=>!Bc.includes(k));if(!r&&!l&&!o&&!(d!=null&&d.length)&&!(w!=null&&w.length))return{required:t.length?v:void 0};const P=(d==null?void 0:d.length)&&(w==null?void 0:w.length)||!r,O={chains:[...new Set(P?v.chains.concat(r||[]):r)],methods:[...new Set(v.methods.concat(o!=null&&o.length?o:QS))],events:[...new Set(v.events.concat(l!=null&&l.length?l:XS))],rpcMap:g};return{required:t.length?v:void 0,optional:r.length?O:void 0}}class cu{constructor(){this.events=new $r.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=JS,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new cu;return await r.initialize(t),r}async request(t,r){return await this.signer.request(t,this.formatChainId(this.chainId),r)}sendAsync(t,r,s){this.signer.sendAsync(t,r,this.formatChainId(this.chainId),s)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=nP(this.rpc);try{const o=await new Promise(async(l,g)=>{var v;this.rpc.showQrModal&&((v=this.modal)==null||v.subscribeModal(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Pf(ts({namespaces:ts({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(d=>{l(d)}).catch(d=>{g(new Error(d.message))})});if(!o)return;const c=z_(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Oc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Oc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Pf(ts({},Xe("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Oc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,o]=t.split(":");return{chainId:`${r}:${s}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const o=(r=t==null?void 0:t.chains)!=null?r:[],c=(s=t==null?void 0:t.optionalChains)!=null?s:[],l=o.concat(c);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=o.length?(t==null?void 0:t.methods)||Bc:[],v=o.length?(t==null?void 0:t.events)||Vc:[],d=(t==null?void 0:t.optionalMethods)||[],w=(t==null?void 0:t.optionalEvents)||[],P=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),O=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(k=>this.formatChainId(k)),optionalChains:c.map(k=>this.formatChainId(k)),methods:g,events:v,optionalMethods:d,optionalEvents:w,rpcMap:P,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:O,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(o=>{s[o]=this.getRpcUrl(o,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ao(this.rpc.chains):Ao(this.rpc.optionalChains),this.signer=await FS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await u_(()=>import("./index-IKukH_Wi.js").then(o=>o.i),__vite__mapDeps([0,1,2]),import.meta.url);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(ts({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:o}=t;r&&Yr(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),s&&Yr(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(c=>this.formatChainId(c)),s.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${YS}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const xP=cu;export{xP as EthereumProvider,XS as OPTIONAL_EVENTS,QS as OPTIONAL_METHODS,Vc as REQUIRED_EVENTS,Bc as REQUIRED_METHODS,cu as default};
